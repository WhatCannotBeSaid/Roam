/* ========================================================= */
/* 1. CSS Variables (Light) - 格式/顺序对齐 lesswrong.css   */
/* 已比对 system.css：无同名变量（system 仅 --primary-color/--s1/--dark-* 等），本块全部保留 */
/* 去重说明：本文件已相对 blueprint.css / site.css 做布局属性去重，仅保留字体/颜色及独有声明。 */
/* ========================================================= */
:root,
.roam-app {
  /* Typography - Humanist Endgame 字栈 (门面/骨架/血肉/呼吸/眉批/代码) */
  --title-font: 'Domaine Display', '方正柳公权楷书 简', serif;
  --heading-font: 'Canela', 'Aa古典明朝楷 (非商业使用)', sans-serif;
  --body-font: 'Tiempos Text', '方正屏显雅宋_GBK', serif;
  --quote-font: 'Calligraph421 BT', '文悦古典明朝体 简入繁出 (需授权)', serif;
  --tag-font: 'Cronos Pro', '方正优雅宋 简', sans-serif;
  --code-font: 'Operator Mono', 'LXGW Wenkai Mono Screen', monospace;
  --ui-font: 'Ideal Sans', '方正艺黑简体',  -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
  --font-size: 1rem;

  /* Day Mode - 黑/灰系：页面标题/正文/引用/H1-H3（有层次）；彩色系：标签/双链/外链（色相环隔开） */
  --m-bg: #C7D1C6;       /* 苍艾 - 核心背景（固定） */
  --m-surface: #C7D1C6;  /* 苍艾（固定） */
  --m-text: #313233;     /* 墨色 - 正文 */
  --m-ink: #2B2B2B;      /* 皂色 - 边框/阴影 */
  --m-text-muted: #758A99; /* 墨灰 */
  --m-primary: #789262;   /* 竹青 - 主色 */
  --m-secondary: #D3B17D; /* 枯黄 - 辅助色 */
  --m-sidebar-title: var(--m-primary);
  /* 黑色/灰色系（层次：由深到浅） */
  --m-title-display: #161823;     /* 漆黑 - 页面标题 */
  --m-heading-h1: #1C1C1C;        /* 乌色 - H1 */
  --m-heading-h2: #424C50;        /* 鸦青 - H2 */
  --m-heading-h3: #50616D;        /* 岩灰 - H3 */
  --m-blockquote: #2B2B2B;        /* 皂色 - 引用块正文（高雅深色） */
  --m-blockquote-bar: #177CB0;    /* 靛青 - 引用块竖条（高雅显眼） */
  --m-blockquote-bar-hover: #125A82; /* 靛青加深 - 引用块竖条 hover */
  /* 彩色系（黄 / 蓝 / 红紫，色相环不临近，标签避绿不撞背景） */
  --m-page-tag: #75878A;          /* 苍色 - 弱化标签区 */
  --m-tag: #CA6924;               /* 琥珀 - 标签（黄色系） */
  --m-tag-hover: #A8551E;         /* 琥珀加深 - 标签 hover */
  /* 学术标签（Academic Tag）日间 */
  --tag-text-color: #1a1a1a;
  --tag-border-color: #333333;
  --tag-hover-bg: rgba(0, 0, 0, 0.03);
  --tag-font-weight: 600;
  /* Links 专用（不与 blockquote-bar / sidebar-star / tag / 高亮 重复） */
  --m-page-ref: #0D9488;            /* 青绿 - 双链（teal，与主色/引用条/侧栏星标区分） */
  --m-page-ref-hover: #0F766E;       /* 深青绿 - 双链 hover */
  --m-link: #7C3AED;                /* 紫 - 外链（violet，与绛紫/高亮系区分） */
  --m-link-hover: #6D28D9;          /* 深紫 - 外链 hover */
  /* 其他 */
  --m-reference-strong: #118b6e;  /* 青碧 - 引用区 strong */
  --m-sidebar-star: #177CB0;      /* 靛青 */
  --m-checkbox-checked: #21A675;  /* 松柏绿 */
  --m-code-selection: #D6ECF0;    /* 月白 */
  --m-on-accent: #F2ECDE;         /* 缟 */
  --m-highlight-underline: #DB5A6B; /* 海棠红 - 粉色系 */
  --m-highlight-yellow: #F47983;    /* 桃红 - 粉色系 */
  --m-highlight-green: #E4C4D8;     /* 藕荷 - 粉色系 */
  --m-highlight-blue: #FFB3A7;      /* 粉红 - 粉色系 */
  --m-highlight-red: #EF7A82;       /* 嫣红 - 粉色系 */
  --m-bullet-focus: #DB5A6B;        /* 海棠红 - bullet 编辑态泛光（中国传统色） */
  --m-highlight-purple: #D2A4C8;    /* 绛紫亮 - 粉色系 */
  --m-highlight-orange: #DB5A6B;    /* 海棠红 - 粉色系 */
  --m-sidebar-icon: #3D3B4F;        /* 玄色 */
  --m-sidebar-title-day: #057748;   /* 松花绿 */
  --m-sidebar-star-day: #065279;    /* 靛蓝 */
  --m-warn: #D23B3B;                /* 丹 - 警示 */
  --m-popover: var(--m-surface);

  /* 映射到既有主题语义变量（bc/co 顺序） */
  --bg-color: var(--m-bg);
  --page-color: var(--m-surface);
  --text-color: var(--m-text);
  --light-text-color: var(--m-text-muted);
  --page-tag-color: var(--m-page-tag);
  --color-primary: var(--m-primary);
  --color-secondary: var(--m-secondary);
  /* Hover derivations (oklch, mode-agnostic) */
  --hover-primary-soft: oklch(from var(--m-primary) l c h / 0.10);
  --hover-primary: oklch(from var(--m-primary) l c h / 0.14);
  --hover-primary-strong: oklch(from var(--m-primary) l c h / 0.25);
  --hover-secondary: oklch(from var(--m-secondary) l c h / 1);
  --color-primary-light: var(--hover-primary);
  --color-primary-highlight: var(--hover-primary-soft);
  --color-subtle-border: oklch(from var(--m-text) l c h / 0.10);
  --title-display-color: var(--m-title-display);
  --heading-h1-color: var(--m-heading-h1);
  --heading-h2-color: var(--m-heading-h2);
  --heading-h3-color: var(--m-heading-h3);
  --blockquote-text: var(--m-blockquote);
  --reference-strong-color: var(--m-reference-strong);
  --block-highlight-bg: oklch(from var(--m-primary) l c h / 0.18);
  --sidebar-title-color: var(--m-sidebar-title);
  --sidebar-star-color: var(--m-sidebar-star);
  --reference-title-color: var(--m-primary);
  --checkbox-checked-color: var(--m-checkbox-checked);
  --tree-node-color: var(--m-primary);
  --code-selection-color: var(--m-code-selection);

  /* Component Backgrounds (bc) */
  --code-bg: oklch(from var(--m-text) l c h / 0.04);
  --inline-code-bg: oklch(from var(--m-page-ref) l c h / 0.2);
  --inline-code-color: var(--m-tag);
  --embed-bg: oklch(from var(--m-text) l c h / 0.03);
  --embed-hover-bg: oklch(from var(--m-text) l c h / 0.06);
  --reference-item-bg: oklch(from var(--m-primary) l c h / 0.06);
  --reference-item-hover-bg: oklch(from var(--m-primary) l c h / 0.12);
  --kanban-column-bg: oklch(from var(--m-text) l c h / 0.03);
  --kanban-card-bg: oklch(from var(--m-primary) l c h / 0.05);
  --kanban-card-hover-bg: oklch(from var(--m-primary) l c h / 0.10);

  /* Shadows / Focus / Selection / Scrollbar (sd) */
  --shadow-soft: 0 6px 18px oklch(from var(--m-ink) l c h / 0.12);
  --shadow-floating: 0 10px 30px oklch(from var(--m-ink) l c h / 0.16);
  --focus-ring: 0 0 0 3px oklch(from var(--m-primary) l c h / 0.28);
  --selection-bg: oklch(from var(--m-primary) l c h / 0.58);
  --selection-text: var(--m-ink);
  --scrollbar-track: oklch(from var(--m-text) l c h / 0.06);
  --scrollbar-thumb: oklch(from var(--m-primary) l c h / 0.35);
  --scrollbar-thumb-hover: oklch(from var(--m-primary) l c h / 0.52);
  --on-accent: var(--m-on-accent);

  /* Popover (bc / border / sd) */
  --popover-bg: var(--m-popover);
  --popover-border: transparent;
  --popover-shadow: var(--shadow-floating);

  /* 交互语义 / Datepicker / Find-or-Create */
  --menu-hover-bg: var(--hover-primary);
  --menu-divider-color: transparent;
  --menu-hover-text: var(--text-color);
  --btn-disabled-text: oklch(from var(--m-text) l c h / 0.55);
  --tooltip-text: var(--text-color);
  --datepicker-day-hover-bg: var(--hover-primary);
  --datepicker-day-hover-text: var(--text-color);
  --datepicker-day-selected-bg: var(--color-primary);
  --datepicker-day-selected-text: var(--on-accent);
  --find-input-bg: oklch(from var(--m-text) l c h / 0.06);
  --find-input-focus-bg: var(--page-color);
  --find-input-focus-shadow: var(--shadow-soft);
  --autocomplete-row-hover-bg: oklch(from var(--m-primary) l c h / 0.12);
  --autocomplete-row-hover-text: var(--color-primary);
  --autocomplete-results-bg: var(--page-color);
  --ui-surface-bg: var(--page-color);
  --ui-surface-text: var(--text-color);
  --ui-surface-shadow: var(--popover-shadow);

  /* Sync Indicator (border / sd) */
  --sync-warn-border: var(--m-warn);
  --sync-warn-shadow: 0 0 12px oklch(from var(--m-warn) l c h / 0.25);
  --sync-warn-focus-shadow: 0 0 0 2px oklch(from var(--m-warn) l c h / 0.20), 0 4px 16px oklch(from var(--m-warn) l c h / 0.10);
  --sync-synced-border: transparent;
  --sync-synced-border-color: oklch(from var(--m-primary) l c h / 0.30);
  --sync-synced-focus-shadow: 0 0 0 2px oklch(from var(--m-sidebar-star) l c h / 0.20), 0 4px 12px oklch(from var(--m-ink) l c h / 0.12);
  --search-hit-bg: oklch(from var(--m-highlight-yellow) l c h / 0.40);
  --autocomplete-match-bg: oklch(from var(--m-highlight-yellow) l c h / 0.30);
  --confirmation-btn-hover-bg: var(--embed-hover-bg);
  /* References 卡片：分割线始终 1px，仅颜色随主题 */
  --reference-divider-color: transparent;
  --reference-icon-hover-bg: oklch(from var(--m-primary) l c h / 0.12);

  /* Typography accents / Blockquote / Warnings / Divider（标签仅用隐迹，无 pill 变量） */
  --hr-color: var(--m-tag);
  --strong-color: var(--heading-h1-color);
  --blockquote-bar: var(--m-blockquote-bar);
  --blockquote-text-color: var(--blockquote-text);
  --blockquote-bar-color: var(--m-blockquote-bar);
  --blockquote-bar-hover-color: var(--m-blockquote-bar-hover);
  --code-warning-surface: var(--popover-bg);
  --code-warning-code-bg: var(--code-bg);
  --code-warning-text: var(--text-color);
  --code-warning-btn-bg: var(--color-primary-light);
  --code-warning-btn-hover-bg: var(--hover-primary-soft);
  --danger-bg: oklch(from var(--m-highlight-red) l c h / 0.20);
  --danger-border: oklch(from var(--m-highlight-red) l c h / 0.28);

  /* Sidebar (co / sd) */
  --sidebar-text-day: var(--heading-h2-color);
  --sidebar-hover-bg: var(--hover-primary-soft);
  --title-text-shadow: 0 1px 2px oklch(from var(--m-ink) l c h / 0.05);
  --ink-solid: var(--m-ink);

  /* Smiley Toggle（未完成=红系与夜间一致，完成=绿） */
  --m-checkbox-unchecked: #C83C23;  /* 绯红 - 未勾选/未完成，日夜统一 */
  --toggle-off-bg: var(--m-checkbox-unchecked);
  --toggle-off-shadow: 0 4px 10px oklch(from var(--m-checkbox-unchecked) l c h / 0.35);
  --toggle-on-bg: var(--checkbox-checked-color);
  --toggle-on-shadow: 0 -4px 10px oklch(from var(--m-checkbox-checked) l c h / 0.35);
  --toggle-face-bg: var(--on-accent);
  --toggle-eye-off: var(--m-checkbox-unchecked);
  --toggle-eye-on: var(--checkbox-checked-color);
  --settings-accent-bg: var(--color-primary);

  /* Highlights - 中国传统色 (co) */
  --highlight-underline: var(--m-highlight-underline);
  --highlight-underline-fade: oklch(from var(--m-highlight-underline) l c h / 0);
  --highlight-text: inherit;
  --highlight-yellow: var(--m-highlight-yellow);
  --highlight-green: var(--m-highlight-green);
  --highlight-blue: var(--m-highlight-blue);
  --highlight-red: var(--m-highlight-red);
  --highlight-purple: var(--m-highlight-purple);
  --highlight-orange: var(--m-highlight-orange);
  --sidebar-icon-color: var(--m-sidebar-icon);
  --sidebar-icon-hover-color: var(--color-primary);
  --sidebar-icon-hover-filter: none;
  --sidebar-title-color-day: var(--m-sidebar-title-day);
  --sidebar-star-color-day: var(--m-sidebar-star-day);

  /* 布局参数（日夜共享；与 lesswrong/system 思路一致） */
  --transition-normal: 0.25s ease;
  --transition-fast: 0.18s ease;
  --border-radius-sm: 6px;
  --border-radius-md: 8px;
  --border-radius-lg: 12px;
  --border-radius-pill: 20px;
  --ui-surface-radius: var(--border-radius-lg);
  --spacing-xs: 3px;
  --spacing-sm: 5px;
  --spacing-md: 6px;
  --spacing-lg: 8px;
  --spacing-xl: 10px;
  --layout-padding-sm: var(--spacing-lg);
  --layout-padding-md: 12px;
  --layout-padding-lg: 16px;
  --layout-padding-xl: 24px;
  --layout-padding-article-v: 24px;
  --layout-padding-article-h: 40px;
  --layout-margin-block: 0.5rem;
  --fs-app-base: 16px;
  --block-spacing: 0; /* 正文块间距：0 为最紧，无空隙；可改为如 0.05em 保留极细缝 */
  --block-row-min-height: 2.05em; /* 正文块行统一最小高度 */
  --ref-block-row-min-height: 1.25em; /* 引用区块行更紧凑 */
  --block-content-line-height: var(--lh-content); /* 正文块展示态与编辑态统一行高 */
  --block-line-min-height: calc(1em * var(--block-content-line-height)); /* 单行最小高度，与行高一致 */
  --lh-display: 1.3;
  --lh-page-title: 1.1;
  --lh-h1: 1.2;
  --lh-h2: 1.3;
  --lh-h3: 1.4;
  --lh-quote: 1.6;
  --lh-content: 1.6;   /* 正文行高，与 --lh-body 一致 */
  --lh-body: 1.6;
  --lh-tag: 1.4;
  --lh-code: 1.7;
  --lh-title: 1.2;
  --fs-page-title: 2.4rem;
  --title-block-line-height: calc(var(--fs-page-title) * var(--lh-page-title));
  --fs-h1: 1.8rem;
  --fs-h2: 1.5rem;
  --fs-h3: 1.25rem;
  --fs-body: 1rem;
  --fs-quote: 1.05rem;
  --fs-tag: 1.05rem;
  --font-size: var(--fs-body);

  color-scheme: light;
}

/* Night Mode - 与日间同标准：黑/灰系（标题·正文·引用·H1-H3 有层次），彩色系（标签·双链·外链 色相环隔开），APCA 负极性 Lc 60–80，禁纯白 */
html.rm-dark-theme,
body.rm-dark-theme,
html.rm-dark-theme .roam-app,
body.rm-dark-theme .roam-app .roam-app,
.rm-dark-theme .roam-app {
  --m-bg: #2B333E;         /* 玄青 - 主背景（固定） */
  --m-surface: #2B333E;    /* 玄青（固定） */
  --m-text: #E6EAE9;       /* 月影白 - 正文 */
  --m-text-muted: #A1AFC9; /* 蓝灰 */
  --m-ink: #161823;        /* 漆黑 - 边框/阴影 */
  --m-primary: #1685A9;    /* 石青 - 主色 */
  --m-secondary: #C83C23;  /* 绯红 - 分裂补色 */
  --m-sidebar-title: #48C0A3;    /* 青碧 */
  --m-sidebar-star: #48C0A3;
  --m-checkbox-checked: #2ADD9C;  /* 碧绿 */
  --m-code-selection: #065279;   /* 靛蓝 */
  --m-on-accent: #E9F1F6;        /* 霜色 - 非纯白 */
  --m-sidebar-icon: #D6ECF0;     /* 月白 */
  --m-popover: #3D3B4F;          /* 玄色 - 弹层 */
  --m-reference-strong: var(--m-sidebar-star);
  --m-warn: #E85A5A;             /* 丹亮 - 警示（夜间可读） */
  /* 灰/白系（层次：由亮到柔，对应日间由深到浅） */
  --m-title-display: #F2ECDE;    /* 缟 - 页面标题（最亮，非纯白） */
  --m-heading-h1: #F2ECDE;       /* 缟 - H1 */
  --m-heading-h2: #E6EAE9;       /* 月影白 - H2 */
  --m-heading-h3: #C8CED8;       /* 灰蓝 - H3 */
  --m-blockquote: #E9F1F6;       /* 霜色 - 引用块正文（高雅浅色） */
  --m-blockquote-bar: #B0A4E3;   /* 雪青 - 引用块竖条（高雅显眼） */
  --m-blockquote-bar-hover: #CCA4E3; /* 丁香 - 引用块竖条 hover */
  /* 彩色系（黄·蓝·红紫，与日间 标签/双链/外链 色相一一对应） */
  --m-page-tag: #75878A;         /* 苍色 - 弱化标签区 */
  --m-tag: #E8A84B;              /* 琥珀亮 - 标签（黄色系） */
  --m-tag-hover: #F0C239;        /* 缃色 - 标签 hover */
  /* 学术标签（Academic Tag）夜间 */
  --tag-text-color: #d1d1d1;
  --tag-border-color: #888888;
  --tag-hover-bg: rgba(255, 255, 255, 0.05);
  --tag-font-weight: 600;
  /* Links 专用（不与 blockquote-bar / sidebar-star / 高亮 重复） */
  --m-page-ref: #2DD4BF;           /* 青绿亮 - 双链（teal，与主色/侧栏星标/原蓝区分） */
  --m-page-ref-hover: #5EEAD4;    /* 青绿浅 - 双链 hover */
  --m-link: #A78BFA;              /* 紫亮 - 外链（violet，与引用条雪青/高亮区分） */
  --m-link-hover: #C4B5FD;        /* 薰衣草 - 外链 hover */
  /* 行内高亮（粉色系，亮色 + 适度透明保证浅字可读） */
  --m-highlight-underline: oklch(from #F47983 l c h / 0.55);
  --m-highlight-yellow: oklch(from #F47983 l c h / 0.52);
  --m-highlight-green: oklch(from #E4C4D8 l c h / 0.50);
  --m-highlight-blue: oklch(from #FFB3A7 l c h / 0.48);
  --m-highlight-red: oklch(from #EF7A82 l c h / 0.55);
  --m-bullet-focus: #F05654;        /* 银红 - bullet 编辑态泛光（有光泽浅红，适配深底） */
  --m-highlight-purple: oklch(from #D2A4C8 l c h / 0.52);
  --m-highlight-orange: oklch(from #F47983 l c h / 0.52);

  --block-highlight-bg: oklch(from var(--m-primary) l c h / 0.20);
  --color-subtle-border: oklch(from var(--m-text) l c h / 0.08);
  --code-bg: oklch(from var(--m-text) l c h / 0.03);
  --inline-code-bg: oklch(from var(--m-page-ref) l c h / 0.22);
  --inline-code-color: var(--m-tag);
  --embed-bg: oklch(from var(--m-text) l c h / 0.03);
  --embed-hover-bg: oklch(from var(--m-text) l c h / 0.06);
  --reference-item-bg: oklch(from var(--m-text) l c h / 0.04);
  --reference-item-hover-bg: oklch(from var(--m-text) l c h / 0.08);
  --kanban-column-bg: oklch(from var(--m-text) l c h / 0.02);
  --kanban-card-bg: oklch(from var(--m-text) l c h / 0.04);
  --kanban-card-hover-bg: oklch(from var(--m-text) l c h / 0.07);
  --popover-shadow: 0 4px 24px oklch(from var(--m-ink) l c h / 0.35);
  --shadow-soft: 0 8px 24px oklch(from var(--m-ink) l c h / 0.32);
  --shadow-floating: 0 10px 30px oklch(from var(--m-ink) l c h / 0.38);
  --focus-ring: 0 0 0 3px oklch(from var(--m-primary) l c h / 0.35);
  --selection-bg: oklch(from var(--m-primary) l c h / 0.58);
  --selection-text: var(--m-on-accent);
  --scrollbar-track: oklch(from var(--m-text) l c h / 0.05);
  --scrollbar-thumb: oklch(from var(--m-primary) l c h / 0.40);
  --scrollbar-thumb-hover: oklch(from var(--m-primary) l c h / 0.55);
  --menu-hover-bg: var(--hover-primary-strong);
  --menu-divider-color: var(--color-subtle-border);
  --menu-hover-text: var(--on-accent);
  --sidebar-hover-bg: oklch(from var(--m-primary) l c h / 0.22);
  --btn-disabled-text: oklch(from var(--m-text) l c h / 0.55);
  --datepicker-day-hover-bg: oklch(from var(--m-text) l c h / 0.10);
  --datepicker-day-hover-text: var(--on-accent);
  --find-input-bg: oklch(from var(--m-text) l c h / 0.05);
  --find-input-focus-bg: var(--bg-color);
  --find-input-focus-shadow: 0 0 0 2px oklch(from var(--m-primary) l c h / 0.30);
  --autocomplete-row-hover-bg: oklch(from var(--m-primary) l c h / 0.15);
  --autocomplete-row-hover-text: var(--text-color);
  --autocomplete-results-bg: var(--page-color);
  --sync-warn-border: var(--m-warn);
  --sync-warn-shadow: 0 0 12px oklch(from var(--m-warn) l c h / 0.25);
  --sync-warn-focus-shadow: 0 0 0 2px oklch(from var(--m-warn) l c h / 0.20), 0 4px 16px oklch(from var(--m-warn) l c h / 0.10);
  --search-hit-bg: oklch(from var(--m-highlight-yellow) l c h / 0.25);
  --autocomplete-match-bg: oklch(from var(--m-highlight-yellow) l c h / 0.20);
  --confirmation-btn-hover-bg: var(--reference-item-hover-bg);
  --reference-divider-color: transparent;
  --reference-icon-hover-bg: oklch(from var(--m-primary) l c h / 0.18);
  --blockquote-bar: var(--m-blockquote-bar);
  --blockquote-text-color: var(--blockquote-text);
  --blockquote-bar-color: var(--m-blockquote-bar);
  --blockquote-bar-hover-color: var(--m-blockquote-bar-hover);
  --highlight-underline: var(--m-highlight-underline);
  --highlight-underline-fade: oklch(from var(--m-highlight-underline) l c h / 0);
  --highlight-text: inherit;
  --highlight-yellow: var(--m-highlight-yellow);
  --highlight-green: var(--m-highlight-green);
  --highlight-blue: var(--m-highlight-blue);
  --highlight-red: var(--m-highlight-red);
  --highlight-purple: var(--m-highlight-purple);
  --highlight-orange: var(--m-highlight-orange);
  --code-warning-surface: var(--popover-bg);
  --code-warning-code-bg: oklch(from var(--m-ink) l c h / 0.55);
  --code-warning-text: var(--on-accent);
  --code-warning-btn-bg: oklch(from var(--m-primary) l c h / 0.20);
  --code-warning-btn-hover-bg: oklch(from var(--m-primary) l c h / 0.28);
  --danger-bg: oklch(from var(--m-highlight-red) l c h / 0.40);
  --danger-border: oklch(from var(--m-text) l c h / 0.10);
  --toggle-off-shadow: 0 4px 10px oklch(from var(--m-secondary) l c h / 0.25);
  --toggle-on-shadow: 0 -4px 10px oklch(from var(--m-checkbox-checked) l c h / 0.30);
  --ink-solid: var(--m-ink);
  --hr-color: var(--m-tag);

  color-scheme: dark;
}

/* Visual system checklist:
 * 色值来自 colors.masantu.com / 0xu.cn 中国传统色；
 * 日间 Lc ≥75，夜间 Lc 60–80，正文非 #FFFFFF；
 * 选择器仅用 index.html DOM；未改 font-family/font-size；
 * 滚动条/::selection 用变量；变量带 Safe Fallback。
 * 权重：主题基础 CSS 权重较高时，可用 .roam-app 提高选择器特异性以替代部分 !important，便于后续微调。 */

/* ========================================================= */
/* 2. Global Overrides (Fix Inline Styles)                   */
/* 已比对 system.css：无相同选择器（本块为 roam 主题覆盖内联/Blueprint），全部保留 */
/* ========================================================= */

body .rm-menu-item[style*="background-color"],
body .rm-menu-item[style*="background"] {
  background-color: var(--color-primary-light) !important;
  color: var(--text-color) !important;
}

body .rm-search-list-item span[style*="background-color: yellow"],
body .rm-search-list-item span[style*="background-color:yellow"] {
  background-color: var(--search-hit-bg) !important;
  color: var(--text-color) !important;
}

:is(html, body):not(.rm-dark-theme) {
  background: var(--m-bg) !important;
}

body:not(.rm-dark-theme) .roam-app {
  background: var(--bg-color) !important;
}

body:not(.rm-dark-theme) .bp3-dark,
body:not(.rm-dark-theme) .bp3-dark .bp3-menu,
body:not(.rm-dark-theme) .bp3-dark .bp3-popover-content {
  background: var(--page-color) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

body:not(.rm-dark-theme) .bp3-dark .bp3-menu-item,
body:not(.rm-dark-theme) .bp3-dark .bp3-button {
  color: var(--text-color) !important;
}

body:not(.rm-dark-theme) .bp3-dark .bp3-button:not([class*="bp3-intent-"]) {
  background: transparent !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

/* 日间：全应用内无 intent 的默认按钮统一用主题色（不依赖 .bp3-dark） */
body:not(.rm-dark-theme) .roam-app .bp3-button:not([class*="bp3-intent-"]) {
  background: var(--embed-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}
body:not(.rm-dark-theme) .roam-app .bp3-button.bp3-minimal:not([class*="bp3-intent-"]) {
  background: transparent !important;
}
body:not(.rm-dark-theme) .roam-app .bp3-button:not([class*="bp3-intent-"]):hover {
  background: var(--sidebar-hover-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

body:not(.rm-dark-theme) .bp3-dark .bp3-menu-item:hover,
body:not(.rm-dark-theme) .bp3-dark .bp3-button:hover,
body:not(.rm-dark-theme) .bp3-dark .bp3-button:not([class*="bp3-intent-"]):hover {
  background: var(--sidebar-hover-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

body:not(.rm-dark-theme) .bp3-dark .bp3-input {
  background: var(--page-color) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

/* 夜间：.bp3-dark 容器内输入框与页面背景统一 */
.rm-dark-theme .bp3-input,
.rm-dark-theme .bp3-dark .bp3-input {
  background: var(--page-color) !important;
}

/* 夜间：.bp3-dark 弹层/菜单/对话框等与主题变量统一（覆盖 site.css 的 --dark-bg/#f5f8fa 等） */
body.rm-dark-theme .bp3-dark,
body.rm-dark-theme .bp3-dark .bp3-menu,
body.rm-dark-theme .bp3-dark .bp3-popover-content,
body.rm-dark-theme :is(.bp3-popover .bp3-popover-content, .bp3-popover2 .bp3-popover2-content),
body.rm-dark-theme .bp3-dialog,
body.rm-dark-theme .bp3-context-menu,
body.rm-dark-theme .bp3-toast,
body.rm-dark-theme .bp3-card {
  background: var(--page-color) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}
body.rm-dark-theme .bp3-dark .bp3-menu-item,
body.rm-dark-theme .bp3-dark .bp3-button {
  color: var(--text-color) !important;
}
body.rm-dark-theme .bp3-dark .bp3-button:not([class*="bp3-intent-"]) {
  background: transparent !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}
body.rm-dark-theme .bp3-dark .bp3-menu-item:hover,
body.rm-dark-theme .bp3-dark .bp3-button:hover,
body.rm-dark-theme .bp3-dark .bp3-button:not([class*="bp3-intent-"]):hover {
  background: var(--sidebar-hover-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}
body.rm-dark-theme .bp3-dark .bp3-input {
  background: var(--page-color) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}
body.rm-dark-theme .roam-app .bp3-button:not([class*="bp3-intent-"]) {
  background: var(--embed-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}
body.rm-dark-theme .roam-app .bp3-button.bp3-minimal:not([class*="bp3-intent-"]) {
  background: transparent !important;
}
body.rm-dark-theme .roam-app .bp3-button:not([class*="bp3-intent-"]):hover {
  background: var(--sidebar-hover-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

/* ========================================================= */
/* 3. Base Layout                                            */
/* 已比对 system.css：版式见 system，此处仅保留配色/字体 */
/* ========================================================= */

.roam-app .roam-article > div {
  background: var(--page-color);
  font-size: var(--fs-app-base);
}

/* 仅标题块自身内容区透明，不作用到其子块（避免回车后新块被当成标题样式）；[style*="background"] 需 !important 覆盖内联 */
body:not(.rm-dark-theme) .roam-app .roam-block-container:is(.rm-level1, .rm-level2, .rm-level3, .rm-heading-level-1, .rm-heading-level-2, .rm-heading-level-3) > .rm-block-main,
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-level1 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-heading-level-1 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-level2 > .rm-block-main :is(.rm-block-main, .rm-block__input, .rm-block-text),
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-heading-level-2 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-level3 > .rm-block-main :is(.rm-block-main, .rm-block__input, .rm-block-text),
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-heading-level-3 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-heading-level-1 > .rm-block-main [style*="background"],
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-heading-level-2 > .rm-block-main [style*="background"],
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-heading-level-3 > .rm-block-main [style*="background"] {
  background: transparent !important;
}

/* .roam-body-main / .roam-main / :has(.rm-title-editing-display) 等：仅版式，已移除 */

/* ========================================================= */
/* 4. Typography                                             */
/* 已比对 system.css：无相同规则块（system 仅 .roam-body .roam-app h1 颜色、.rm-level* 字号），全部保留 */
/* ========================================================= */

/* 应用根字体：第七种 --ui-font 仅作 .roam-app 根；六种格式用下方规则，其余 UI 用 :not 排除正文区后单独设 */
.roam-app {
  font-family: var(--ui-font);
}

/* 非正文区 UI 使用 --ui-font（对齐 system.css 的 div/textarea 全局字体，仅设 font-family 保留 line-height 等） */
.roam-app .roam-sidebar-container,
.roam-app .roam-sidebar-container *,
.roam-app .rm-topbar,
.roam-app .rm-topbar *,
.roam-app .bp3-menu,
.roam-app .bp3-menu-item,
.roam-app .bp3-popover-content,
.roam-app .bp3-popover-content *,
.roam-app .bp3-dialog,
.roam-app .bp3-dialog *,
.roam-app .bp3-button,
.roam-app .bp3-input,
.roam-app .bp3-input-group .bp3-input,
.roam-app .rm-command-palette,
.roam-app .rm-command-palette *,
.roam-app .rm-find-or-create,
.roam-app .rm-find-or-create * {
  font-family: var(--ui-font);
}

.roam-app .bp3-text-overflow-ellipsis,
body .bp3-text-overflow-ellipsis {
  font-family: var(--ui-font) !important;
}

/* 标题字体：仅 h1–h6 与页面标题编辑区，不包含 .rm-level* 以免子块继承 */
.roam-app :is(h1, h2, h3, h4, h5, h6) {
  color: var(--text-color);
  font-family: var(--heading-font);
}

/* .rm-title-editing-display textarea / 标题容器 / focus 等：仅版式，已移除 */

/* 排除 .rm-topbar / .rm-topbar-zen；仅正文区 div/textarea 用 body-font，其余继承 .roam-app 的 --ui-font */
.roam-app .roam-article div,
.roam-app .roam-block-container,
.roam-app .rm-block,
.roam-app .roam-article textarea,
.roam-app .rm-block__input textarea {
  color: var(--text-color);
  font-family: var(--body-font);
  font-size: var(--font-size);
}
.roam-app div:not(.rm-topbar):not(.rm-topbar-zen) {
  color: var(--text-color);
  font-size: var(--font-size);
}
.roam-app textarea {
  color: var(--text-color);
  font-family: var(--body-font);
  font-size: var(--font-size);
}

/* 正文：展示态与编辑态统一行高（同一变量，改一处即同步） */
.roam-app .roam-article,
.roam-app .roam-article .rm-block-text,
.roam-app .roam-article .rm-block__input,
.roam-app .rm-block-text,
.roam-app .roam-block {
  color: var(--text-color);
  font-family: var(--body-font);
  font-size: var(--fs-body);
}

/* 正文块编辑态 textarea 与展示态字号统一 */
.roam-app .roam-article .roam-block-container:not(.rm-level1):not(.rm-level2):not(.rm-level3):not(.rm-heading-level-1):not(.rm-heading-level-2):not(.rm-heading-level-3) .rm-block-main > .rm-block__input textarea,
.roam-app .roam-article .roam-block-container:not(.rm-level1):not(.rm-level2):not(.rm-level3):not(.rm-heading-level-1):not(.rm-heading-level-2):not(.rm-heading-level-3) .rm-block-main .rm-autocomplete__wrapper textarea,
.rm-ref-page-view .roam-block-container:not(.rm-level1):not(.rm-level2):not(.rm-level3):not(.rm-heading-level-1):not(.rm-heading-level-2):not(.rm-heading-level-3) .rm-block-main > .rm-block__input textarea,
.rm-ref-page-view .roam-block-container:not(.rm-level1):not(.rm-level2):not(.rm-level3):not(.rm-heading-level-1):not(.rm-heading-level-2):not(.rm-heading-level-3) .rm-block-main .rm-autocomplete__wrapper textarea {
  font-size: var(--fs-body) !important;
}

.roam-app .roam-article strong,
.roam-app .roam-article b,
.roam-app strong,
.roam-app b {
  color: var(--strong-color);
  font-family: 'Palatino Linotype', 'Palatino', 'FZPingXianYaSong-B', '方正屏显雅宋', serif;
}

.roam-app :is(.rm-title-display-container .rm-title-display, .roam-article .rm-title-display, h1.rm-title-display, .rm-title-display) {
  color: var(--title-display-color);
  font-family: var(--title-font);
  font-size: var(--fs-page-title);
}
/* .rm-title-display-container:has(.rm-title-editing-display)：仅 margin，已移除 */

/* 编辑模式标题与展示模式保持一致（字号、行高统一） */
.roam-app :is(.rm-title-display-container .rm-title-editing-display, .roam-article .rm-title-editing-display, .rm-title-editing-display),
.roam-app .rm-title-editing-display textarea {
  color: var(--title-display-color);
  font-family: var(--title-font);
  font-size: var(--fs-page-title);
}

.roam-app :is(.roam-article .rm-title-display em, .roam-article .rm-title-display i, .rm-title-display em, .rm-title-display i) {
  font-family: 'Arno Pro Display', 'Arno Pro', serif;
}

/* 仅标题块自身内容区，不作用到 .rm-block-children 内子块（回车后新块保持正文） */
.roam-app :is(h1:not(.rm-title-display), .roam-block-container.rm-level1 > .rm-block-main, .roam-block-container.rm-level1 > .rm-block-main .rm-block-text, .roam-block-container.rm-heading-level-1 > .rm-block__self .rm-block__input, .roam-block-container.rm-heading-level-1 > .rm-block-main .rm-block__input, .roam-block-container.rm-heading-level-1 > .rm-block-main .rm-block-text) {
  color: var(--heading-h1-color);
  font-family: var(--heading-font);
  font-size: var(--fs-h1);
}

/* .roam-block-container 间距 / rm-level1 边框等：仅版式，已移除 */

.roam-app .roam-article .roam-block-container.rm-level1 {
  font-size: var(--fs-h1);
  border-color: var(--color-subtle-border);
}

/* H2：Roam 内建选择器权重较高，保留 !important 保证主题生效 */
.roam-app :is(h2, .roam-block-container.rm-level2 > .rm-block-main, .roam-block-container.rm-level2 > .rm-block-main .rm-block-text, .roam-block-container.rm-heading-level-2 > .rm-block__self .rm-block__input, .roam-block-container.rm-heading-level-2 > .rm-block-main .rm-block__input, .roam-block-container.rm-heading-level-2 > .rm-block-main .rm-block-text) {
  color: var(--heading-h2-color) !important;
  font-family: var(--heading-font) !important;
  font-size: var(--fs-h2) !important;
}

.roam-app .roam-article .roam-block-container.rm-level2 {
  font-size: var(--fs-h2);
}

.roam-app :is(h3, .roam-block-container.rm-level3 > .rm-block-main, .roam-block-container.rm-level3 > .rm-block-main .rm-block-text, .roam-block-container.rm-heading-level-3 > .rm-block__self .rm-block__input, .roam-block-container.rm-heading-level-3 > .rm-block-main .rm-block__input, .roam-block-container.rm-heading-level-3 > .rm-block-main .rm-block-text) {
  color: var(--heading-h3-color);
  font-family: var(--heading-font);
  font-size: var(--fs-h3);
}

.roam-app .roam-article .roam-block-container.rm-level3 {
  font-size: var(--fs-h3);
}

/* .rm-heading-level-1/2/3 margin-bottom：仅版式，已移除 */

.roam-app a {
  color: var(--color-secondary);
}

body:not(.rm-dark-theme) .roam-app a:not(.rm-alias--page):not(.rm-alias--block),
body:not(.rm-dark-theme) .roam-app .rm-alias--external {
  color: var(--m-link);
}

body:not(.rm-dark-theme) .roam-app a:not(.rm-alias--page):not(.rm-alias--block):hover,
body:not(.rm-dark-theme) .roam-app .rm-alias--external:hover {
  color: var(--m-link-hover, var(--m-link)) !important;
}

/* .rm-alias--external font-weight / .rm-inline-code line-height 等：仅版式/非 font-size，已移除 */

/* ========================================================= */
/* 5. Code Blocks                                            */
/* 已比对 system.css：无相同规则块（本块用主题变量/字体，system 为硬编码），全部保留 */
/* ========================================================= */

.roam-app .rm-code-block .cm-editor,
.roam-app .rm-code-block .cm-content,
.roam-app .rm-code-block .cm-line,
.roam-app .rm-code-block .cm-gutters {
  background: transparent;
  color: var(--text-color);
  font-family: var(--code-font) !important;
  font-size: 0.875rem;
}

/* 当前行行号：压过 CodeMirror 默认，背景与正文一致，行号用主题色+代码字体 */
.roam-app .cm-focused .cm-activeLineGutter {
  background-color: transparent !important;
  color: var(--color-primary) !important;
  font-family: var(--code-font) !important;
}

.roam-app .roam-article .rm-code-block,
.roam-app .roam-article .rm-inline-code,
.roam-app .rm-code-block,
.roam-app .rm-code-block code,
.roam-app code,
.roam-app kbd,
.roam-app pre {
  font-family: var(--code-font) !important;
  font-size: 0.875rem;
}

.roam-app .rm-code-block {
  background: var(--code-bg);
}

.roam-app .rm-inline-code,
.roam-app code {
  background: var(--inline-code-bg) !important;
  color: var(--inline-code-color) !important;
  border: 1px solid oklch(from var(--m-page-ref) l c h / 0.35) !important;
}

.roam-app .cm-comment,
.roam-app .cm-variable-2,
.roam-app .cm-attribute {
  font-family: 'Operator Mono', monospace;
}

/* 代码块选区：背景用主题变量（system.css 有 .cm-selectionBackground / .cmt-line::selection，此处统一透明 + 变量） */
.roam-app .cm-selectionBackground,
.roam-app .cm-focused .cm-selectionBackground {
  background-color: var(--block-highlight-bg) !important;
}

.roam-app :is(.rm-code-block .cm-line, .cm-content, code)::selection {
  background: transparent !important;
  color: inherit !important;
}

/* 夜间模式：代码块插入符可见（参考 system.css：.bp3-dark .cm-cursor 用 border-left 绘制） */
body.rm-dark-theme .roam-app .rm-code-block .cm-editor,
body.rm-dark-theme .roam-app .rm-code-block .cm-content {
  caret-color: var(--text-color);
}
body.rm-dark-theme .roam-app .rm-code-block .cm-cursor {
  border-left-color: var(--text-color) !important;
}

/* 夜间模式：代码块语法高亮，提升可读性 */
body.rm-dark-theme .roam-app .rm-code-block span.cmt-comment {
  color: #9ca3af !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-atom,
body.rm-dark-theme .roam-app .rm-code-block span.cmt-number {
  color: #c4b5fd !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-comment.cmt-attribute {
  color: #86efac !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-comment.cmt-def {
  color: #fcd34d !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-comment.cmt-tag {
  color: #f9a8d4 !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-comment.cmt-type {
  color: #67e8f9 !important;
}
body.rm-dark-theme .roam-app .rm-code-block .cmt-labelName {
  color: #a5b4fc !important;
}
body.rm-dark-theme .roam-app .rm-code-block .cmt-className {
  color: #22d3ee !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-propertyName,
body.rm-dark-theme .roam-app .rm-code-block span.cmt-attribute {
  color: #86efac !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-keyword {
  color: #f472b6 !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-builtin {
  color: #67e8f9 !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-string,
body.rm-dark-theme .roam-app .rm-code-block span.cmt-string2 {
  color: #fde047 !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-variableName {
  color: #f8fafc !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-variable-2 {
  color: #a5f3fc !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-variable-3,
body.rm-dark-theme .roam-app .rm-code-block span.cmt-typeName {
  color: #67e8f9 !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-def {
  color: #fdba74 !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-bracket {
  color: #f8fafc !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-tag {
  color: #f472b6 !important;
}
body.rm-dark-theme .roam-app .rm-code-block span.cmt-header,
body.rm-dark-theme .roam-app .rm-code-block span.cmt-link {
  color: #c4b5fd !important;
}

/* ========================================================= */
/* 6. Embed & Query                                          */
/* 已比对 system.css：无相同规则块（本块用主题变量），全部保留 */
/* ========================================================= */

.roam-app .rm-embed-container {
  background: var(--embed-bg);
}

.roam-app .rm-embed-container:hover {
  background: var(--embed-hover-bg);
}

/* .rm-query 版式：已移除 */

.roam-app .rm-query .rm-query-title {
  background-color: transparent;
  border-color: var(--color-subtle-border);
  color: var(--light-text-color);
  font-size: 0.8rem;
}

.roam-app .rm-reference-main,
.roam-app .rm-reference-item {
  font-size: 0.95rem;
}

.roam-app .rm-reference-item {
  background-color: var(--reference-item-bg);
}

.roam-app .rm-reference-item:hover {
  background-color: var(--reference-item-hover-bg);
}

.roam-app .rm-unlinked-reference-container strong {
  color: var(--reference-title-color);
}

/* ========================================================= */
/* 7. 左侧边栏（版式来自 system.css，定位见文末）            */
/* 已比对 system.css：与 system 相同版式已删，仅保留 left:0 / bp3-overlay / popover / 配色 */
/* ========================================================= */

/* ---------- 左侧边栏：版式见 system.css，此处仅保留与 system 不同项 ---------- */
/* .roam-sidebar-container left：仅版式，已移除 */

/* ---------- 左侧边栏：roam 配色与字体 ---------- */
.roam-app .roam-sidebar-container {
  background: var(--bg-color) !important;
  background-color: var(--bg-color) !important;
}

/* rm-db-title 区域版式照搬 system.css，配色与字体保留 roam 设置 */
.roam-app .roam-sidebar-container .rm-db-title-container {
  display: flex;
  align-items: center;
  align-content: space-between;
  width: 100%;
  max-width: 100%;
}

.roam-app .roam-sidebar-container .rm-db-title-container:hover {
  cursor: pointer;
}

.roam-app .roam-sidebar-container .rm-db-title-container .rm-db-title {
  padding: 4px;
  overflow: hidden;
  text-overflow: ellipsis;
  display: flex;
  align-items: center;
  font-weight: 600;
  color: var(--sidebar-title-color);
  font-family: 'Felix Titling', '方正清刻本悦宋 简繁', serif;
  font-size: 1.75rem;
  text-align: center;
}

body:not(.rm-dark-theme) .roam-app .roam-sidebar-container .rm-db-title-container .rm-db-title {
  color: var(--sidebar-title-color-day);
}

/* .flex-v-box.starred-pages-wrapper / .roam-sidebar-container .starred-pages-wrapper：仅版式，无配色/字体，已移除 */

.roam-app .starred-pages-wrapper > .flex-h-box.title > span {
  color: var(--sidebar-star-color);
  font-size: 1.05rem;
}

body:not(.rm-dark-theme) .roam-app .starred-pages-wrapper > .flex-h-box.title > span {
  color: var(--sidebar-star-color-day) !important;
}

/* .roam-sidebar-content .starred-pages > a：仅版式，无配色/字体，已移除 */

/* .roam-sidebar-container > *：仅 box-shadow/opacity，已移除 */

.roam-app .roam-sidebar-content .top-row {
  align-items: center;
  padding: 8px 16px;
  justify-content: space-between;
  background: transparent;
  color: var(--text-color);
}

.roam-app .roam-sidebar-content .top-row:hover {
  background: var(--sidebar-hover-bg);
  color: var(--text-color);
}

.roam-app .roam-sidebar-content .log-button {
  background: transparent;
  color: var(--text-color);
  font-size: 1.05rem;
}

.roam-app .roam-sidebar-content .log-button:hover {
  background: var(--sidebar-hover-bg);
  color: var(--text-color);
}

.roam-app .roam-sidebar-content .starred-pages .page {
  background: transparent;
  color: var(--text-color);
}

.roam-app .roam-sidebar-content .starred-pages .page:hover {
  background: var(--sidebar-hover-bg);
  color: var(--text-color);
}

.roam-app .roam-sidebar-content > div > div {
  color: var(--text-color);
  font-size: 1.05rem;
}

body:not(.rm-dark-theme) .roam-app .roam-sidebar-content .log-button,
body:not(.rm-dark-theme) .roam-app .roam-sidebar-content .top-row,
body:not(.rm-dark-theme) .roam-app .roam-sidebar-content .starred-pages .page {
  background: transparent !important;
  color: var(--sidebar-text-day) !important;
}

body:not(.rm-dark-theme) .roam-app .roam-sidebar-content .log-button:hover,
body:not(.rm-dark-theme) .roam-app .roam-sidebar-content .top-row:hover,
body:not(.rm-dark-theme) .roam-app .roam-sidebar-content .starred-pages .page:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--sidebar-text-day) !important;
}

body:not(.rm-dark-theme) .roam-app .roam-sidebar-content > div > div {
  color: var(--sidebar-text-day) !important;
}

.roam-app .bp3-menu.rm-graph-dropdown {
  font-family: var(--body-font);
  font-size: var(--font-size);
  color: var(--text-color);
}

.roam-app .bp3-menu.rm-graph-dropdown .menu-title {
  color: var(--light-text-color);
}

.roam-app .bp3-menu.rm-graph-dropdown .menu-item {
  color: var(--text-color);
  font-size: inherit;
}

.roam-app .bp3-menu.rm-graph-dropdown .menu-item:hover {
  color: var(--menu-hover-text);
}

.roam-app .bp3-menu.rm-graph-dropdown .setting,
.roam-app .bp3-menu.rm-graph-dropdown .bp3-menu-item.setting {
  background-color: transparent;
  color: var(--text-color);
  font-size: var(--font-size);
}

.roam-app .bp3-menu.rm-graph-dropdown .setting {
  border-color: var(--menu-divider-color);
}

.roam-app .bp3-menu.rm-graph-dropdown .setting a {
  color: var(--text-color);
}

.roam-app .bp3-menu.rm-graph-dropdown .setting:hover {
  background-color: var(--menu-hover-bg);
}

.roam-app .bp3-menu.rm-graph-dropdown .setting:hover a {
  color: var(--menu-hover-text);
}

.roam-app .bp3-menu.rm-graph-dropdown .bp3-menu-item .icon.settings {
  color: var(--light-text-color);
}

.roam-app .bp3-menu.rm-graph-dropdown .bp3-menu-item:hover .icon.settings {
  color: var(--menu-hover-text);
}

.roam-app .bp3-menu.rm-graph-dropdown .signout {
  color: var(--text-color);
}

.roam-app .bp3-menu.rm-graph-dropdown .rm-graphs__search .bp3-input,
.roam-app .bp3-menu.rm-graph-dropdown .bp3-input-group.rm-graphs__search .bp3-input {
  background-color: var(--page-color);
  color: var(--text-color);
  font-family: var(--body-font);
  font-size: var(--font-size);
}

.roam-app .bp3-menu.rm-graph-dropdown .rm-graphs__search .bp3-input::placeholder,
.roam-app .bp3-menu.rm-graph-dropdown .bp3-input-group.rm-graphs__search .bp3-input::placeholder {
  color: var(--light-text-color);
}

.roam-app .bp3-menu.rm-graph-dropdown .rm-graphs__search .bp3-icon,
.roam-app .bp3-menu.rm-graph-dropdown .bp3-input-group.rm-graphs__search .bp3-icon {
  color: var(--light-text-color);
}

.roam-app .roam-sidebar-content .bp3-icon {
  color: var(--sidebar-icon-color);
}

.roam-app .roam-sidebar-content .log-button:hover .bp3-icon,
.roam-app .roam-sidebar-content .top-row:hover .bp3-icon {
  color: var(--sidebar-icon-hover-color);
}

.roam-app .roam-sidebar-container .roam-sidebar-content .starred-pages-wrapper {
  color: var(--text-color);
}

.roam-app .roam-sidebar-container .roam-sidebar-content .rm-db-title .expand-icon {
  padding-left: 8px;
  font-size: 12px;
  color: var(--light-text-color);
}

.roam-app .roam-sidebar-container .roam-sidebar-content .rm-db-title .icon {
  background-size: cover;
  margin-right: 8px;
  border: 1px solid var(--color-subtle-border);
  height: 18px;
  width: 18px;
  border-radius: 100px;
}

.roam-app .roam-sidebar-container .roam-sidebar-content .starred-pages-wrapper .starred-pages .rm-dnd-separator .rm-dnd-drop-bar {
  background-color: var(--light-text-color);
}

.roam-app .roam-sidebar-container .rm-graph-dropdown a {
  color: var(--text-color);
}

.roam-app .roam-sidebar-container .rm-graph-dropdown .menu-title {
  color: var(--light-text-color);
}

.roam-app .roam-sidebar-container .rm-graph-dropdown .setting {
  background-color: var(--embed-bg);
}

.roam-app .roam-sidebar-container .rm-graph-dropdown .setting:hover {
  background-color: var(--menu-hover-bg);
}

/* .roam-sidebar-container img[astrolabe]：仅 filter/opacity，已移除 */

.roam-app .roam-sidebar-container img[style*="astrolabe"] ~ span,
.roam-app .roam-sidebar-container img[data-wheelzoom-original-src*="astrolabe"] ~ span {
  color: var(--color-primary) !important;
}

.roam-app #roam-sidebar-logo:hover {
  background: transparent !important;
}

body.rm-dark-theme .roam-app .roam-sidebar-content .top-row:hover,
body.rm-dark-theme .roam-app .roam-sidebar-content .log-button:hover,
body.rm-dark-theme .roam-app .roam-sidebar-content .starred-pages .page:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
}

.roam-app .roam-sidebar-content .starred-pages .page,
.roam-app .roam-sidebar-content .log-button,
.roam-app .roam-sidebar-content .top-row {
  color: var(--text-color) !important;
}

/* ========================================================= */
/* 右侧边栏：版式见 system.css，此处仅保留与 system 不同的配色/字体 */
/* ========================================================= */

/* ---------- 右侧边栏：roam 字体与配色 ---------- */
.roam-app #right-sidebar {
  background-color: var(--bg-color) !important;
  border-color: var(--color-subtle-border);
  color: var(--text-color);
  font-family: var(--body-font);
}

.roam-app #right-sidebar.closed:hover {
  background-color: var(--sidebar-hover-bg) !important;
}

.roam-app #right-sidebar .rm-sidebar-card .rm-sidebar-card-controls {
  border-color: var(--color-subtle-border);
  background-color: var(--bg-color);
}

.roam-app .sidebar-content .rm-dnd-separator .rm-dnd-drop-bar {
  background-color: var(--light-text-color);
}

.roam-app .window-highlight {
  border-color: var(--color-primary);
}

.roam-app .pinned:before {
  color: var(--sidebar-star-color) !important;
}

.roam-app .pinned-to-top:before {
  color: var(--m-warn) !important;
}

.roam-app #right-sidebar .rm-reference-main,
.roam-app #right-sidebar .rm-sidebar-card {
  color: var(--text-color);
  font-family: var(--body-font);
}

.roam-app #right-sidebar .rm-sidebar-outline .rm-title-display,
.roam-app #right-sidebar .rm-sidebar-outline .rm-title-editing-display,
.roam-app #right-sidebar .rm-sidebar-outline .rm-title-editing-display textarea {
  color: var(--title-display-color);
  font-family: var(--title-font) !important;
  font-size: var(--fs-page-title) !important;
  line-height: var(--lh-page-title) !important;
}

.roam-app #right-sidebar .rm-sidebar-outline .roam-block-container,
.roam-app #right-sidebar .rm-zoom .roam-block-container,
.roam-app #right-sidebar .rm-reference-item .roam-block-container {
  color: var(--text-color);
  font-family: var(--body-font);
}

/* 隐藏 multibar（块操作条） */
.roam-app .rm-multibar {
  display: none !important;
}

/* Bullet 圆点：日间 #3D3B4F，夜间浅色系（淡色，不抢眼） */
body:not(.rm-dark-theme) .roam-app .rm-bullet .rm-bullet__inner,
body:not(.rm-dark-theme) .roam-app .rm-bullet.rm-bullet--closed .rm-bullet__inner {
  background-color: #50616D !important;
  border-color: oklch(from #3D3B4F l c h / 0.5) !important;
}
body.rm-dark-theme .roam-app .rm-bullet .rm-bullet__inner,
body.rm-dark-theme .roam-app .rm-bullet.rm-bullet--closed .rm-bullet__inner {
  background-color: #E9F1F6 !important;
  border-color: oklch(from var(--m-text-muted) l c h / 0.5) !important;
}
/* 展示模式：bullet 不显示 border H*/
.roam-app .roam-block-container:not(:focus-within) .rm-bullet .rm-bullet__inner,
.roam-app .roam-block-container:not(:focus-within) .rm-bullet.rm-bullet--closed .rm-bullet__inner {
  border-color: transparent !important;
}
/* 有子块且收起时：bullet 描边（中性柔灰，随主题） */
.roam-app .roam-block-container:not(:focus-within) .rm-bullet.rm-bullet--closed .rm-bullet__inner {
  border-color: oklch(from var(--m-text) l c h / 0.18) !important;
}
/* 编辑态：bullet 红色（无泛光，无 border） */
body:not(.rm-dark-theme) .roam-app .roam-block-container:focus-within .rm-bullet .rm-bullet__inner,
body:not(.rm-dark-theme) .roam-app .roam-block-container:focus-within .rm-bullet.rm-bullet--closed .rm-bullet__inner {
  background-color: oklch(from var(--m-bullet-focus) l c h / 0.68) !important;
  border-color: transparent !important;
}
body.rm-dark-theme .roam-app .roam-block-container:focus-within .rm-bullet .rm-bullet__inner,
body.rm-dark-theme .roam-app .roam-block-container:focus-within .rm-bullet.rm-bullet--closed .rm-bullet__inner {
  background-color:  var(--m-bullet-focus)  !important;
  border-color: transparent !important;
}



/* ========================================================= */
/* 8. Block References & Blockquote                          */
/* ========================================================= */

.roam-app #block-input {
  background: var(--bg-color);
}

.roam-app #block-input > span > div {
  background: var(--bg-color);
}

.roam-app #block-input-ghost span {
  color: var(--text-color) !important;
}




/* .rm-block-ref::before：仅版式，已移除 */

.roam-app .rm-block-ref {
  border-color: var(--m-tag);
  color: var(--text-color);
  font-size: var(--fs-body);
}
.roam-app .rm-block-ref:hover {
  background-color: transparent;
}

.roam-app .block-ref-count-button {
  color: var(--color-primary);
}

/* 引用块：展示态与编辑态 .rm-block__input 字号/样式一致 */
.roam-app :is(.roam-article .rm-bq .rm-block-text, .roam-article .rm-bq .rm-block__input, .roam-article .rm-bq, .rm-bq, blockquote) {
  background: transparent;
  color: var(--blockquote-text-color) !important;
  font-family: var(--quote-font) !important;
  font-size: var(--fs-quote) !important;
}

.roam-app :is(.rm-bq, .roam-article .rm-bq, blockquote) {
  border-left-width: 3px !important;
  border-left-color: var(--blockquote-bar-color) !important;
}
.roam-app :is(.rm-bq, .roam-article .rm-bq, blockquote):hover {
  border-left-color: var(--blockquote-bar-hover-color) !important;
}
.roam-app :is(.rm-bq, .roam-article .rm-bq, blockquote)::before {
  background: var(--blockquote-bar-color);
}
.roam-app :is(.rm-bq, .roam-article .rm-bq, blockquote):hover::before {
  background: var(--blockquote-bar-hover-color);
}

/* .roam-article .rm-bq margin：仅版式，已移除 */

.roam-app :is(.rm-bq, blockquote) :is(em, i) {
  font-family: 'Garamond Premier Pro', 'Garamond', serif !important;
}

.roam-app hr.rm-hr {
  border-width: 1.5px 0 0 0;
  border-color: var(--hr-color);
}

/* Strikethrough 删除线文字：降低灰度，更淡；横线加粗 */
.roam-app .rm-Falsified,
.roam-app .rm-falsified > .rm-block-main,
.roam-app .rm-falsified.rm-block-ref,
.roam-app .rm-strikethrough,
.roam-app s,
.roam-app del,
.roam-app [style*="text-decoration: line-through"],
.roam-app [style*="text-decoration:line-through"] {
  color: oklch(from var(--m-text) l c h / 0.45) !important;
  text-decoration-thickness: 1.5px !important;
}
body.rm-dark-theme .roam-app .rm-Falsified,
body.rm-dark-theme .roam-app .rm-falsified > .rm-block-main,
body.rm-dark-theme .roam-app .rm-falsified.rm-block-ref,
body.rm-dark-theme .roam-app .rm-strikethrough,
body.rm-dark-theme .roam-app s,
body.rm-dark-theme .roam-app del,
body.rm-dark-theme .roam-app [style*="text-decoration: line-through"],
body.rm-dark-theme .roam-app [style*="text-decoration:line-through"] {
  color: oklch(from var(--m-text) l c h / 0.48) !important;
  text-decoration-thickness: 2px !important;
}

.roam-app div > .bp3-icon-caret-down + strong,
.roam-app div > .bp3-icon-caret-right + strong {
  color: var(--tree-node-color) !important;
}

/* 侧栏拖拽条：视觉隐藏，保留拖拽调整宽度功能 */
.roam-app .rm-resize-handle {
  opacity: 0 !important;
  pointer-events: auto;
}
.roam-app .rm-resize-handle:hover {
  opacity: 0 !important;
  background-color: transparent !important;
}

/* ========================================================= */
/* 9. Checkboxes (Smiley Toggle Design)                      */
/* ========================================================= */

.roam-app .check-container {
  position: relative;
  display: inline-block;
  width: 36px;
  height: 18px;
  margin: -5.5px 2px 0 4px;
  vertical-align: middle;
  cursor: pointer;
}

.roam-app .check-container input {
  position: absolute;
  width: 0;
  height: 0;
  opacity: 0;
}

.roam-app .checkmark {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 18px;
  background: var(--toggle-off-bg);
  border: none !important;
  border-radius: 10px;
  box-shadow: var(--toggle-off-shadow);
  transition: 0.5s;
}

.roam-app .check-container input:checked ~ .checkmark {
  background: var(--toggle-on-bg);
  box-shadow: var(--toggle-on-shadow);
  transform: rotate(180deg);
}

.roam-app .smiley-face {
  position: absolute;
  top: 2px;
  left: 2px;
  display: block;
  width: 14px;
  height: 14px;
  background: var(--toggle-face-bg);
  border-radius: 50%;
  transition: 0.5s;
  transition-delay: 0.2s;
}

.roam-app .check-container input:checked ~ .checkmark .smiley-face {
  left: 2px;
  transform: rotate(180deg);
}

.roam-app .checkmark > :not(.smiley-face) {
  display: none !important;
}

/* 隐藏 system.css 用 ::after 画的默认对勾，只保留笑脸 */
.roam-app .check-container .checkmark::after {
  content: none !important;
  display: none !important;
  border: none !important;
}

.roam-app .smiley-face::before {
  content: '';
  position: absolute;
  top: 4px;
  left: 3px;
  width: 2.5px;
  height: 2.5px;
  background: var(--toggle-eye-off);
  border-radius: 50%;
  box-shadow: 6px 0 var(--toggle-eye-off);
  transition: 0.5s;
}

.roam-app .check-container input:checked ~ .checkmark .smiley-face::before {
  background: var(--toggle-eye-on);
  box-shadow: 6px 0 var(--toggle-eye-on);
}

/* 嘴：未勾选 = 哭脸（下弯弧），勾选 = 笑脸（上弯弧） */
.roam-app .smiley-face::after {
  content: '';
  position: absolute;
  bottom: 2.5px;
  left: 50%;
  width: 6px;
  height: 3px;
  background: var(--toggle-eye-off);
  transform: translateX(-50%);
  /* 哭脸：上缘圆角，弧线向下 */
  border-radius: 3px 3px 0 0;
  transition: 0.5s;
}

.roam-app .check-container input:checked ~ .checkmark .smiley-face::after {
  background: var(--toggle-eye-on);
  /* 笑脸：下缘圆角，弧线向上 */
  border-radius: 0 0 3px 3px;
}

.roam-app .check-container input:focus ~ .checkmark {
  box-shadow: 0 0 0 2px var(--bg-color), 0 0 0 4px var(--toggle-eye-on);
}

/* ========================================================= */
/* 10. Kanban                                                */
/* 已比对 system.css：无相同规则块（本块用主题变量），全部保留 */
/* ========================================================= */

.roam-app .kanban-board {
  background: transparent;
}

.roam-app .kanban-card {
  background: var(--kanban-card-bg);
}

.roam-app .kanban-card:hover {
  background: var(--kanban-card-hover-bg);
}

.roam-app .kanban-title {
  border-color: #5C7080;
  color: var(--heading-h2-color);
  font-size: 0.95rem;
}

.roam-app .kanban-column {
  background: var(--kanban-column-bg);
}

/* ========================================================= */
/* 11. Tags & Labels                                         */
/* ========================================================= */

.roam-app .rm-page-ref-brackets {
  display: none;
}

.roam-app span.rm-page-ref {
  border-radius: 2px;
  padding: 0 1px;
}

.roam-app .rm-page-ref--link {
  color: var(--color-primary);
  font-weight: 600;
  letter-spacing: 0;
  text-shadow: none;
  transition: color 0.2s ease, background 0.2s ease, text-decoration 0.2s ease, filter 0.2s ease, letter-spacing 0.2s ease, text-shadow 0.2s ease;
}

body:not(.rm-dark-theme) .roam-app .rm-page-ref--link,
body:not(.rm-dark-theme) .roam-app a.rm-alias--page,
body:not(.rm-dark-theme) .roam-app a.rm-alias--block {
  color: var(--m-page-ref) !important;
  text-decoration: none !important;
  border-bottom: none !important;
  letter-spacing: 0;
  text-shadow: none;
}

body:not(.rm-dark-theme) .roam-app .rm-page-ref--link:hover,
body:not(.rm-dark-theme) .roam-app a.rm-alias--page:hover,
body:not(.rm-dark-theme) .roam-app a.rm-alias--block:hover {
  color: var(--m-page-ref-hover) !important;
  text-decoration: none !important;
  border-bottom: none !important;
  font-weight: 800 !important;
  letter-spacing: 0.03em;
  text-shadow: 0 0 0.5px currentColor, 0 1px 2px rgba(0,0,0,0.08);
}

/* 学术标签（Academic Tag）：小型大写 + 底线下划线，排除 #Streamer 等特殊标签；字体保持 --tag-font */
.roam-app span.rm-page-ref--tag:not([data-tag="Streamer"]),
.roam-app span.rm-page-ref[data-tag]:not([data-tag="Streamer"]) {
  color: var(--tag-text-color) !important;
  font-family: var(--tag-font), var(--body-font) !important;
  font-size: var(--fs-tag) !important;
  font-weight: var(--tag-font-weight);
  font-variant: small-caps;
  letter-spacing: 0.05em;
  line-height: var(--lh-tag) !important;
  padding: 0 2px 1px 2px !important;
  border-bottom: 1.5px solid var(--tag-border-color) !important;
  border-radius: 0 !important;
  background: transparent !important;
  text-decoration: none !important;
  transition: color 0.2s ease-in-out, background 0.2s ease-in-out, border-bottom-color 0.2s ease-in-out;
}

.roam-app span.rm-page-ref--tag:not([data-tag="Streamer"]):hover,
.roam-app span.rm-page-ref[data-tag]:not([data-tag="Streamer"]):hover {
  background: var(--tag-hover-bg) !important;
  border-bottom-color: var(--tag-text-color) !important;
}

/* ========================================================= */
/* 12. Highlights (.rm-highlight 相关，参考 system.css)      */
/* 已比对 system.css：本块用主题变量，与 system 硬编码色不同，全部保留 */
/* ========================================================= */

/* 文字高亮 */
.roam-app .rm-highlight {
  background: linear-gradient(180deg, var(--highlight-underline-fade) 60%, var(--highlight-underline) 60%);
  color: var(--highlight-text);
}

.roam-app .block-highlight-blue {
  background: var(--block-highlight-bg);
}


/* ========================================================= */
/* 13. Settings & Plugins                                    */
/* 已比对 system.css：顶栏版式已删仅保留配色/字体；Speech to Roam 隐藏、find-or-create 等为 roam 独有 */
/* ========================================================= */

/* ---------- 顶栏 / dropzone / find-or-create / sync：roam 配色与字体 ---------- */
.roam-app .rm-topbar,
.roam-app .rm-topbar-zen {
  background-color: var(--bg-color);
  color: var(--text-color);
  font-family: var(--body-font);
}

.roam-app .rm-files-dropzone--active {
  background-color: var(--sidebar-hover-bg) !important;
}

#find-or-create-input {
  background-color: var(--find-input-bg) !important;
  color: var(--text-color) !important;
  font-family: var(--body-font);
  }

.rm-find-or-create-wrapper .bp3-icon-search {
  color: var(--light-text-color) !important;
}

#find-or-create-input:focus {
  background-color: var(--find-input-focus-bg) !important;
  border-color: var(--color-primary) !important;
}

.roam-app .rm-find-or-create-wrapper .rm-menu-item .rm-search-title .rm-label {
  color: var(--color-primary);
}

.roam-app .rm-find-or-create-wrapper .rm-menu-item .rm-search-list-item-title,
.roam-app .rm-find-or-create-wrapper .rm-menu-item .rm-search-list-item {
  color: var(--light-text-color);
  font-family: var(--body-font);
}

.roam-app .rm-sync--saving-local {
  background-color: var(--m-warn);
}

.roam-app .rm-sync--saving-remote {
  background-color: var(--color-secondary);
}

.roam-app .rm-sync--synced {
  background-color: var(--checkbox-checked-color);
}

.bp3-popover .bp3-popover-content:has(.rm-find-or-create__menu) {
  background-color: var(--page-color) !important;
  border-color: var(--color-subtle-border) !important;
}

.bp3-menu.rm-find-or-create__menu {
  background-color: transparent !important;
  color: var(--text-color);
  font-family: var(--body-font);
}

.bp3-menu.rm-find-or-create__menu .rm-menu-item:hover,
.bp3-menu.rm-find-or-create__menu .rm-menu-item.bp3-active {
  background-color: var(--color-primary-light) !important;
}

.bp3-menu.rm-find-or-create__menu .rm-menu-item:hover .rm-search-title,
.bp3-menu.rm-find-or-create__menu .rm-menu-item.bp3-active .rm-search-title,
.bp3-menu.rm-find-or-create__menu .rm-menu-item:hover .rm-search-list-item-title,
.bp3-menu.rm-find-or-create__menu .rm-menu-item.bp3-active .rm-search-list-item-title {
  color: var(--color-primary) !important;
}

.rm-find-or-create__menu .rm-new-page {
  color: var(--color-secondary) !important;
}

.rm-sync-tooltip__content {
  font-family: var(--body-font);
}

.rm-sync-tooltip__title {
  color: var(--text-color) !important;
  font-family: var(--heading-font) !important;
  font-size: 1.1rem !important;
}

.rm-sync-tooltip__text,
.rm-sync-tooltip__content > div > div {
  color: var(--text-color) !important;
  font-family: var(--body-font) !important;
  font-size: 0.95rem !important;
}

.rm-sync-tooltip__text strong {
  color: var(--color-primary) !important;
}

.rm-sync-tooltip__last-sync-time {
  color: var(--light-text-color) !important;
  font-size: 0.85rem !important;
  font-family: var(--code-font) !important;
}

.rm-sync-tooltip__content .bp3-divider {
  border-bottom-color: var(--color-subtle-border) !important;
}

/* Tooltip */
.bp3-tooltip .bp3-popover-content div {
  color: var(--tooltip-text);
}

.rm-extensions-settings .rm-extensions-installed .rm-extension-installed__name {
  font-size: 0.875rem;}

/* Hotkeys */
.rm-hotkeys-action,
.rm-settings-panel__section .rm-depot-readme-wrapper h1,
.rm-settings-panel__section .rm-depot-readme-wrapper h2,
.rm-settings-panel__section .rm-depot-readme-wrapper h3,
.rm-settings-panel__section .rm-depot-readme-wrapper p,
.rm-settings-panel__section .rm-depot-readme-wrapper li,
.rm-settings-panel__section .rm-depot-readme-wrapper a,
.rm-settings-panel__section .rm-depot-readme-wrapper strong {
  color: var(--color-primary);
}

/* Disabled button */
.bp3-button.bp3-disabled,
.bp3-button.bp3-disabled .bp3-button-text {
  color: var(--btn-disabled-text) !important;
}

:is(.bp3-popover .bp3-popover-content, .bp3-popover2 .bp3-popover2-content),
.bp3-dialog,
.bp3-context-menu,
.bp3-toast,
.bp3-card,
.rm-command-palette {
  background: var(--ui-surface-bg) !important;
  color: var(--ui-surface-text) !important;
}

/* bp3-popover 相关版式照搬 system.css，配色与字体保留 roam 设置 */
.roam-app .rm-capture-suggest-popover {
  max-width: 80vw;
  width: 80vw;
}
.roam-app .rm-page-ref-popover__header {
  padding: 6px 8px 6px;
  text-align: center;
}
.roam-app .rm-page-ref-popover .rm-line {
  margin-top: 0;
}
.roam-app .rm-block-text .bp3-popover-target {
  display: inline;
}
.roam-app .rm-query-options-popover-content .bp3-control {
  margin: 0;
  padding: 5px 7px;
  user-select: none;
}
.roam-app .rm-query-options-popover-content .bp3-menu-header {
  margin-left: 0;
}
.roam-app .rm-query-options-popover-content .bp3-button-group {
  width: 100%;
  justify-content: center;
}
.roam-app .rm-query-options-content,
.roam-app .rm-search-query-options-content {
  padding: 8px 8px 0 8px;
  overflow: hidden;
}
.roam-app .rm-extensions-settings .rm-extensions-installed__header {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
}
.roam-app .rm-query-builder-popover .bp3-menu-header {
  margin-left: 2px;
}
.roam-app .rm-tag-selector-popover {
  width: 250px;
}
.roam-app .rm-pages-more-info-popover {
  padding: 8px 8px;
}

.bp3-menu {
  font-family: var(--body-font);
  background: transparent !important;
  color: var(--text-color) !important;}

.bp3-menu-item {
  color: var(--text-color) !important;}

/* .bp3-menu-item .bp3-fill：仅 flex 版式，已移除 */

/* .bp3-menu-item .bp3-menu-item-label：仅 display，已移除 */

.bp3-menu-item:hover,
.bp3-menu-item.bp3-active {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;
}

.bp3-menu-item .bp3-icon {
  color: var(--light-text-color);
}

.bp3-menu-item:hover .bp3-icon,
.bp3-menu-item.bp3-active .bp3-icon {
  color: var(--menu-hover-text) !important;
}

/* .bp3-menu li:has(a.rm-install-menu-item) / a.bp3-menu-item.rm-install-menu-item：仅版式，已移除 */

/* 页面标题 ⋮ 菜单：隐藏链接下划线高亮 */
.bp3-popover-arrow-fill {
  fill: var(--popover-bg) !important;
}

.bp3-popover-arrow-border {
  fill: transparent !important;
}

/* 块右键菜单：内联样式按钮（对齐 / H1–H3）覆盖为主题色 */
.bp3-popover-content .bp3-menu .flex-h-box button {
  background-color: var(--embed-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

.bp3-popover-content .bp3-menu .flex-h-box button:hover {
  background-color: var(--menu-hover-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--menu-hover-text) !important;
}

.bp3-popover-content .bp3-menu .flex-h-box button .bp3-icon-standard,
.bp3-popover-content .bp3-menu .flex-h-box button .bp3-icon {
  color: var(--light-text-color) !important;
}

.bp3-popover-content .bp3-menu .flex-h-box button:hover .bp3-icon-standard,
.bp3-popover-content .bp3-menu .flex-h-box button:hover .bp3-icon {
  color: var(--menu-hover-text) !important;
}

.bp3-popover-content .bp3-menu .flex-h-box button[style*="rgba(72, 176, 240"] {
  background-color: var(--color-primary-light) !important;
  border-color: oklch(from var(--m-primary) l c h / 0.35) !important;
}

.bp3-popover-content .bp3-menu .flex-h-box button[style*="rgba(72, 176, 240"] .bp3-icon-standard,
.bp3-popover-content .bp3-menu .flex-h-box button[style*="rgba(72, 176, 240"] .bp3-icon {
  color: var(--color-primary) !important;
}

.bp3-popover-content .bp3-menu .bp3-menu-divider {
  border-color: var(--color-subtle-border);
}

.bp3-overlay:has(.rm-modal-dialog--confirmation-with-content) .bp3-overlay-backdrop {
  background-color: var(--bg-color) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content,
.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-dialog.rm-close-pinned-sidebar-window {
  background-color: transparent !important;
  color: var(--text-color) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-header {
  color: var(--text-color) !important;
  font-family: inherit !important;
  font-size: 1.05rem !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content,
.bp3-dialog.rm-modal-dialog--confirmation-with-content .rm-close-pinned-sidebar-window__content {
  color: var(--text-color) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .rm-bq.rm-sidebar-window-display-str {
  background: transparent !important;
  border-color: var(--color-primary);
  color: var(--text-color) !important;
  font-family: inherit !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .rm-close-pinned-sidebar-window__content__end-hint {
  color: var(--text-color) !important;
  font-size: 0.9rem;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-buttons .bp3-button {
  color: var(--text-color) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-buttons .bp3-button.bp3-minimal:hover {
  background-color: var(--confirmation-btn-hover-bg) !important;
  color: var(--text-color) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-buttons .confirm-button.bp3-intent-primary {
  background-color: var(--color-primary) !important;
  border-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-buttons .confirm-button.bp3-intent-primary:hover {
  background-color: var(--color-primary-light) !important;
  border-color: var(--color-primary-light) !important;
  color: var(--on-accent) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-buttons .bp3-button .bp3-icon {
  color: inherit !important;
}

/* Live AI Chat 面板 (full-results-modal)：日夜间配色与字体 */
.bp3-dialog.full-results-modal,
.bp3-dialog.full-results-modal .full-results-header,
.bp3-dialog.full-results-modal .full-results-content-container,
.bp3-dialog.full-results-modal .full-results-chat-container,
.bp3-dialog.full-results-modal .full-results-chat-panel,
.bp3-dialog.full-results-modal .full-results-chat-messages,
.bp3-dialog.full-results-modal .full-results-chat-input-area {
  background: var(--page-color) !important;
  color: var(--text-color);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-title.bp3-heading {
  color: var(--title-display-color);
  font-family: var(--heading-font);
}

.bp3-dialog.full-results-modal .full-results-control-button,
.bp3-dialog.full-results-modal .full-results-close-button {
  color: var(--light-text-color);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-control-button:hover,
.bp3-dialog.full-results-modal .full-results-close-button:hover {
  color: var(--text-color);
  background-color: var(--menu-hover-bg);
}

.bp3-dialog.full-results-modal .full-results-control-button .bp3-icon,
.bp3-dialog.full-results-modal .full-results-close-button .bp3-icon {
  color: inherit;
}

.bp3-dialog.full-results-modal .edge-hover-button {
  color: var(--light-text-color);
  background: transparent;
}

.bp3-dialog.full-results-modal .edge-hover-button:hover {
  color: var(--color-primary);
  background-color: var(--hover-primary-soft);
}

.bp3-dialog.full-results-modal .full-results-chat-header,
.bp3-dialog.full-results-modal .full-results-chat-info-text,
.bp3-dialog.full-results-modal .full-results-chat-info-text span {
  color: var(--light-text-color);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-chat-welcome,
.bp3-dialog.full-results-modal .full-results-chat-assistant-message {
  color: var(--text-color);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-chat-assistant-message.chat-help p,
.bp3-dialog.full-results-modal .full-results-chat-assistant-message.chat-help strong {
  color: var(--text-color);
}

.bp3-dialog.full-results-modal .full-results-chat-assistant-message.chat-help div[style*="font-size: 12px"] {
  color: var(--light-text-color);
}

.bp3-dialog.full-results-modal .full-results-chat-suggestions button {
  color: var(--text-color);
  background-color: var(--embed-bg);
  border-color: var(--color-subtle-border);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-chat-suggestions button:hover {
  color: var(--menu-hover-text);
  background-color: var(--menu-hover-bg);
  border-color: var(--color-subtle-border);
}

.bp3-dialog.full-results-modal .full-results-chat-suggestions button .bp3-icon {
  color: var(--light-text-color);
}

.bp3-dialog.full-results-modal .full-results-chat-suggestions button:hover .bp3-icon {
  color: inherit;
}

.bp3-dialog.full-results-modal .full-results-chat-input.bp3-input {
  background: var(--page-color);
  color: var(--text-color);
  border-color: var(--color-subtle-border);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-chat-input.bp3-input::placeholder {
  color: var(--light-text-color);
}

.bp3-dialog.full-results-modal .full-results-chat-input.bp3-input:focus {
  background: var(--page-color);
  border-color: var(--color-primary);
}

.bp3-dialog.full-results-modal .full-results-chat-controls .bp3-button,
.bp3-dialog.full-results-modal .full-results-chat-access-mode .bp3-button,
.bp3-dialog.full-results-modal .full-results-chat-tools-menu .bp3-button,
.bp3-dialog.full-results-modal .full-results-chat-style-selector .bp3-button,
.bp3-dialog.full-results-modal .full-results-chat-command-suggest .bp3-button,
.bp3-dialog.full-results-modal .full-results-chat-model-selector .bp3-button {
  color: var(--light-text-color);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-chat-controls .bp3-button:hover,
.bp3-dialog.full-results-modal .full-results-chat-access-mode .bp3-button:hover,
.bp3-dialog.full-results-modal .full-results-chat-tools-menu .bp3-button:hover,
.bp3-dialog.full-results-modal .full-results-chat-style-selector .bp3-button:hover,
.bp3-dialog.full-results-modal .full-results-chat-command-suggest .bp3-button:hover,
.bp3-dialog.full-results-modal .full-results-chat-model-selector .bp3-button:hover {
  color: var(--text-color);
  background-color: var(--menu-hover-bg);
}

.bp3-dialog.full-results-modal .full-results-chat-send:not(.bp3-disabled) {
  color: var(--on-accent);
  background-color: var(--color-primary);
}

.bp3-dialog.full-results-modal .full-results-chat-send:not(.bp3-disabled):hover {
  background-color: var(--color-primary-light);
  color: var(--on-accent);
}

.bp3-dialog.full-results-modal .full-results-chat-send.bp3-disabled,
.bp3-dialog.full-results-modal .full-results-chat-send.bp3-disabled .bp3-icon {
  color: var(--btn-disabled-text);
}

.bp3-dialog.full-results-modal .bp3-intent-primary .bp3-icon,
.bp3-dialog.full-results-modal .bp3-intent-success .bp3-icon,
.bp3-dialog.full-results-modal .full-results-chat-help-avatar .bp3-icon {
  color: inherit;
}

/* Live AI 命令菜单 (str-aicommands-menu)：不透明背景与可读文字 */
.bp3-menu.str-aicommands-menu,
.bp3-popover-content:has(.bp3-menu.str-aicommands-menu) {
  background: var(--page-color) !important;
  color: var(--text-color);
  font-family: var(--body-font);
}

.bp3-menu.str-aicommands-menu .aicommands-topbar,
.bp3-menu.str-aicommands-menu .aicommands-topbar > div:first-child {
  color: var(--title-display-color);
  font-family: var(--heading-font);
}

.bp3-menu.str-aicommands-menu .laia-topbar-icons .bp3-icon,
.bp3-menu.str-aicommands-menu .aicommands-topbar .bp3-icon {
  color: var(--light-text-color);
}

.bp3-menu.str-aicommands-menu .laia-topbar-icons .bp3-icon:hover,
.bp3-menu.str-aicommands-menu .aicommands-topbar .bp3-icon:hover {
  color: var(--color-primary);
}

.bp3-menu.str-aicommands-menu .menu-hint,
.bp3-menu.str-aicommands-menu .bp3-menu-header.menu-hint,
.bp3-menu.str-aicommands-menu .bp3-menu-header.menu-hint .bp3-heading,
.bp3-menu.str-aicommands-menu .bp3-menu-header.menu-hint h6 {
  color: var(--light-text-color);
  font-family: var(--body-font);
}

.bp3-menu.str-aicommands-menu .bp3-menu-header.menu-hint b {
  color: var(--text-color);
}

.bp3-menu.str-aicommands-menu .aicommands-context,
.bp3-menu.str-aicommands-menu .aicommands-context strong,
.bp3-menu.str-aicommands-menu .aicommands-context label,
.bp3-menu.str-aicommands-menu .aicommands-style,
.bp3-menu.str-aicommands-menu .aicommands-style .bp3-html-select {
  color: var(--text-color);
  font-family: var(--body-font);
}

.bp3-menu.str-aicommands-menu .bp3-control.bp3-checkbox {
  color: var(--text-color);
}

.bp3-menu.str-aicommands-menu .bp3-control-indicator {
  border-color: var(--color-subtle-border);
  background-color: var(--embed-bg);
}

.bp3-menu.str-aicommands-menu .bp3-control input:checked ~ .bp3-control-indicator {
  background-color: var(--color-primary);
  border-color: var(--color-primary);
}

.bp3-menu.str-aicommands-menu .str-aicommands-input .bp3-input,
.bp3-menu.str-aicommands-menu .bp3-input-group.str-aicommands-input .bp3-input {
  background: var(--page-color) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border);
  font-family: var(--body-font);
}

.bp3-menu.str-aicommands-menu .str-aicommands-input .bp3-input::placeholder,
.bp3-menu.str-aicommands-menu .bp3-input-group.str-aicommands-input .bp3-input::placeholder {
  color: var(--light-text-color);
}

.bp3-menu.str-aicommands-menu .str-aicommands-input .bp3-icon,
.bp3-menu.str-aicommands-menu .bp3-input-group.str-aicommands-input .bp3-input-left-container .bp3-icon {
  color: var(--light-text-color);
}

.bp3-menu.str-aicommands-menu .bp3-html-select select,
.bp3-menu.str-aicommands-menu .bp3-html-select .bp3-icon {
  color: var(--text-color);
  background-color: var(--embed-bg);
  border-color: var(--color-subtle-border);
}

.bp3-menu.str-aicommands-menu .bp3-input-action .bp3-html-select select {
  color: var(--light-text-color);
}

.bp3-menu.str-aicommands-menu .bp3-input-action .bp3-html-select .bp3-icon {
  color: var(--light-text-color);
}

.rm-settings .rm-settings-panel .rm-settings-panel__description {
  color: var(--light-text-color);
  font-family: var(--body-font) !important;}

.rm-settings,
.rm-settings-panel__section,
.rm-settings-panel__section h4,
.rm-settings-panel__contents {
  font-family: var(--body-font) !important;
}

.rm-settings .rm-settings-panel__section h1,
.rm-settings .rm-settings-panel__section h2,
.rm-settings .rm-settings-panel h3,
.rm-settings .rm-settings-panel__section h4,
.rm-settings .rm-settings-panel__section h5,
.rm-settings .rm-settings-panel__section h6 {
  color: var(--heading-h2-color) !important;
}

.rm-settings input[type="text"] {
  background-color: var(--embed-bg);
}

.rm-extensions-installed__header,
.rm-extension-installed__name {
  color: var(--text-color);
}

.rm-extensions-marketplace .rm-extensions-marketplace-search,
.rm-extensions-marketplace .rm-extensions-marketplace-details {
  background-color: var(--bg-color);
}

.rm-extensions-marketplace .rm-extensions-marketplace-search__settings input {
  background-color: var(--page-color);
  border-color: #394B59;}

/* 日间模式：扩展市场弹窗内全部改为深色字，避免白字白底 */
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace {
  background-color: var(--page-color) !important;
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .bp3-dialog-header,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .bp3-dialog-header .bp3-heading,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .bp3-dialog-close-button,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .bp3-dialog-close-button .bp3-icon {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .bp3-dialog-close-button:hover {
  color: var(--text-color) !important;
  background-color: var(--sidebar-hover-bg) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-search,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-details {
  background-color: var(--page-color) !important;
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-search__settings input {
  background-color: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-search__settings input::placeholder {
  color: var(--light-text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-search__settings > div {
  color: var(--light-text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-search__settings .bp3-button.bp3-minimal,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-search__settings .bp3-button .bp3-icon {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-small__name {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-small__author,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-small__downloads,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-small__desc {
  color: var(--light-text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-small:hover .rm-extension-small__name {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-small .bp3-tag.bp3-intent-primary {
  background-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__name {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__stats dt {
  color: var(--light-text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__stats dd {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__stats a {
  color: var(--reference-title-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__desc,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__downloads {
  color: var(--light-text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__readme,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-depot-readme-wrapper,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__readme p,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__readme li,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__readme h1,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__readme h2 {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__controls .bp3-button.bp3-intent-primary {
  background-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__controls .bp3-button.bp3-intent-primary:hover {
  background-color: var(--color-primary-light) !important;
  color: var(--on-accent) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog hr {
  border-color: var(--color-subtle-border) !important;
}

.rm-settings .rm-settings-panel .rm-select-wrapper {
  background-color: var(--embed-bg);
  border-color: #293742;
  color: var(--text-color);}

.rm-settings .rm-settings-panel .rm-select-wrapper .bp3-button,
.rm-settings .rm-settings-panel .rm-select-wrapper .bp3-popover-target .bp3-button {
  background-color: var(--embed-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

.rm-settings .rm-settings-panel .rm-select-wrapper .bp3-button:hover {
  background-color: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
}

.bp3-tabs.rm-settings-tabs,
.bp3-tabs.rm-settings-tabs .bp3-tab-list,
.bp3-tabs.rm-settings-tabs .bp3-tab-panel,
.rm-settings-panel,
.rm-settings-panel__contents {
  background: var(--page-color) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

.bp3-tabs.rm-settings-tabs .bp3-tab-list {
  border-color: var(--color-subtle-border) !important;
}

.rm-settings-heading,
.rm-extension-settings-heading {
  color: var(--heading-h1-color) !important;
  font-family: var(--heading-font) !important;
}

.bp3-tab.rm-settings__tab {
  background: transparent !important;
  color: var(--text-color) !important;
  font-family: var(--body-font) !important;
}

.bp3-dialog.rm-modal-dialog--settings .bp3-tab.rm-settings__tab,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .bp3-tab.rm-settings__tab {
  font-family: var(--body-font) !important;
}

.bp3-tab.rm-settings__tab:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
}

.bp3-tab.rm-settings__tab[aria-selected="true"],
body:not(.rm-dark-theme) .rm-settings--desktop .rm-settings__tab:not(.rm-settings__panel-wrapper)[aria-selected="true"] {
  background: var(--color-primary-light) !important;
  color: var(--text-color) !important;
}

.bp3-tab-panel.rm-settings__panel-wrapper,
.rm-settings-panel,
.rm-settings-panel__contents,
.rm-settings-panel__contents .rm-extensions-settings {
  background: var(--page-color) !important;
  color: var(--text-color) !important;
}

.rm-settings-panel__contents .rm-extensions-settings .rm-settings-panel__section h4,
.rm-settings-panel__contents .rm-extensions-settings .rm-settings-panel__description {
  color: var(--heading-h2-color) !important;
}

.rm-settings-panel__contents .rm-extensions-settings .rm-settings-panel__description,
.rm-settings-panel__contents .rm-extensions-installed__header,
.rm-settings-panel__contents .rm-extension-installed__name {
  color: var(--text-color) !important;
}

.rm-settings-panel__contents .rm-extension-installed__desc {
  color: var(--light-text-color) !important;
}

.rm-settings-panel__contents .rm-extensions-settings .bp3-button.bp3-intent-primary {
  background: var(--color-primary) !important;
  border-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

.rm-settings-panel__contents .rm-extensions-settings .bp3-button.bp3-intent-primary:hover {
  background: var(--color-primary-light) !important;
  border-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

.rm-settings-panel__contents .rm-extensions-settings .bp3-button.bp3-minimal,
.rm-settings-panel__contents .rm-extension-installed .bp3-button.bp3-minimal {
  color: var(--text-color) !important;
}

.rm-settings-panel__contents .rm-extensions-settings .bp3-button.bp3-minimal:hover,
.rm-settings-panel__contents .rm-extension-installed .bp3-button.bp3-minimal:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
}

/* 右侧内容区任意 section 文字兜底（含 User/Sharing/Account 等非 panel-config 页） */
.rm-settings-panel__contents .rm-settings-panel__section h4,
.rm-settings-panel__contents .rm-settings-panel__section .rm-settings-panel__description {
  color: var(--text-color) !important;
}

.rm-settings-panel__contents .rm-settings-panel__section h4 {
  color: var(--heading-h2-color) !important;
}

.rm-settings-panel__panel-config {
  background: var(--embed-bg) !important;
  border-color: var(--color-subtle-border) !important;
}

.rm-settings-panel__panel-config .rm-settings-panel__section h4,
.rm-settings-panel__panel-config .rm-settings-panel__section h3,
.rm-settings-panel__panel-config .rm-settings-panel__section .rm-settings-panel__description,
.rm-settings-panel__panel-config .rm-settings-panel__description {
  color: var(--text-color) !important;
}

.rm-settings-panel__panel-config .rm-settings-panel__section h4 {
  color: var(--heading-h2-color) !important;
}

/* 第三方插件设置页：描述内 span/br 不单独设色，链接用主色 */
.rm-settings-panel__panel-config .rm-settings-panel__description span,
.rm-settings-panel__panel-config .rm-settings-panel__description a {
  color: inherit !important;
}

.rm-settings-panel__panel-config .rm-settings-panel__description a {
  color: var(--color-primary) !important;
}

.rm-settings-panel__panel-config .rm-settings-panel__description strong {
  color: var(--heading-h2-color) !important;
}

/* 插件设置：输入框（含 class=rm-settings-panel__value 的 input） */
.rm-settings-panel__panel-config input.rm-settings-panel__value,
.rm-settings-panel__panel-config .rm-settings-panel__section input[type="text"],
.rm-settings-panel__panel-config .rm-settings-panel__section input[type="password"] {
  background-color: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border: 1px solid var(--color-subtle-border) !important;
}

.rm-settings-panel__panel-config input::placeholder {
  color: var(--light-text-color) !important;
}

/* 插件设置：下拉按钮（Orange / topRight / gemini-3... 等文字可见） */
.rm-settings-panel__panel-config .rm-settings__permissions-button,
.rm-settings-panel__panel-config .bp3-button.bp3-minimal.rm-settings__permissions-button {
  background: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border) !important;
}

.rm-settings-panel__panel-config .rm-settings__permissions-button:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-primary) !important;
}

/* panel-config 内任意子元素文字兜底（第三方插件未知结构） */
.rm-settings-panel__panel-config .rm-settings__permissions-button .bp3-button-text,
.rm-settings-panel__panel-config .rm-settings__permissions-button .bp3-icon,
.rm-settings-panel__panel-config .rm-settings-panel__section {
  color: var(--text-color) !important;
}

/* Section 标题与描述 */
.rm-settings-panel__section h4,
.rm-settings-panel__section h3,
.rm-settings-panel__section .rm-settings-panel__section h4 {
  color: var(--heading-h2-color) !important;
}

.rm-settings-panel__section h3 {
  color: var(--heading-h1-color) !important;
}

.rm-settings-panel__description,
.rm-settings-panel__section .rm-settings-panel__description {
  color: var(--light-text-color) !important;
}

/* .rm-settings-panel .bp3-input-group 等：仅版式，已移除 */

/* 输入框、下拉、按钮（面板内统一） */
.rm-settings-panel .bp3-input,
.rm-settings-panel input[type="text"],
.rm-settings-panel input[type="password"] {
  background-color: var(--page-color) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border) !important;
}

.rm-settings-panel .bp3-input::placeholder,
.rm-settings-panel input::placeholder {
  color: var(--light-text-color) !important;
}

.rm-settings-panel .bp3-button.bp3-minimal {
  color: var(--text-color) !important;
}

.rm-settings-panel .bp3-button.bp3-minimal:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
}

.rm-settings-panel .bp3-button.bp3-intent-primary {
  background: var(--color-primary) !important;
  border-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

.rm-settings-panel .bp3-button.bp3-intent-primary:hover {
  background: var(--color-primary-light) !important;
  border-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

.rm-settings-panel .bp3-button.bp3-intent-warning {
  color: var(--text-color) !important;
}

.rm-settings-panel .bp3-button.bp3-intent-danger {
  color: var(--on-accent) !important;
}

/* Switch / Radio 控件：与主题一致 */
.rm-settings-panel .bp3-control-indicator {
  background-color: var(--embed-bg) !important;
  border: 1px solid var(--color-subtle-border) !important;
}

.rm-settings-panel .bp3-control input:checked ~ .bp3-control-indicator {
  background-color: var(--checkbox-checked-color) !important;
  border-color: var(--checkbox-checked-color) !important;
}

.rm-settings-panel .bp3-control:hover .bp3-control-indicator {
  border-color: var(--color-primary) !important;
}

.rm-settings-panel .bp3-radio .bp3-control-indicator::before {
  background-color: var(--text-color) !important;
}

.rm-settings-panel .bp3-radio input:checked ~ .bp3-control-indicator::before {
  background-color: var(--page-color) !important;
}

/* Hotkeys 区域 */
.rm-hotkeys-action,
.rm-hotkeys-group__header {
  color: var(--text-color) !important;
}

.rm-hotkeys-hotkey__part.bp3-tag {
  background: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border: 1px solid var(--color-subtle-border) !important;
}

/* Depot readme 正文：可读性 */
.rm-settings-panel__section .rm-depot-readme-wrapper h1 {
  color: var(--heading-h1-color) !important;
}

.rm-settings-panel__section .rm-depot-readme-wrapper h2 {
  color: var(--heading-h2-color) !important;
}

.rm-settings-panel__section .rm-depot-readme-wrapper h3 {
  color: var(--heading-h3-color) !important;
}

.rm-settings-panel__section .rm-depot-readme-wrapper p,
.rm-settings-panel__section .rm-depot-readme-wrapper li,
.rm-settings-panel__section .rm-depot-readme-wrapper span {
  color: var(--text-color) !important;
}

.rm-settings-panel__section .rm-depot-readme-wrapper a {
  color: var(--color-primary) !important;
}

.rm-settings-panel__section .rm-depot-readme-wrapper strong {
  color: var(--heading-h2-color) !important;
}

/* 包裹 Settings 的 Dialog（若有）：背景与主页面一致，字体与主题一致；overlay 内弹窗需更高优先级 */
.bp3-dialog:has(.rm-settings-tabs),
.bp3-dialog.rm-modal-dialog--settings,
body .bp3-overlay .bp3-dialog:has(.rm-settings-tabs),
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings {
  background: var(--page-color) !important;
  color: var(--text-color) !important;
  font-family: var(--body-font) !important;
  font-size: var(--font-size) !important;
}

.bp3-dialog:has(.rm-settings-tabs) .bp3-dialog-body,
.bp3-dialog.rm-modal-dialog--settings .bp3-dialog-body,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .bp3-dialog-body {
  font-family: var(--body-font) !important;
  font-size: inherit;
}

.bp3-dialog:has(.rm-settings-tabs) .rm-settings,
.bp3-dialog:has(.rm-settings-tabs) .rm-settings-panel,
.bp3-dialog:has(.rm-settings-tabs) .rm-settings-panel__contents,
.bp3-dialog:has(.rm-settings-tabs) .bp3-tabs.rm-settings-tabs,
.bp3-dialog:has(.rm-settings-tabs) .bp3-tab-list,
.bp3-dialog:has(.rm-settings-tabs) .bp3-tab-panel,
.bp3-dialog.rm-modal-dialog--settings .rm-settings,
.bp3-dialog.rm-modal-dialog--settings .rm-settings-panel,
.bp3-dialog.rm-modal-dialog--settings .rm-settings-panel__contents,
.bp3-dialog.rm-modal-dialog--settings .bp3-tabs.rm-settings-tabs,
.bp3-dialog.rm-modal-dialog--settings .bp3-tab-list,
.bp3-dialog.rm-modal-dialog--settings .bp3-tab-panel,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .rm-settings,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .rm-settings-panel,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .rm-settings-panel__contents,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .bp3-tabs,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .bp3-tab-list,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .bp3-tab-panel {
  font-family: var(--body-font) !important;
  font-size: inherit;
}

.bp3-dialog.rm-modal-dialog--settings .rm-settings-heading,
.bp3-dialog.rm-modal-dialog--settings .rm-extension-settings-heading,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .rm-settings-heading,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .rm-extension-settings-heading {
  font-family: var(--heading-font) !important;
}

.bp3-dialog:has(.rm-settings-tabs) .bp3-dialog-header {
  background: transparent !important;
  color: var(--text-color) !important;
  border-bottom: 1px solid var(--color-subtle-border) !important;
}

.bp3-dialog:has(.rm-settings-tabs) .bp3-dialog-close-button {
  color: var(--text-color) !important;
}

.bp3-dialog:has(.rm-settings-tabs) .bp3-dialog-close-button:hover {
  color: var(--text-color) !important;
  background: var(--sidebar-hover-bg) !important;
}

.bp3-datepicker {
  background-color: var(--page-color) !important;
  padding: 10px !important;
}

.DayPicker-Caption {
  background-color: transparent !important;
  border-bottom: 1px solid var(--color-subtle-border);
  margin-bottom: 0.5rem; /* 8px，符合 4/8 倍数 */
  padding-bottom: 0.5rem;
}

.DayPicker-Caption .bp3-divider {
  display: none !important;
}

.bp3-datepicker-caption select {
  color: var(--text-color) !important;
  font-family: var(--heading-font) !important;
}

.bp3-datepicker-caption .bp3-icon,
.DayPicker-NavButton {
  color: var(--color-primary) !important;
}

.DayPicker-NavButton:hover {
  background-color: var(--color-primary-light) !important;
}

.DayPicker-Weekday {
  color: var(--light-text-color) !important;
  font-size: 0.85rem;
  text-transform: uppercase;
}

.DayPicker-Day {
  color: var(--text-color) !important;
  font-family: var(--code-font) !important;
}

.DayPicker-Day .bp3-datepicker-day-wrapper {
  color: inherit !important;
}

.DayPicker-Day:hover {
  background-color: var(--color-primary-light) !important;
  color: var(--color-primary) !important;
}

.DayPicker-Day--today {
  color: var(--highlight-red) !important;
}

.DayPicker-Day--selected,
.DayPicker-Day--selected:hover {
  background-color: var(--color-primary) !important;
  color: var(--datepicker-day-selected-text) !important;
}

.rm-autocomplete__results {
  background-color: var(--autocomplete-results-bg);
  color: var(--text-color);
}
/* "Search for a Page" 等提示行：覆盖 site.css .rm-new-item (#0D8050)，确保与背景对比日夜间皆可读 */
.rm-autocomplete__results .rm-autocomplete-result,
.rm-autocomplete__results .rm-autocomplete-result.rm-new-item,
.rm-autocomplete__results .rm-autocomplete-result .rm-new-item {
  color: var(--text-color) !important;
}

/* dont-unfocus-block：日夜间背景/文字色适配（覆盖默认白底） */
.rm-autocomplete__results .dont-unfocus-block {
  background-color: transparent;
  color: var(--text-color);
}
.rm-autocomplete__results .dont-unfocus-block:hover {
  background-color: var(--autocomplete-row-hover-bg);
  color: var(--autocomplete-row-hover-text);
}
/* 选中行（Roam 内联 rgb(213,218,223)）统一为主题色 */
.rm-autocomplete__results .dont-unfocus-block[style*="background-color: rgb(213, 218, 223)"],
.rm-autocomplete__results .dont-unfocus-block[style*="background-color: rgb(213, 218, 223)"]:hover {
  background-color: var(--autocomplete-row-hover-bg) !important;
  color: var(--autocomplete-row-hover-text) !important;
}

/* rm-aliases 区域：Aliases 标题与按钮文字颜色与日夜间统一 */
.rm-autocomplete__results .rm-aliases {
  background-color: transparent;
  border-color: var(--color-subtle-border);
  color: var(--text-color);
}
.rm-autocomplete__results .rm-aliases .sub-title {
  color: var(--light-text-color);
}
.rm-autocomplete__results .rm-aliases .bp3-button,
.rm-autocomplete__results .rm-aliases .bp3-button .bp3-button-text {
  background-color: transparent;
  color: var(--text-color);
}
.rm-autocomplete__results .rm-aliases .bp3-button:hover,
.rm-autocomplete__results .rm-aliases .bp3-button:hover .bp3-button-text {
  background-color: var(--autocomplete-row-hover-bg);
  color: var(--autocomplete-row-hover-text);
}
.rm-autocomplete__results .rm-aliases .result-highlight {
  background-color: var(--autocomplete-match-bg);
  color: var(--color-primary);
}
.rm-autocomplete__results .rm-aliases .bp3-icon {
  color: var(--light-text-color);
}
.rm-autocomplete__results .rm-aliases .bp3-button:hover .bp3-icon {
  color: var(--autocomplete-row-hover-text);
}

/* 夜间：照搬 system .bp3-dark .rm-autocomplete__results，颜色换为 roam 变量 */
body.rm-dark-theme .rm-autocomplete__results {
  background: var(--page-color);
  color: var(--text-color);
  box-shadow: 0 0 0 1px oklch(from var(--m-ink) l c h / 0.13), 0 4px 8px oklch(from var(--m-ink) l c h / 0.65), 0 18px 46px 6px oklch(from var(--m-ink) l c h / 0.65);
}
body.rm-dark-theme .rm-autocomplete__results .rm-autocomplete-result,
body.rm-dark-theme .rm-autocomplete__results .rm-autocomplete-result.rm-new-item,
body.rm-dark-theme .rm-autocomplete__results .rm-autocomplete-result .rm-new-item {
  color: var(--text-color) !important;
}
/* "Recent" 等分组标题：覆盖 inline rgb(206,217,224)，确保与背景对比日夜间皆可读 */
.rm-autocomplete__results div[style*="color: rgb(206, 217, 224)"],
.roam-app .bp3-overlay div[style*="color: rgb(206, 217, 224)"] {
  color: var(--text-color) !important;
}
body.rm-dark-theme .rm-autocomplete__results div[style*="color: rgb(206, 217, 224)"],
body.rm-dark-theme .roam-app .bp3-overlay div[style*="color: rgb(206, 217, 224)"] {
  color: var(--text-color) !important;
}

/* ========================================================= */
/* 15. Dark Mode (Merged Overrides)                          */
/* 已比对 system.css：本块为 roam 夜间变量/选择器（.rm-dark-theme），system 用 .bp3-dark，无重复 */
/* ========================================================= */

body.rm-dark-theme .roam-app a:not(.rm-alias--page):not(.rm-alias--block),
body.rm-dark-theme .roam-app .rm-alias--external {
  color: var(--m-link) !important;
}

body.rm-dark-theme .roam-app a:not(.rm-alias--page):not(.rm-alias--block):hover,
body.rm-dark-theme .roam-app .rm-alias--external:hover {
  color: var(--m-link-hover, var(--m-link)) !important;
}

body.rm-dark-theme .roam-app .rm-page-ref--link,
body.rm-dark-theme .roam-app a.rm-alias--page,
body.rm-dark-theme .roam-app a.rm-alias--block {
  color: var(--m-page-ref) !important;
  text-decoration: none !important;
  border-bottom: none !important;
  letter-spacing: 0;
  text-shadow: none;
}

body.rm-dark-theme .roam-app .rm-page-ref--link:hover,
body.rm-dark-theme .roam-app a.rm-alias--page:hover,
body.rm-dark-theme .roam-app a.rm-alias--block:hover {
  color: var(--m-page-ref-hover) !important;
  text-decoration: none !important;
  border-bottom: none !important;
  font-weight: 800 !important;
  letter-spacing: 0.03em;
  text-shadow: 0 0 6px oklch(from var(--m-page-ref) l c h / 0.5), 0 0 12px oklch(from var(--m-page-ref) l c h / 0.25);
}

/* 仅标题块自身内容区，不作用到子块（与日间一致） */
body.rm-dark-theme .roam-app .roam-block-container:is(.rm-level1, .rm-level2, .rm-level3, .rm-heading-level-1, .rm-heading-level-2, .rm-heading-level-3) > .rm-block-main,
body.rm-dark-theme .roam-app .roam-block-container.rm-level1 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body.rm-dark-theme .roam-app .roam-block-container.rm-heading-level-1 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body.rm-dark-theme .roam-app .roam-block-container.rm-level2 > .rm-block-main :is(.rm-block-main, .rm-block__input, .rm-block-text),
body.rm-dark-theme .roam-app .roam-block-container.rm-heading-level-2 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body.rm-dark-theme .roam-app .roam-block-container.rm-level3 > .rm-block-main :is(.rm-block-main, .rm-block__input, .rm-block-text),
body.rm-dark-theme .roam-app .roam-block-container.rm-heading-level-3 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body.rm-dark-theme .roam-app .roam-block-container.rm-heading-level-1 > .rm-block-main [style*="background"],
body.rm-dark-theme .roam-app .roam-block-container.rm-heading-level-2 > .rm-block-main [style*="background"],
body.rm-dark-theme .roam-app .roam-block-container.rm-heading-level-3 > .rm-block-main [style*="background"] {
  background: transparent !important;
}

body.rm-dark-theme .roam-app .rm-code-warning,
body.rm-dark-theme .roam-app .roam-block-container[data-page-links*="roam/js"] .rm-code-warning,
body.rm-dark-theme .roam-app .bp3-card {
  background-color: var(--page-color) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-code-warning .CodeMirror,
body.rm-dark-theme .roam-app .rm-code-warning pre,
body.rm-dark-theme .roam-app .rm-code-warning code,
body.rm-dark-theme .roam-app .rm-code-warning textarea {
  background-color: var(--code-warning-code-bg) !important;
  color: var(--code-warning-text) !important;
}

body.rm-dark-theme .roam-app .rm-code-warning .bp3-button {
  background-color: var(--code-warning-btn-bg) !important;
  color: var(--code-warning-text) !important;
}

body.rm-dark-theme .roam-app .rm-code-warning .bp3-button:hover {
  background-color: var(--code-warning-btn-hover-bg) !important;
}

body.rm-dark-theme .roam-app :is(.bp3-popover .bp3-popover-content, .bp3-popover2 .bp3-popover2-content) {
  background: var(--page-color) !important;
  color: var(--text-color) !important;
}

/* 夜间：popover 容器阴影照搬 system.css .bp3-dark .bp3-popover，配色用 roam 变量 */
body.rm-dark-theme .roam-app .bp3-popover,
body.rm-dark-theme .roam-app .bp3-popover2 {
  box-shadow: 0 0 0 1px oklch(from var(--m-ink) l c h / 0.13), 0 2px 4px oklch(from var(--m-ink) l c h / 0.65), 0 8px 24px oklch(from var(--m-ink) l c h / 0.65);
}

body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu {
  background: transparent !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu-item {
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .bp3-menu.rm-graph-dropdown .bp3-menu-item.setting:hover,
body.rm-dark-theme .roam-app .bp3-menu.rm-graph-dropdown .bp3-menu-item.setting.bp3-active,
body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu-item:hover,
body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu-item.bp3-active {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;
}

body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu-item .bp3-icon {
  color: var(--light-text-color) !important;
}

body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu-item:hover .bp3-icon,
body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu-item.bp3-active .bp3-icon {
  color: var(--menu-hover-text) !important;
}

/* 覆盖 Blueprint 内联 fill="#8A9BA8" 的 SVG 图标 */
body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-icon svg {
  fill: currentColor !important;
}

body.rm-dark-theme .roam-app .bp3-popover-content .bp3-menu-item.bp3-intent-primary {
  color: var(--on-accent) !important;
}

/* 夜间：全应用内无 intent 的默认按钮与主题一致（不依赖 .bp3-dark） */
body.rm-dark-theme .roam-app .bp3-button:not([class*="bp3-intent-"]) {
  background: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border) !important;
}
body.rm-dark-theme .roam-app .bp3-button.bp3-minimal:not([class*="bp3-intent-"]) {
  background: transparent !important;
}
body.rm-dark-theme .roam-app .bp3-button:not([class*="bp3-intent-"]):hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border) !important;
}

/* 夜间：对齐工具栏 .flex-h-box 内按钮（覆盖内联白底/浅边框） */
body.rm-dark-theme .roam-app .flex-h-box button {
  background-color: var(--embed-bg) !important;
  border-color: var(--color-subtle-border) !important;
}
body.rm-dark-theme .roam-app .flex-h-box button:hover {
  background-color: var(--reference-item-hover-bg) !important;
}
body.rm-dark-theme .roam-app .flex-h-box button .bp3-icon-standard {
  color: var(--light-text-color) !important;
}

body.rm-dark-theme .roam-app .bp3-popover-arrow-fill {
  fill: var(--page-color) !important;
}

body .roam-app .rm-roam-css--inactive {
  background-color: var(--danger-bg) !important;
  border: 1px solid var(--danger-border) !important;
  backdrop-filter: blur(5px);
}

body.rm-dark-theme .roam-app .rm-settings--desktop .rm-settings__tab:not(.rm-settings__panel-wrapper)[aria-selected="true"] {
  background: var(--color-primary-light) !important;
  color: var(--text-color) !important;
}

/* ========== Settings 面板 - 夜间模式强制（与日间同构，变量已为夜间值） ========== */
body.rm-dark-theme .roam-app .bp3-tabs.rm-settings-tabs,
body.rm-dark-theme .roam-app .bp3-tabs.rm-settings-tabs .bp3-tab-list,
body.rm-dark-theme .roam-app .bp3-tab-panel.rm-settings__panel-wrapper,
body.rm-dark-theme .roam-app .rm-settings-panel,
body.rm-dark-theme .roam-app .rm-settings-panel__contents {
  background: var(--page-color) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-heading,
body.rm-dark-theme .roam-app .rm-extension-settings-heading {
  color: var(--heading-h1-color) !important;
}

body.rm-dark-theme .roam-app .bp3-tab.rm-settings__tab {
  color: var(--text-color) !important;
  background: transparent !important;
}

body.rm-dark-theme .roam-app .bp3-tab.rm-settings__tab:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .bp3-tab.rm-settings__tab[aria-selected="true"] {
  background: var(--color-primary-light) !important;
  color: var(--text-color) !important;
}

/* 夜间：右侧内容区与 Roam Depot 扩展列表 */
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extensions-settings {
  background: var(--page-color) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extensions-settings .rm-settings-panel__section h4,
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extensions-settings .rm-settings-panel__description,
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extensions-installed__header,
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extension-installed__name {
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extension-installed__desc {
  color: var(--light-text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extensions-settings .bp3-button.bp3-intent-primary {
  background: var(--color-primary) !important;
  border-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extensions-settings .bp3-button.bp3-minimal,
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extension-installed .bp3-button.bp3-minimal {
  color: var(--text-color) !important;
}

/* 夜间：panel-config（第三方插件设置页） */
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config {
  background: var(--embed-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings-panel__section h4,
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings-panel__section .rm-settings-panel__description,
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings-panel__description {
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings-panel__description a {
  color: var(--color-primary) !important;
}

body.rm-dark-theme .roam-app .rm-settings .rm-settings-panel .rm-select-wrapper,
body.rm-dark-theme .roam-app .rm-settings .rm-settings-panel .rm-select-wrapper .bp3-button {
  background-color: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__panel-config input.rm-settings-panel__value,
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config input[type="text"],
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config input[type="password"],
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings__permissions-button,
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .bp3-button.bp3-minimal.rm-settings__permissions-button {
  background: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border) !important;
}

/* 夜间：右侧任意 section 兜底 */
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings__permissions-button .bp3-button-text,
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings__permissions-button .bp3-icon,
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-settings-panel__section h4,
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-settings-panel__section .rm-settings-panel__description {
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-settings-panel__section h4 {
  color: var(--heading-h2-color) !important;
}

body.rm-dark-theme .roam-app .bp3-dialog:has(.rm-settings-tabs) {
  background: var(--page-color) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .bp3-dialog:has(.rm-settings-tabs) .bp3-dialog-header {
  background: transparent !important;
  color: var(--text-color) !important;
  border-bottom-color: var(--color-subtle-border) !important;
}

body.rm-dark-theme .roam-app .bp3-dialog:has(.rm-settings-tabs) .bp3-dialog-close-button {
  color: var(--text-color) !important;
}

body .roam-app .rm-command-palette .bp3-input {
  background-color: var(--page-color) !important;
  color: var(--text-color) !important;
  border-color: transparent !important;
}

body .roam-app .rm-command-palette .bp3-input::placeholder {
  color: var(--light-text-color) !important;
}

body .roam-app .rm-command-palette .bp3-input:focus {
  border-color: var(--color-primary) !important;
}

body .roam-app .rm-command-palette .search-icon {
  color: var(--light-text-color) !important;
}

body .roam-app .rm-command-palette .rm-menu-item {
  color: var(--text-color) !important;
}

body .roam-app .rm-command-palette .rm-menu-item .rm-command-palette__label {
  color: var(--text-color) !important;
}

body .roam-app .rm-command-palette .rm-menu-item:hover,
body .roam-app .rm-command-palette .rm-menu-item.rm-menu-item--active {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;
}

/* 命令面板选中项：与日夜间主题统一（覆盖默认/扩展可能的高优先级规则） */
.rm-command-palette__scroll-container .rm-command-palette__menu .rm-menu-item--active {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;}
.rm-command-palette__scroll-container .rm-command-palette__menu .rm-menu-item--active .rm-command-palette__label,
.rm-command-palette__scroll-container .rm-command-palette__menu .rm-menu-item--active .rm-command-palette__shortcut {
  color: var(--menu-hover-text) !important;
}

body .roam-app .rm-command-palette .rm-menu-item:hover .rm-command-palette__label,
body .roam-app .rm-command-palette .rm-menu-item.rm-menu-item--active .rm-command-palette__label,
body .roam-app .rm-command-palette .rm-menu-item:hover .rm-command-palette__shortcut,
body .roam-app .rm-command-palette .rm-menu-item.rm-menu-item--active .rm-command-palette__shortcut {
  color: var(--menu-hover-text) !important;
}

html body .roam-app .rm-command-palette .rm-menu-item .rm-command-palette__shortcut,
html body .roam-app .rm-command-palette .rm-command-palette__shortcut {
  color: var(--text-color) !important;
}

/* 命令面板快捷键文字：与日夜间主题统一 */
.roam-app .rm-command-palette .rm-command-palette__shortcut {
  background-color: transparent !important;
  color: var(--text-color) !important;
}
.roam-app .rm-command-palette .rm-menu-item:hover .rm-command-palette__shortcut,
.roam-app .rm-command-palette .rm-menu-item.rm-menu-item--active .rm-command-palette__shortcut {
  background-color: transparent !important;
  color: var(--menu-hover-text) !important;
}
.rm-command-palette__scroll-container .rm-command-palette__menu .rm-menu-item--active .rm-command-palette__shortcut {
  background-color: transparent !important;
  color: var(--menu-hover-text) !important;
}

/* 命令面板底部：与日夜间主题统一 */
.roam-app .rm-command-palette .rm-command-palette__footer {
  background-color: var(--page-color) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}
.roam-app .rm-command-palette .rm-command-palette__footer-title {
  color: var(--text-color) !important;
}
.roam-app .rm-command-palette .bcp-sort-controls .bcp-sort-label {
  color: var(--light-text-color) !important;
}
.roam-app .rm-command-palette .bcp-sort-button {
  background-color: transparent !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}
.roam-app .rm-command-palette .bcp-sort-button:hover {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;
  border-color: var(--color-subtle-border) !important;
}
.roam-app .rm-command-palette .bcp-sort-button[aria-pressed="true"],
.roam-app .rm-command-palette .bcp-sort-button[data-active="1"] {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;
  border-color: var(--color-primary) !important;
}

/* body .bp3-datepicker：仅 box-shadow，已移除 */

body .roam-app .DayPicker-Day:hover {
  background-color: var(--datepicker-day-hover-bg) !important;
  color: var(--datepicker-day-hover-text) !important;
}

/* ========================================================= */
/* 16. Theme Toggle Button                                    */
/* 已比对 system.css：无（主题切换为 roam 独有）              */
/* ========================================================= */

/* ========================================================= */
/* 17. Gap-Filling & Global Resets                            */
/* 已比对 system.css：兜底/selection/滚动条等，与 system 选择器或值不同，全部保留 */
/* ========================================================= */

html,
body,
#app {
  background: var(--bg-color, var(--m-bg, #F8FBF8)) !important;
  color: var(--text-color, var(--m-text, #313233));
}

/* --- Selection（对齐 system.css：正文/链接透明；输入与标题区显式高亮，变量见 :root / .rm-dark-theme）--- */
.roam-app ::selection,
.roam-app :is(.roam-article, .roam-block-container) ::selection,
.roam-app .rm-page-ref::selection,
.roam-app .rm-page-ref *::selection,
.roam-app :is(.rm-page-ref--link, span.rm-page-ref.rm-page-ref--tag, span.rm-page-ref[data-tag])::selection,
.roam-app a::selection,
.roam-app a *::selection,
.roam-app :is(.rm-alias--page, .rm-alias--block, .rm-alias--external)::selection {
  background: transparent !important;
  color: inherit !important;
}

/* 页面标题：强制可选中（避免被 noselect 等阻断） */
.roam-body .roam-app .roam-article :is(.rm-title-display-container, .rm-title-display, h1.rm-title-display) {
  -webkit-user-select: text !important;
  -moz-user-select: text !important;
  -ms-user-select: text !important;
  user-select: text !important;
}

/* 输入框 + 页面标题：选中高亮（--selection-bg / --selection-text）；标题用层级限定避免 .container * 卡顿 */
.roam-app :is(input, textarea, .rm-block__input, .bp3-input)::selection,
.roam-body .roam-app .roam-article :is(.rm-title-display-container, .rm-title-display-container > *, .rm-title-display-container > * *, .rm-title-display, h1.rm-title-display, .rm-title-display *, h1.rm-title-display *)::selection {
  background: var(--selection-bg) !important;
  color: var(--selection-text) !important;
}

.roam-app :is(input, textarea, .rm-block__input, .bp3-input)::-moz-selection,
.roam-body .roam-app .roam-article :is(.rm-title-display-container, .rm-title-display-container > *, .rm-title-display-container > * *, .rm-title-display, h1.rm-title-display, .rm-title-display *, h1.rm-title-display *)::-moz-selection {
  background: var(--selection-bg) !important;
  color: var(--selection-text) !important;
}

.roam-app *:focus-visible {
  outline: none;
}

/* 内容块 focus 无外框，无边界（正文 + 侧栏大纲 + 引用等全场景）；页面标题 focus 与 unfocus 视觉一致（无焦点环） */
.roam-app .roam-article .roam-block-container:focus-within,
.roam-app .roam-article .roam-block-container.rm-block--focused,
.roam-app .roam-article .roam-block-container.rm-focused,
.roam-app .roam-article .roam-block-container .rm-block__input:focus,
.roam-app .roam-article .roam-block-container .rm-block__input:focus-visible,
.roam-app .roam-article .roam-block-container .rm-block-main:focus,
.roam-app .roam-article .roam-block-container .rm-block-main:focus-visible,
.roam-app .roam-article .rm-block__input:focus,
.roam-app .roam-article .rm-block__input:focus-visible,
/* 侧栏大纲 / Zoom / 引用项内的块编辑态同样无外框 */
.roam-app .rm-sidebar-outline .roam-block-container:focus-within,
.roam-app .rm-sidebar-outline .roam-block-container.rm-block--focused,
.roam-app .rm-sidebar-outline .roam-block-container.rm-focused,
.roam-app .rm-sidebar-outline .roam-block-container .rm-block__input:focus,
.roam-app .rm-sidebar-outline .roam-block-container .rm-block__input:focus-visible,
.roam-app .rm-zoom .roam-block-container:focus-within,
.roam-app .rm-zoom .roam-block-container.rm-block--focused,
.roam-app .rm-zoom .roam-block-container.rm-focused,
.roam-app .rm-zoom .roam-block-container .rm-block__input:focus,
.roam-app .rm-zoom .roam-block-container .rm-block__input:focus-visible,
.roam-app .rm-reference-item .roam-block-container:focus-within,
.roam-app .rm-reference-item .roam-block-container.rm-block--focused,
.roam-app .rm-reference-item .roam-block-container.rm-focused,
.roam-app .rm-reference-item .roam-block-container .rm-block__input:focus,
.roam-app .rm-reference-item .roam-block-container .rm-block__input:focus-visible,
/* 任意位置的块容器编辑态兜底 */
.roam-app .roam-block-container:focus-within,
.roam-app .roam-block-container.rm-block--focused,
.roam-app .roam-block-container.rm-focused,
.roam-app .roam-block-container .rm-block__input:focus,
.roam-app .roam-block-container .rm-block__input:focus-visible,
.roam-app .roam-block-container .rm-block-main:focus,
.roam-app .roam-block-container .rm-block-main:focus-visible,
.roam-app .rm-title-display:focus,
.roam-app .rm-title-display:focus-visible,
.roam-app .rm-title-display-container .rm-title-display:focus,
.roam-app .rm-title-display-container .rm-title-display:focus-visible,
.roam-app .rm-title-editing-display:focus-within,
.roam-app .rm-title-editing-display textarea:focus,
.roam-app .rm-title-editing-display textarea:focus-visible {
  outline: none !important;
  border: none !important;
}

.roam-app .bp3-input,
.roam-app .bp3-input-group .bp3-input,
.roam-app .rm-settings input[type="text"] {
  background-color: var(--page-color) !important;
  border-color: transparent !important;
  color: var(--text-color) !important;
}

.roam-app .bp3-input::placeholder,
.roam-app .bp3-input-group .bp3-input::placeholder,
.roam-app .rm-settings input[type="text"]::placeholder {
  color: var(--light-text-color) !important;
}

.roam-app .bp3-input:focus,
.roam-app .bp3-input-group .bp3-input:focus,
.roam-app .rm-settings input[type="text"]:focus {
  border-color: var(--color-primary) !important;
}



html::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

html::-webkit-scrollbar-track {
  background: var(--scrollbar-track, oklch(from var(--m-text, #313233) l c h / 0.06));
}

html::-webkit-scrollbar-thumb {
  background: var(--scrollbar-thumb, oklch(from var(--m-primary, #789262) l c h / 0.35));
  background-clip: padding-box;
  border: 2px solid transparent;
}

html::-webkit-scrollbar-thumb:hover {
  background: var(--scrollbar-thumb-hover, oklch(from var(--m-primary, #789262) l c h / 0.52));
  background-clip: padding-box;
}

/* 正文 + 引用区滚动条：隐藏，滚动仍可用（与主题一致时可改为 thin） */
.roam-app :is(.rm-article-wrapper, .rm-article-wrapper .roam-article, .rm-article-wrapper .rm-reference-wrapper, .rm-article-wrapper .rm-reference-main__child-wrapper, .rm-article-wrapper .rm-mentions, .rm-article-wrapper .scroll) {
  scrollbar-width: none;
}
.roam-app :is(.rm-article-wrapper, .rm-article-wrapper .roam-article, .rm-article-wrapper .rm-reference-wrapper, .rm-article-wrapper .rm-reference-main__child-wrapper, .rm-article-wrapper .rm-mentions, .rm-article-wrapper .scroll)::-webkit-scrollbar {
  width: 0;
  height: 0;
}

/* .roam-app .roam-article > div：仅 box-shadow，已移除 */

/* body:not(.rm-dark-theme) .roam-app .roam-article > div：仅 box-shadow，已移除 */

/* 夜间：正文与引用区交界处无阴影/横线，保持无边界 */
/* 夜间：正文与引用区 border-bottom 已由 system 控制，此处仅保留配色时留空 */

/* ========================================================= */
/* 18. References - Borderless Immersion                     */
/* ========================================================= */


/* 标题行（Linked/Unlinked References）：分割线始终 1px，仅用变量控制颜色，避免日夜切换位移 */

.roam-app .rm-reference-wrapper .rm-reference-container > .flex-h-box strong,
.roam-app .rm-reference-wrapper .rm-unlinked-reference-container strong,
.roam-app .rm-reference-wrapper .rm-unlink-aliases strong {
  color: var(--reference-strong-color) !important;
}

/* 标题行里被 inline style 写死的夜间浅色：统一回变量 */
.roam-app .rm-reference-wrapper div[style*="color: rgb(206, 217, 224)"] {
  color: var(--reference-title-color) !important;
}

/* 引用页分组容器：收敛内边距，避免出现“块状外框” */
.rm-ref-page-view,
.rm-reference-wrapper .rm-title-arrow-wrapper {
  background: transparent !important;
  border: none !important;
}

.rm-reference-wrapper .rm-ref-page-view-title .rm-page__title,
.rm-reference-wrapper .rm-ref-page-view-title a,
.rm-reference-wrapper .rm-ref-page-view-title span {
  color: var(--text-color) !important;
}




.roam-app .rm-reference-wrapper .rm-mentions-search .bp3-input,
.roam-app .rm-reference-wrapper .rm-mentions-search__input.bp3-input {
  background-color: var(--page-color) !important;
  border-color: transparent !important;
  color: var(--text-color) !important;
}

.roam-app .rm-reference-wrapper .rm-mentions-search .bp3-input:focus,
.roam-app .rm-reference-wrapper .rm-mentions-search__input.bp3-input:focus {
  border-color: var(--color-primary) !important;
}

.roam-app .rm-reference-wrapper .bp3-button.bp3-minimal {
  background: transparent !important;
}
.roam-app .rm-reference-wrapper .bp3-button.bp3-minimal:hover {
  background: var(--reference-icon-hover-bg) !important;
}

.roam-app .rm-reference-wrapper .bp3-button.bp3-minimal .bp3-icon,
.roam-app .rm-reference-wrapper .bp3-icon-standard {
  color: var(--light-text-color) !important;
}

.roam-app .rm-reference-wrapper .bp3-button.bp3-minimal:hover .bp3-icon,
.roam-app .rm-reference-wrapper .bp3-button.bp3-minimal:hover .bp3-icon-standard {
  color: var(--color-primary) !important;
}

/* rm-inline-references：块引用内联展开界面，配色统一主题变量 */
.roam-app .rm-inline-references {
  background-color: var(--embed-bg);
  color: var(--text-color);
}
.roam-app .rm-inline-references .rm-zoom-path .rm-zoom-item,
.roam-app .rm-inline-references .rm-zoom .rm-zoom-item {
  color: var(--light-text-color);
}
.roam-app .rm-inline-references .rm-zoom-path .rm-zoom-item .rm-zoom-item-content.rm-zoom-collapsed-item {
  background-color: oklch(from var(--m-primary) l c h / 0.15);
  color: var(--text-color);
}
.roam-app .rm-inline-references .rm-zoom.zoom-path-view .rm-zoom-mask {
  background-color: var(--page-color);
}
.roam-app .rm-inline-references .rm-filtered-out {
  color: var(--light-text-color);
}
.roam-app .rm-inline-references .block-ref-count-button.rm-active {
  background-color: var(--color-primary);
  color: var(--on-accent);
}
.roam-app .rm-inline-references .rm-filter-popup-button .bp3-icon,
.roam-app .rm-inline-references .rm-zoom-chevron {
  color: var(--light-text-color);
}
.roam-app .rm-inline-references .squish,
.roam-app .rm-inline-references div[style*="color: rgb(138, 155, 168)"] {
  color: var(--light-text-color) !important;
}
.roam-app .rm-inline-references .squish svg {
  fill: currentColor;
}
body.rm-dark-theme .roam-app .rm-inline-references .rm-zoom.zoom-path-view .rm-zoom-mask {
  background-color: transparent;
}
.roam-app .rm-embed-container .rm-inline-references {
  background-color: inherit;
}

/* 日间模式：正文区引用/提及面板内 .rm-reference-item 与夜间一致，悬浮无背景 */
body:not(.rm-dark-theme) .roam-app .roam-article .rm-reference-wrapper .rm-reference-item,
body:not(.rm-dark-theme) .roam-app .roam-article .rm-reference-wrapper .rm-reference-item:hover {
  background: transparent !important;
}

/* 夜间模式：引用区无边界/沉浸式，强制去除所有分割线与阴影 */
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-reference-main,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-reference-main__child-wrapper,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-reference-container,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-reference-container > .flex-h-box,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-unlinked-reference-container,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-unlinked-reference-container > .flex-h-box,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-mentions,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-ref-page-view,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-title-arrow-wrapper,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-unlink-aliases,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-reference-item {
  border: none !important;
  border-top: none !important;
  border-bottom: none !important;
  background: transparent !important;
}
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper::before,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper::after,
body.rm-dark-theme .roam-app .roam-article .rm-reference-main::before,
body.rm-dark-theme .roam-app .roam-article .rm-reference-main::after {
  display: none !important;
  content: none !important;
  border: none !important;
}
body.rm-dark-theme .roam-app .roam-article .rm-reference-main[style*="padding-top"] {
  padding-top: 0 !important;
}

/* ========================================================= */
/* 命令面板：最高优先级覆盖（含 portaled / 扩展注入后的样式）  */
/* 同时匹配 .roam-app 内 与 body 直下，确保生效              */
/* ========================================================= */
html body .roam-app .rm-command-palette .rm-command-palette__shortcut,
html body .rm-command-palette .rm-command-palette__shortcut {
  background-color: transparent !important;
  color: var(--text-color) !important;
}
html body .roam-app .rm-command-palette .rm-menu-item:hover .rm-command-palette__shortcut,
html body .roam-app .rm-command-palette .rm-menu-item.rm-menu-item--active .rm-command-palette__shortcut,
html body .rm-command-palette .rm-menu-item:hover .rm-command-palette__shortcut,
html body .rm-command-palette .rm-menu-item.rm-menu-item--active .rm-command-palette__shortcut {
  background-color: transparent !important;
  color: var(--menu-hover-text) !important;
}
html body .roam-app .rm-command-palette .rm-command-palette__footer,
html body .rm-command-palette .rm-command-palette__footer {
  background-color: var(--page-color) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}
html body .roam-app .rm-command-palette .rm-command-palette__footer-title,
html body .rm-command-palette .rm-command-palette__footer-title {
  color: var(--text-color) !important;
}
html body .roam-app .rm-command-palette .bcp-sort-label,
html body .rm-command-palette .bcp-sort-label {
  color: var(--light-text-color) !important;
}
html body .roam-app .rm-command-palette .bcp-sort-button,
html body .rm-command-palette .bcp-sort-button {
  background-color: transparent !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}
html body .roam-app .rm-command-palette .bcp-sort-button:hover,
html body .rm-command-palette .bcp-sort-button:hover {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;
  border-color: var(--color-subtle-border) !important;
}
html body .roam-app .rm-command-palette .bcp-sort-button[aria-pressed="true"],
html body .roam-app .rm-command-palette .bcp-sort-button[data-active="1"],
html body .rm-command-palette .bcp-sort-button[aria-pressed="true"],
html body .rm-command-palette .bcp-sort-button[data-active="1"] {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;
  border-color: var(--color-primary) !important;
}
html body .roam-app .rm-command-palette .rm-menu-item.rm-menu-item--active,
html body .rm-command-palette .rm-menu-item.rm-menu-item--active {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;
}
html body .roam-app .rm-command-palette .rm-command-palette__scroll-container .rm-command-palette__menu .rm-menu-item--active,
html body .rm-command-palette .rm-command-palette__scroll-container .rm-command-palette__menu .rm-menu-item--active {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;
}
html body .roam-app .rm-command-palette .rm-command-palette__scroll-container .rm-command-palette__menu .rm-menu-item--active .rm-command-palette__label,
html body .roam-app .rm-command-palette .rm-command-palette__scroll-container .rm-command-palette__menu .rm-menu-item--active .rm-command-palette__shortcut,
html body .rm-command-palette .rm-command-palette__scroll-container .rm-command-palette__menu .rm-menu-item--active .rm-command-palette__label,
html body .rm-command-palette .rm-command-palette__scroll-container .rm-command-palette__menu .rm-menu-item--active .rm-command-palette__shortcut {
  background-color: transparent !important;
  color: var(--menu-hover-text) !important;
}