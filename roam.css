/* ========================================================= */
/* 1. CSS Variables (Light) - 格式/顺序对齐 lesswrong.css   */
/* ========================================================= */
:root,
.roam-app {
  /* Typography - Humanist Endgame 字栈 (门面/骨架/血肉/呼吸/眉批/代码) */
  --title-font: 'Arno Pro Display', 'Arno Pro', 'WenYue Classical Ming', '文悦古典明朝体 简入繁出 (需授权)', serif;
  --heading-font: 'Optima', 'Zapf Humanist', 'FZYanZhenQingKaiS-R-GB', '方正颜真卿楷书 简', '方正颜真卿楷书', sans-serif;
  --body-font: 'Palatino Linotype', 'Palatino', 'FZPingXianYaSong-R', '方正屏显雅宋_GBK', '方正屏显雅宋', serif;
  --quote-font: 'Centaur MT Pro', 'Centaur', '方正灵飞经小楷 简', serif;
  --tag-font: 'Cronos Pro', 'Cronos', 'FZSongKeBenXiuKai-R-GBK', '方正宋刻本秀楷简体', '方正宋刻本秀楷', sans-serif;
  --code-font: 'Operator Mono', 'Operator Mono SSm', 'Sarasa Term SC', '更纱黑体 SC', monospace;
  --font-size: 1rem;

  /* Day Mode - 黑/灰系：页面标题/正文/引用/H1-H3（有层次）；彩色系：标签/双链/外链（色相环隔开） */
  --m-bg: #C7D1C6;       /* 苍艾 - 核心背景（固定） */
  --m-surface: #C7D1C6;  /* 苍艾（固定） */
  --m-text: #313233;     /* 墨色 - 正文 */
  --m-ink: #2B2B2B;      /* 皂色 - 边框/阴影 */
  --m-text-muted: #758A99; /* 墨灰 */
  --m-primary: #789262;   /* 竹青 - 主色 */
  --m-secondary: #D3B17D; /* 枯黄 - 辅助色 */
  --m-sidebar-title: var(--m-primary);
  /* 黑色/灰色系（层次：由深到浅） */
  --m-title-display: #161823;     /* 漆黑 - 页面标题 */
  --m-heading-h1: #1C1C1C;        /* 乌色 - H1 */
  --m-heading-h2: #424C50;        /* 鸦青 - H2 */
  --m-heading-h3: #50616D;        /* 岩灰 - H3 */
  --m-blockquote: #424C50;        /* 鸦青 - 引用块正文 */
  /* 彩色系（黄 / 蓝 / 红紫，色相环不临近，标签避绿不撞背景） */
  --m-page-tag: #75878A;          /* 苍色 - 弱化标签区 */
  --m-tag: #CA6924;               /* 琥珀 - 标签（黄色系） */
  --m-tag-hover: #A8551E;         /* 琥珀加深 - 标签 hover */
  --m-page-ref: #177CB0;            /* 靛青 - 双链（蓝） */
  --m-page-ref-hover: #125A82;      /* 双链 hover */
  --m-link: #8C4356;                /* 绛紫 - 外链（红紫，与绿/蓝隔开） */
  --m-link-hover: #6B3442;          /* 绛紫加深 - 外链 hover */
  /* 其他 */
  --m-reference-strong: #118b6e;  /* 青碧 - 引用区 strong */
  --m-sidebar-star: #177CB0;      /* 靛青 */
  --m-checkbox-checked: #21A675;  /* 松柏绿 */
  --m-code-selection: #D6ECF0;    /* 月白 */
  --m-on-accent: #F2ECDE;         /* 缟 */
  --m-highlight-underline: #CCA4E3; /* 丁香 */
  --m-highlight-yellow: #F0C239;    /* 缃色 */
  --m-highlight-green: #3B8E6F;     /* 碧色 */
  --m-highlight-blue: #4C8DAE;      /* 群青 */
  --m-highlight-red: #C83C23;       /* 绯红 */
  --m-highlight-purple: #B0A4E3;    /* 雪青 */
  --m-highlight-orange: #CA6924;    /* 琥珀 */
  --m-sidebar-icon: #3D3B4F;        /* 玄色 */
  --m-sidebar-title-day: #057748;   /* 松花绿 */
  --m-sidebar-star-day: #065279;    /* 靛蓝 */
  --m-warn: #D23B3B;                /* 丹 - 警示 */
  --m-popover: var(--m-surface);

  /* 供 system.css .rm-page-ref--tag 使用（pill 形态） */
  --co-main__tags: var(--m-tag);
  --co-main__tags--hover: var(--m-tag-hover);
  --bc-main__tags: var(--tag-bg);
  --bc-main__tags--hover: var(--tag-bg-hover);
  --bt-main__tags: 0;
  --br-main__tags: 0;
  --bb-main__tags: 0;
  --bl-main__tags: 0;
  --bd-main__tags: 9999px;
  --bt-main__tags--hover: 0;
  --br-main__tags--hover: 0;
  --bb-main__tags--hover: 0;
  --bl-main__tags--hover: 0;
  --bd-main__tags--hover: 9999px;

  /* 映射到既有主题语义变量（bc/co 顺序） */
  --bg-color: var(--m-bg);
  --page-color: var(--m-surface);
  --text-color: var(--m-text);
  --light-text-color: var(--m-text-muted);
  --page-tag-color: var(--m-page-tag);
  --color-primary: var(--m-primary);
  --color-secondary: var(--m-secondary);
  /* Hover derivations (oklch, mode-agnostic) */
  --hover-primary-soft: oklch(from var(--m-primary) l c h / 0.10);
  --hover-primary: oklch(from var(--m-primary) l c h / 0.14);
  --hover-primary-strong: oklch(from var(--m-primary) l c h / 0.25);
  --hover-secondary: oklch(from var(--m-secondary) l c h / 1);
  --color-primary-light: var(--hover-primary);
  --color-primary-highlight: var(--hover-primary-soft);
  --color-subtle-border: oklch(from var(--m-text) l c h / 0.10);
  --title-display-color: var(--m-title-display);
  --heading-h1-color: var(--m-heading-h1);
  --heading-h2-color: var(--m-heading-h2);
  --heading-h3-color: var(--m-heading-h3);
  --blockquote-text: var(--m-blockquote);
  --reference-strong-color: var(--m-reference-strong);
  --block-highlight-bg: oklch(from var(--m-primary) l c h / 0.18);
  --sidebar-title-color: var(--m-sidebar-title);
  --sidebar-star-color: var(--m-sidebar-star);
  --reference-title-color: var(--m-primary);
  --checkbox-checked-color: var(--m-checkbox-checked);
  --tree-node-color: var(--m-primary);
  --code-selection-color: var(--m-code-selection);
  --bullet-bg: oklch(from var(--m-primary) l c h / 0.4);
  --bullet-border: var(--color-primary);

  /* Component Backgrounds (bc) */
  --code-bg: oklch(from var(--m-text) l c h / 0.04);
  --inline-code-bg: oklch(from var(--m-text) l c h / 0.06);
  --embed-bg: oklch(from var(--m-text) l c h / 0.03);
  --embed-hover-bg: oklch(from var(--m-text) l c h / 0.06);
  --reference-item-bg: oklch(from var(--m-primary) l c h / 0.06);
  --reference-item-hover-bg: oklch(from var(--m-primary) l c h / 0.12);
  --kanban-column-bg: oklch(from var(--m-text) l c h / 0.03);
  --kanban-card-bg: oklch(from var(--m-primary) l c h / 0.05);
  --kanban-card-hover-bg: oklch(from var(--m-primary) l c h / 0.10);

  /* Shadows / Focus / Selection / Scrollbar (sd) */
  --shadow-soft: 0 6px 18px oklch(from var(--m-ink) l c h / 0.12);
  --shadow-floating: 0 10px 30px oklch(from var(--m-ink) l c h / 0.16);
  --focus-ring: 0 0 0 3px oklch(from var(--m-primary) l c h / 0.28);
  --selection-bg: oklch(from var(--m-primary) l c h / 0.58);
  --selection-text: var(--m-ink);
  --scrollbar-track: oklch(from var(--m-text) l c h / 0.06);
  --scrollbar-thumb: oklch(from var(--m-primary) l c h / 0.35);
  --scrollbar-thumb-hover: oklch(from var(--m-primary) l c h / 0.52);
  --on-accent: var(--m-on-accent);

  /* Popover (bc / border / sd) */
  --popover-bg: var(--m-popover);
  --popover-border: transparent;
  --popover-shadow: var(--shadow-floating);

  /* 交互语义 / Datepicker / Find-or-Create */
  --menu-hover-bg: var(--hover-primary);
  --menu-divider-color: transparent;
  --menu-hover-text: var(--text-color);
  --btn-disabled-text: oklch(from var(--m-text) l c h / 0.55);
  --tooltip-text: var(--text-color);
  --datepicker-day-hover-bg: var(--hover-primary);
  --datepicker-day-hover-text: var(--text-color);
  --datepicker-day-selected-bg: var(--color-primary);
  --datepicker-day-selected-text: var(--on-accent);
  --find-input-bg: oklch(from var(--m-text) l c h / 0.06);
  --find-input-focus-bg: var(--page-color);
  --find-input-focus-shadow: var(--shadow-soft);
  --autocomplete-row-hover-bg: oklch(from var(--m-primary) l c h / 0.12);
  --autocomplete-row-hover-text: var(--color-primary);
  --autocomplete-results-bg: var(--page-color);
  --ui-surface-bg: var(--page-color);
  --ui-surface-text: var(--text-color);
  --ui-surface-shadow: var(--popover-shadow);

  /* Sync Indicator (border / sd) */
  --sync-warn-border: var(--m-warn);
  --sync-warn-shadow: 0 0 12px oklch(from var(--m-warn) l c h / 0.25);
  --sync-warn-focus-shadow: 0 0 0 2px oklch(from var(--m-warn) l c h / 0.20), 0 4px 16px oklch(from var(--m-warn) l c h / 0.10);
  --sync-synced-border: transparent;
  --sync-synced-border-color: oklch(from var(--m-primary) l c h / 0.30);
  --sync-synced-focus-shadow: 0 0 0 2px oklch(from var(--m-sidebar-star) l c h / 0.20), 0 4px 12px oklch(from var(--m-ink) l c h / 0.12);
  --search-hit-bg: oklch(from var(--m-highlight-yellow) l c h / 0.40);
  --autocomplete-match-bg: oklch(from var(--m-highlight-yellow) l c h / 0.30);
  --confirmation-btn-hover-bg: var(--embed-hover-bg);
  /* References 卡片：分割线始终 1px，仅颜色随主题 */
  --reference-divider-color: transparent;
  --reference-icon-hover-bg: oklch(from var(--m-primary) l c h / 0.12);

  /* Typography accents / Tags / Blockquote / Warnings */
  --strong-color: var(--heading-h1-color);
  --tag-bg: oklch(from var(--m-primary) l c h / 0.12);
  --tag-bg-hover: oklch(from var(--m-primary) l c h / 0.18);
  --tag-text: var(--m-tag);
  --blockquote-bar: oklch(from var(--m-primary) l c h / 0.55);
  --blockquote-text-color: var(--blockquote-text);
  --blockquote-bar-color: var(--color-primary);
  --blockquote-bar-hover-color: var(--hover-secondary);
  --code-warning-surface: var(--popover-bg);
  --code-warning-code-bg: var(--code-bg);
  --code-warning-text: var(--text-color);
  --code-warning-btn-bg: var(--color-primary-light);
  --code-warning-btn-hover-bg: var(--hover-primary-soft);
  --danger-bg: oklch(from var(--m-highlight-red) l c h / 0.20);
  --danger-border: oklch(from var(--m-highlight-red) l c h / 0.28);

  /* Sidebar (co / sd) */
  --sidebar-text-day: var(--heading-h2-color);
  --sidebar-hover-bg: var(--hover-primary-soft);
  --title-text-shadow: 0 1px 2px oklch(from var(--m-ink) l c h / 0.05);
  --ink-solid: var(--m-ink);
  --bullet-hover-shadow: 0 0 8px oklch(from var(--m-primary) l c h / 0.35);
  --bullet-closed-shadow: 0 0 4px oklch(from var(--m-primary) l c h / 0.45);
  --bullet-focus-border: oklch(from var(--m-secondary) l c h / 0.35);
  --bullet-focus-shadow: oklch(from var(--m-secondary) l c h / 0.40);
  --bullet-focus-fill: var(--m-highlight-red);     /* 绯红 - 圆点 focus 环内填充（红色系） */

  /* Smiley Toggle（未完成=红系与夜间一致，完成=绿） */
  --m-checkbox-unchecked: #C83C23;  /* 绯红 - 未勾选/未完成，日夜统一 */
  --toggle-off-bg: var(--m-checkbox-unchecked);
  --toggle-off-shadow: 0 4px 10px oklch(from var(--m-checkbox-unchecked) l c h / 0.35);
  --toggle-on-bg: var(--checkbox-checked-color);
  --toggle-on-shadow: 0 -4px 10px oklch(from var(--m-checkbox-checked) l c h / 0.35);
  --toggle-face-bg: var(--on-accent);
  --toggle-eye-off: var(--m-checkbox-unchecked);
  --toggle-eye-on: var(--checkbox-checked-color);
  --settings-accent-bg: var(--color-primary);

  /* Highlights - 中国传统色 (co) */
  --highlight-underline: var(--m-highlight-underline);
  --highlight-underline-fade: oklch(from var(--m-highlight-yellow) l c h / 0);
  --highlight-text: inherit;
  --highlight-yellow: var(--m-highlight-yellow);
  --highlight-green: var(--m-highlight-green);
  --highlight-blue: var(--m-highlight-blue);
  --highlight-red: var(--m-highlight-red);
  --highlight-purple: var(--m-highlight-purple);
  --highlight-orange: var(--m-highlight-orange);
  --sidebar-icon-color: var(--m-sidebar-icon);
  --sidebar-icon-hover-color: var(--color-primary);
  --sidebar-icon-hover-filter: none;
  --sidebar-title-color-day: var(--m-sidebar-title-day);
  --sidebar-star-color-day: var(--m-sidebar-star-day);

  /* 布局参数（日夜共享；与 lesswrong/system 思路一致） */
  --transition-normal: 0.25s ease;
  --transition-fast: 0.18s ease;
  --border-radius-sm: 6px;
  --border-radius-md: 8px;
  --border-radius-lg: 12px;
  --border-radius-pill: 20px;
  --ui-surface-radius: var(--border-radius-lg);
  --spacing-xs: 3px;
  --spacing-sm: 5px;
  --spacing-md: 6px;
  --spacing-lg: 8px;
  --spacing-xl: 10px;
  --layout-padding-sm: var(--spacing-lg);
  --layout-padding-md: 12px;
  --layout-padding-lg: 16px;
  --layout-padding-xl: 24px;
  --layout-padding-article-v: 24px;
  --layout-padding-article-h: 40px;
  --layout-margin-block: 0.5rem;
  --fs-app-base: 16px;
  --block-spacing: calc(var(--lh-content) / 6 * 1em);
  --lh-display: 1.3;
  --lh-h1: 1.3;
  --lh-h2: 1.3;
  --lh-h3: 1.3;
  --lh-content: 1.5;
  --lh-quote: 1.45;
  --lh-tag: 1.35;
  --lh-title: 1.2;
  --fs-page-title: 1.8rem;
  --fs-h1: 1.5rem;
  --fs-h2: 1.25rem;
  --fs-h3: 1.1rem;
  --fs-body: 1rem;
  --fs-quote: 1.15rem;
  --fs-tag: 0.9rem;
  --font-size: var(--fs-body);

  color-scheme: light;
}

/* Night Mode - 与日间同标准：黑/灰系（标题·正文·引用·H1-H3 有层次），彩色系（标签·双链·外链 色相环隔开），APCA 负极性 Lc 60–80，禁纯白 */
html.rm-dark-theme,
body.rm-dark-theme,
html.rm-dark-theme .roam-app,
body.rm-dark-theme .roam-app .roam-app,
.rm-dark-theme .roam-app {
  --m-bg: #2B333E;         /* 玄青 - 主背景（固定） */
  --m-surface: #2B333E;    /* 玄青（固定） */
  --m-text: #E6EAE9;       /* 月影白 - 正文 */
  --m-text-muted: #A1AFC9; /* 蓝灰 */
  --m-ink: #161823;        /* 漆黑 - 边框/阴影 */
  --m-primary: #1685A9;    /* 石青 - 主色 */
  --m-secondary: #C83C23;  /* 绯红 - 分裂补色 */
  --m-sidebar-title: #48C0A3;    /* 青碧 */
  --m-sidebar-star: #48C0A3;
  --m-checkbox-checked: #2ADD9C;  /* 碧绿 */
  --m-code-selection: #065279;   /* 靛蓝 */
  --m-on-accent: #E9F1F6;        /* 霜色 - 非纯白 */
  --m-sidebar-icon: #D6ECF0;     /* 月白 */
  --m-popover: #3D3B4F;          /* 玄色 - 弹层 */
  --m-reference-strong: var(--m-sidebar-star);
  --m-warn: #E85A5A;             /* 丹亮 - 警示（夜间可读） */
  /* 灰/白系（层次：由亮到柔，对应日间由深到浅） */
  --m-title-display: #F2ECDE;    /* 缟 - 页面标题（最亮，非纯白） */
  --m-heading-h1: #F2ECDE;       /* 缟 - H1 */
  --m-heading-h2: #E6EAE9;       /* 月影白 - H2 */
  --m-heading-h3: #C8CED8;       /* 灰蓝 - H3 */
  --m-blockquote: #A1AFC9;       /* 蓝灰 - 引用块正文 */
  /* 彩色系（黄·蓝·红紫，与日间 标签/双链/外链 色相一一对应） */
  --m-page-tag: #75878A;         /* 苍色 - 弱化标签区 */
  --m-tag: #E8A84B;              /* 琥珀亮 - 标签（黄色系） */
  --m-tag-hover: #F0C239;        /* 缃色 - 标签 hover */
  --m-page-ref: #44CEF6;         /* 蓝 - 双链（蓝系，与日间靛青同色相） */
  --m-page-ref-hover: #70F3FF;   /* 蔚蓝 - 双链 hover */
  --m-link: #D2A4C8;             /* 绛紫亮 - 外链（红紫） */
  --m-link-hover: #E8C4DC;       /* 外链 hover */
  /* 行内高亮（与日间同色相，亮度适配深底，Lc 60–80） */
  --m-highlight-underline: #6E6290;   /* 雪青加深 */
  --m-highlight-yellow: #F0C239;      /* 缃色 */
  --m-highlight-green: #4BAF88;      /* 碧色亮 - 深底可读 */
  --m-highlight-blue: #5BA3C9;       /* 群青亮 */
  --m-highlight-red: #E85A5A;        /* 绯红亮 */
  --m-highlight-purple: #B0A4E3;     /* 雪青 */
  --m-highlight-orange: #E8A84B;     /* 琥珀亮 */

  --block-highlight-bg: oklch(from var(--m-primary) l c h / 0.20);
  --color-subtle-border: oklch(from var(--m-text) l c h / 0.08);
  --code-bg: oklch(from var(--m-text) l c h / 0.03);
  --inline-code-bg: oklch(from var(--m-text) l c h / 0.06);
  --embed-bg: oklch(from var(--m-text) l c h / 0.03);
  --embed-hover-bg: oklch(from var(--m-text) l c h / 0.06);
  --reference-item-bg: oklch(from var(--m-text) l c h / 0.04);
  --reference-item-hover-bg: oklch(from var(--m-text) l c h / 0.08);
  --kanban-column-bg: oklch(from var(--m-text) l c h / 0.02);
  --kanban-card-bg: oklch(from var(--m-text) l c h / 0.04);
  --kanban-card-hover-bg: oklch(from var(--m-text) l c h / 0.07);
  --popover-shadow: 0 4px 24px oklch(from var(--m-ink) l c h / 0.35);
  --shadow-soft: 0 8px 24px oklch(from var(--m-ink) l c h / 0.32);
  --shadow-floating: 0 10px 30px oklch(from var(--m-ink) l c h / 0.38);
  --focus-ring: 0 0 0 3px oklch(from var(--m-primary) l c h / 0.35);
  --selection-bg: oklch(from var(--m-primary) l c h / 0.58);
  --selection-text: var(--m-on-accent);
  --scrollbar-track: oklch(from var(--m-text) l c h / 0.05);
  --scrollbar-thumb: oklch(from var(--m-primary) l c h / 0.40);
  --scrollbar-thumb-hover: oklch(from var(--m-primary) l c h / 0.55);
  --menu-hover-bg: var(--hover-primary-strong);
  --menu-divider-color: var(--color-subtle-border);
  --menu-hover-text: var(--on-accent);
  --sidebar-hover-bg: oklch(from var(--m-primary) l c h / 0.22);
  --btn-disabled-text: oklch(from var(--m-text) l c h / 0.55);
  --datepicker-day-hover-bg: oklch(from var(--m-text) l c h / 0.10);
  --datepicker-day-hover-text: var(--on-accent);
  --find-input-bg: oklch(from var(--m-text) l c h / 0.05);
  --find-input-focus-bg: var(--bg-color);
  --find-input-focus-shadow: 0 0 0 2px oklch(from var(--m-primary) l c h / 0.30);
  --autocomplete-row-hover-bg: oklch(from var(--m-primary) l c h / 0.15);
  --autocomplete-row-hover-text: var(--text-color);
  --autocomplete-results-bg: var(--page-color);
  --sync-warn-border: var(--m-warn);
  --sync-warn-shadow: 0 0 12px oklch(from var(--m-warn) l c h / 0.25);
  --sync-warn-focus-shadow: 0 0 0 2px oklch(from var(--m-warn) l c h / 0.20), 0 4px 16px oklch(from var(--m-warn) l c h / 0.10);
  --search-hit-bg: oklch(from var(--m-highlight-yellow) l c h / 0.25);
  --autocomplete-match-bg: oklch(from var(--m-highlight-yellow) l c h / 0.20);
  --confirmation-btn-hover-bg: var(--reference-item-hover-bg);
  --reference-divider-color: transparent;
  --reference-icon-hover-bg: oklch(from var(--m-primary) l c h / 0.18);
  --tag-bg: oklch(from var(--m-text) l c h / 0.08);
  --tag-bg-hover: oklch(from var(--m-text) l c h / 0.12);
  --tag-text: var(--m-tag);
  --blockquote-bar: oklch(from var(--m-primary) l c h / 0.55);
  --blockquote-text-color: var(--text-color);
  --blockquote-bar-color: var(--blockquote-bar);
  --blockquote-bar-hover-color: oklch(from var(--m-primary) l c h / 1);
  --highlight-underline: var(--m-highlight-underline);
  --highlight-underline-fade: oklch(from var(--m-highlight-yellow) l c h / 0);
  --highlight-text: inherit;
  --highlight-yellow: var(--m-highlight-yellow);
  --highlight-green: var(--m-highlight-green);
  --highlight-blue: var(--m-highlight-blue);
  --highlight-red: var(--m-highlight-red);
  --highlight-purple: var(--m-highlight-purple);
  --highlight-orange: var(--m-highlight-orange);
  --code-warning-surface: var(--popover-bg);
  --code-warning-code-bg: oklch(from var(--m-ink) l c h / 0.55);
  --code-warning-text: var(--on-accent);
  --code-warning-btn-bg: oklch(from var(--m-primary) l c h / 0.20);
  --code-warning-btn-hover-bg: oklch(from var(--m-primary) l c h / 0.28);
  --danger-bg: oklch(from var(--m-highlight-red) l c h / 0.40);
  --danger-border: oklch(from var(--m-text) l c h / 0.10);
  --bullet-hover-shadow: 0 0 8px oklch(from var(--m-primary) l c h / 0.35);
  --bullet-closed-shadow: 0 0 4px oklch(from var(--m-primary) l c h / 0.45);
  --bullet-focus-border: oklch(from var(--m-secondary) l c h / 0.35);
  --bullet-focus-shadow: oklch(from var(--m-secondary) l c h / 0.30);
  --bullet-focus-fill: var(--m-highlight-red);     /* 绯红亮 - 夜间圆点 focus 环内填充（红色系） */
  --toggle-off-shadow: 0 4px 10px oklch(from var(--m-secondary) l c h / 0.25);
  --toggle-on-shadow: 0 -4px 10px oklch(from var(--m-checkbox-checked) l c h / 0.30);
  --ink-solid: var(--m-ink);

  color-scheme: dark;
}

/* Visual system checklist:
 * 色值来自 colors.masantu.com / 0xu.cn 中国传统色；
 * 日间 Lc ≥75，夜间 Lc 60–80，正文非 #FFFFFF；
 * 选择器仅用 index.html DOM；未改 font-family/font-size；
 * 滚动条/::selection 用变量；变量带 Safe Fallback。
 * 权重：主题基础 CSS 权重较高时，可用 .roam-app 提高选择器特异性以替代部分 !important，便于后续微调。 */

/* ========================================================= */
/* 2. Global Overrides (Fix Inline Styles)                   */
/* ========================================================= */

body .rm-menu-item[style*="background-color"],
body .rm-menu-item[style*="background"] {
  background-color: var(--color-primary-light) !important;
  color: var(--text-color) !important;
}

body .rm-search-list-item span[style*="background-color: yellow"],
body .rm-search-list-item span[style*="background-color:yellow"] {
  background-color: var(--search-hit-bg) !important;
  border-radius: 2px;
  color: var(--text-color) !important;
  padding: 0 2px;
}

:is(html, body):not(.rm-dark-theme) {
  background: var(--m-bg) !important;
}

body:not(.rm-dark-theme) .roam-app {
  background: var(--bg-color) !important;
}

body:not(.rm-dark-theme) .bp3-dark,
body:not(.rm-dark-theme) .bp3-dark .bp3-menu,
body:not(.rm-dark-theme) .bp3-dark .bp3-popover-content {
  background: var(--page-color) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

body:not(.rm-dark-theme) .bp3-dark .bp3-menu-item,
body:not(.rm-dark-theme) .bp3-dark .bp3-button {
  color: var(--text-color) !important;
}

body:not(.rm-dark-theme) .bp3-dark .bp3-button:not([class*="bp3-intent-"]) {
  background: transparent !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

body:not(.rm-dark-theme) .bp3-dark .bp3-menu-item:hover,
body:not(.rm-dark-theme) .bp3-dark .bp3-button:hover,
body:not(.rm-dark-theme) .bp3-dark .bp3-button:not([class*="bp3-intent-"]):hover {
  background: var(--sidebar-hover-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

body:not(.rm-dark-theme) .bp3-dark .bp3-input {
  background: var(--embed-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

/* ========================================================= */
/* 3. Base Layout                                            */
/* ========================================================= */

.roam-app .roam-article {
  padding: 0;
}

.roam-app .roam-article > div {
  background: var(--page-color);
  border: none;
  border-radius: 0;
  box-shadow: none;
  font-size: var(--fs-app-base);  /* things-auto 15px 基准，使 1rem = 15px */
  margin: 0 auto;
  padding: var(--layout-padding-article-v) var(--layout-padding-article-h);
  width: auto;
}

/* 仅标题块自身内容区透明，不作用到其子块（避免回车后新块被当成标题样式）；[style*="background"] 需 !important 覆盖内联 */
body:not(.rm-dark-theme) .roam-app .roam-block-container:is(.rm-level1, .rm-level2, .rm-level3, .rm-heading-level-1, .rm-heading-level-2, .rm-heading-level-3) > .rm-block-main,
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-level1 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-heading-level-1 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-level2 > .rm-block-main :is(.rm-block-main, .rm-block__input, .rm-block-text),
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-heading-level-2 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-level3 > .rm-block-main :is(.rm-block-main, .rm-block__input, .rm-block-text),
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-heading-level-3 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-heading-level-1 > .rm-block-main [style*="background"],
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-heading-level-2 > .rm-block-main [style*="background"],
body:not(.rm-dark-theme) .roam-app .roam-block-container.rm-heading-level-3 > .rm-block-main [style*="background"] {
  background: transparent !important;
}

.roam-app .roam-body-main {
  position: relative;
  top: 0;
  height: 100%;
  width: auto;
  padding-left: 0;
}

.roam-app .roam-main {
  margin: auto;
  width: unset;
  max-width: 100%;
  height: 100%;
  overflow-x: scroll;
  overflow-y: hidden;
  transition: padding-left 0.15s ease-out;
}

/* 编辑页面标题时取消横向裁切，避免标题与光标被截断 */
.roam-app .roam-main:has(.rm-title-editing-display),
.roam-app .roam-body-main:has(.rm-title-editing-display),
.roam-app .rm-article-wrapper:has(.rm-title-editing-display),
.roam-app .roam-article:has(.rm-title-editing-display) {
  overflow-x: visible;
}

/* ========================================================= */
/* 4. Typography                                             */
/* ========================================================= */

/* 标题字体：仅 h1–h6 与页面标题编辑区，不包含 .rm-level* 以免子块继承 */
.roam-app :is(h1, h2, h3, h4, h5, h6, .rm-title-editing-display) {
  color: var(--text-color);
  font-family: var(--heading-font);
}

/* 与 .rm-title-display 一致：focus 编辑时字号、字距不变化（避免字被拉宽）；无多余 padding/border/margin 避免整区下移 */
.roam-app .rm-title-editing-display textarea {
  color: var(--title-display-color);
  font-family: var(--title-font);
  font-size: var(--fs-page-title);
  font-weight: 700;
  line-height: var(--lh-display);
  letter-spacing: -0.02em;
  font-optical-sizing: auto;
  margin: 0 !important;
  padding: 0 !important;
  border: none !important;
  min-height: 0;
  resize: none;
  vertical-align: top;
}

/* focus 时页面标题完整显示，不裁切文字与光标 */
.roam-app .roam-article > div:has(.rm-title-editing-display) {
  overflow-x: visible;
}
/* 标题容器：展示/编辑切换时保持同一垂直占位，避免整区下移 */
.roam-app .rm-title-display-container {
  margin: 0;
  padding: 0;
}
.roam-app .rm-title-display-container:has(.rm-title-editing-display) {
  overflow: visible;
  min-width: 0;
  margin-top: 0 !important;
  padding-top: 0 !important;
}
/* 正文区第一个块（标题所在）：无论 focus 与否都无上边距，防止整区下移 */
.roam-app .roam-article > div > .rm-block-children.rm-level-0 > .roam-block-container:first-child {
  margin-top: 0 !important;
  padding-top: 0 !important;
}
.roam-app .rm-title-display-container .rm-title-editing-display,
.roam-app .roam-article .rm-title-display-container .rm-title-editing-display {
  overflow: visible;
  min-width: 0;
  width: 100%;
  margin: 0 !important;
  padding: 0 !important;
}
.roam-app .rm-title-display-container .rm-title-editing-display textarea,
.roam-app .roam-article .rm-title-display-container .rm-title-editing-display textarea {
  overflow: visible;
  min-width: 100%;
  width: 100%;
  box-sizing: border-box;
}

.roam-app div,
.roam-app textarea {
  color: var(--text-color);
  font-family: var(--body-font);
  font-size: var(--font-size);
}

/* 正文：展示态 .rm-block-text 与编辑态 .rm-block__input 字号/行高一致（things-auto --fs-main: 1rem） */
.roam-app .roam-article,
.roam-app .roam-article .rm-block-text,
.roam-app .roam-article .rm-block__input,
.roam-app .rm-block-text,
.roam-app .roam-block {
  color: var(--text-color);
  font-family: var(--body-font);
  font-size: var(--fs-body);
  font-weight: 400;
  line-height: var(--lh-content);
  min-height: 1.6em;
  -webkit-font-smoothing: antialiased;
}

.roam-app .roam-article strong,
.roam-app .roam-article b,
.roam-app strong,
.roam-app b {
  color: var(--strong-color);
  font-family: 'Palatino Linotype', 'Palatino', 'FZPingXianYaSong-B', '方正屏显雅宋', serif;
  font-weight: 700;
}

.roam-app :is(.rm-title-display-container .rm-title-display, .roam-article .rm-title-display, h1.rm-title-display, .rm-title-display) {
  color: var(--title-display-color);
  font-family: var(--title-font);
  font-size: var(--fs-page-title);
  font-weight: 700;
  line-height: var(--lh-display);
  letter-spacing: -0.02em;
  font-optical-sizing: auto;
  margin: 0;
  padding: 0;
}

.roam-app :is(.roam-article .rm-title-display em, .roam-article .rm-title-display i, .rm-title-display em, .rm-title-display i) {
  font-family: 'Arno Pro Display', 'Arno Pro', serif;
  font-style: italic;
  font-weight: 700;
  padding-right: 0.1em;
}

/* 仅标题块自身内容区，不作用到 .rm-block-children 内子块（回车后新块保持正文） */
.roam-app :is(h1:not(.rm-title-display), .roam-block-container.rm-level1 > .rm-block-main, .roam-block-container.rm-level1 > .rm-block-main .rm-block-text, .roam-block-container.rm-heading-level-1 > .rm-block__self .rm-block__input, .roam-block-container.rm-heading-level-1 > .rm-block-main .rm-block__input, .roam-block-container.rm-heading-level-1 > .rm-block-main .rm-block-text) {
  color: var(--heading-h1-color);
  font-family: var(--heading-font);
  font-size: var(--fs-h1);
  font-weight: 700;
  line-height: var(--lh-h1);
  letter-spacing: 0.03em;
  transition: color 0.2s ease;
}

/* 块与块统一间距（正文、标题、子块均用同一变量） */
.roam-app .roam-article .roam-block-container {
  margin-bottom: var(--block-spacing);
}

.roam-app .roam-article .roam-block-container.rm-level1 {
  font-size: var(--fs-h1);  /* 使 block-spacing 的 1em 按 H1 字号算，间距随层级缩放 */
  border-bottom: 1px solid var(--color-subtle-border);
  margin-bottom: calc(var(--block-spacing) * 1.2);
  padding-bottom: 0.35em;
}

/* H2：Roam 内建选择器权重较高，保留 !important 保证主题生效 */
.roam-app :is(h2, .roam-block-container.rm-level2 > .rm-block-main, .roam-block-container.rm-level2 > .rm-block-main .rm-block-text, .roam-block-container.rm-heading-level-2 > .rm-block__self .rm-block__input, .roam-block-container.rm-heading-level-2 > .rm-block-main .rm-block__input, .roam-block-container.rm-heading-level-2 > .rm-block-main .rm-block-text) {
  color: var(--heading-h2-color) !important;
  font-family: var(--heading-font) !important;
  font-size: var(--fs-h2) !important;
  font-weight: 600 !important;
  line-height: var(--lh-h2) !important;
  letter-spacing: 0.01em !important;
  transition: color 0.2s ease;
}

.roam-app .roam-article .roam-block-container.rm-level2 {
  font-size: var(--fs-h2);
  margin-bottom: calc(var(--block-spacing) * 1.2) !important;
}

.roam-app :is(h3, .roam-block-container.rm-level3 > .rm-block-main, .roam-block-container.rm-level3 > .rm-block-main .rm-block-text, .roam-block-container.rm-heading-level-3 > .rm-block__self .rm-block__input, .roam-block-container.rm-heading-level-3 > .rm-block-main .rm-block__input, .roam-block-container.rm-heading-level-3 > .rm-block-main .rm-block-text) {
  color: var(--heading-h3-color);
  font-family: var(--heading-font);
  font-size: var(--fs-h3);
  font-weight: 600;
  line-height: var(--lh-h3);
  transition: color 0.2s ease;
}

.roam-app .roam-article .roam-block-container.rm-level3 {
  font-size: var(--fs-h3);
  margin-bottom: calc(var(--block-spacing) * 1.2);
}

.roam-app a {
  color: var(--color-secondary);
  font-weight: 600;
}

body:not(.rm-dark-theme) .roam-app a:not(.rm-alias--page):not(.rm-alias--block),
body:not(.rm-dark-theme) .roam-app .rm-alias--external {
  color: var(--m-link);
  text-decoration: none;
  border-bottom: none;
  letter-spacing: 0;
  text-shadow: none;
}

body:not(.rm-dark-theme) .roam-app a:not(.rm-alias--page):not(.rm-alias--block):hover,
body:not(.rm-dark-theme) .roam-app .rm-alias--external:hover {
  color: var(--m-link-hover, var(--m-link)) !important;
  text-decoration: none !important;
  border-bottom: none !important;
  font-weight: 800 !important;
  letter-spacing: 0.03em;
  text-shadow: 0 0 0.5px currentColor, 0 1px 2px rgba(0,0,0,0.08);
}

.roam-app .rm-alias--external,
.roam-app .rm-alias--external:hover {
  font-weight: 600;
}

.roam-app .rm-inline-code,
.roam-app code,
.roam-app strong,
.roam-app em {
  line-height: inherit;
  vertical-align: baseline;
}

/* ========================================================= */
/* 5. Code Blocks                                            */
/* ========================================================= */

.roam-app .rm-code-block .cm-editor,
.roam-app .rm-code-block .cm-content,
.roam-app .rm-code-block .cm-line,
.roam-app .rm-code-block .cm-gutters {
  background: transparent;
  border: none;
  color: var(--text-color);
  font-family: var(--code-font) !important;
  font-size: 0.875rem;
}

/* 当前行行号：压过 CodeMirror 默认，背景与正文一致，行号用主题色+代码字体 */
.roam-app .cm-focused .cm-activeLineGutter {
  background-color: transparent !important;
  color: var(--color-primary) !important;
  font-family: var(--code-font) !important;
}

.roam-app .roam-article .rm-code-block,
.roam-app .roam-article .rm-inline-code,
.roam-app .rm-code-block,
.roam-app .rm-code-block code,
.roam-app code,
.roam-app kbd,
.roam-app pre {
  font-family: var(--code-font) !important;
  font-size: 0.875rem;
  font-variant-ligatures: contextual;
  font-feature-settings: "calt" 1;
}

.roam-app .rm-code-block {
  background: var(--code-bg);
  border: none;
  border-radius: var(--border-radius-md);
  margin: 4px 0 var(--layout-padding-sm);
  padding: 12px var(--layout-padding-md);
}

.roam-app .rm-inline-code,
.roam-app code {
  background: var(--inline-code-bg);
  border: none;
  border-radius: 4px;
  color: var(--color-secondary);
  padding: 2px 6px;
}

.roam-app .cm-comment,
.roam-app .cm-variable-2,
.roam-app .cm-attribute {
  font-family: 'Operator Mono', monospace;
  font-style: italic;
  opacity: 0.9;
}

.roam-app .cm-selectionBackground,
.roam-app .cm-focused .cm-selectionBackground {
  background-color: var(--block-highlight-bg) !important;
}

.roam-app .rm-code-block .cm-line::selection,
.roam-app .cm-content ::selection,
.roam-app code::selection {
  background: transparent;
  color: inherit;
}

/* ========================================================= */
/* 6. Embed & Query                                          */
/* ========================================================= */

.roam-app .rm-embed-container {
  background: var(--embed-bg);
  border: none;
  border-radius: var(--border-radius-md);
  box-shadow: none;
  margin: 4px 0 12px;
  padding: var(--layout-padding-md) 20px;
  transition: var(--transition-normal);
}

.roam-app .rm-embed-container:hover {
  background: var(--embed-hover-bg);
}

.roam-app .rm-query {
  background: transparent;
  border: none;
  border-radius: var(--border-radius-md);
  box-shadow: none;
  overflow: hidden;
}

.roam-app .rm-query .rm-query-title,
.roam-app .rm-reference-main.rm-query-content {
  padding: 0.8em 0;
}

.roam-app .rm-query .rm-query-title {
  background-color: transparent;
  border-bottom: 1px solid var(--color-subtle-border);
  color: var(--light-text-color);
  font-size: 0.8rem;
}

.roam-app .rm-reference-main,
.roam-app .rm-reference-item {
  font-size: 0.95rem;
  opacity: 0.95;
}

.roam-app .rm-reference-main .rm-reference-item .controls {
  margin-left: -1em;
}

.roam-app .rm-reference-item {
  background-color: var(--reference-item-bg);
  border: none;
  border-radius: var(--border-radius-sm);
  flex: 0 1 auto;
  margin: var(--layout-padding-sm) var(--layout-padding-sm) 0 0;
  padding: 10px 18px;
  transition: var(--transition-fast);
  word-break: break-word;
}

.roam-app .rm-reference-item:hover {
  background-color: var(--reference-item-hover-bg);
}

.roam-app .rm-unlinked-reference-container strong {
  color: var(--reference-title-color);
}

/* ========================================================= */
/* 7. Sidebar                                                */
/* ========================================================= */

.roam-app .roam-sidebar-container {
  position: relative;
  z-index: 1;
  flex-shrink: 0;
  background: var(--bg-color);
  border-right: none;
  box-shadow: none;
}

.roam-app .roam-sidebar-container .rm-db-title-container .rm-db-title {
  color: var(--sidebar-title-color);
  font-family: "Felix Titling", "方正清刻本悦宋简体";
  font-size: 1.45rem;
  font-weight: 700;
  letter-spacing: 0.02em;
  padding: var(--layout-padding-sm) 10px;
  text-shadow: var(--title-text-shadow);
}

body:not(.rm-dark-theme) .roam-app .roam-sidebar-container .rm-db-title-container .rm-db-title {
  color: var(--sidebar-title-color-day);
}

body:not(.rm-dark-theme) .roam-app .roam-sidebar-content .log-button,
body:not(.rm-dark-theme) .roam-app .roam-sidebar-content .top-row,
body:not(.rm-dark-theme) .roam-app .roam-sidebar-content .starred-pages .page {
  background: transparent !important;
  color: var(--sidebar-text-day) !important;
}

body:not(.rm-dark-theme) .roam-app .roam-sidebar-content .log-button:hover,
body:not(.rm-dark-theme) .roam-app .roam-sidebar-content .top-row:hover,
body:not(.rm-dark-theme) .roam-app .roam-sidebar-content .starred-pages .page:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--sidebar-text-day) !important;
}

.roam-app .roam-sidebar-content .log-button,
.roam-app .roam-sidebar-content .top-row {
  background: transparent;
  border: none;
  border-radius: var(--border-radius-sm);
  color: var(--text-color);
  font-size: 1.05rem;
  font-weight: 500;
  margin: 2px 6px;
  padding: var(--layout-padding-sm) 12px;
  transition: color var(--transition-fast), background-color var(--transition-fast), transform var(--transition-fast);
}

.roam-app .roam-sidebar-content .log-button:hover,
.roam-app .roam-sidebar-content .top-row:hover {
  background: var(--sidebar-hover-bg);
  box-shadow: none;
  color: var(--text-color);
  transform: translateX(2px);
}

.roam-app .roam-sidebar-container .roam-sidebar-content .top-row {
  justify-content: center !important;
}

.roam-app .roam-sidebar-container .roam-sidebar-content .top-row > .flex-h-box:first-child {
  position: relative;
  z-index: 99999 !important;
  flex: 0 0 auto !important;
  width: fit-content !important;
  min-width: 0;
}

.roam-app .roam-sidebar-container .rm-db-title-container {
  width: fit-content;
}

.roam-app .flex-v-box.starred-pages-wrapper,
.roam-app .roam-sidebar-container .starred-pages-wrapper {
  position: relative;
  z-index: 0;
}

.roam-app .flex-v-box.starred-pages-wrapper > div.flex-h-box.title,
.roam-app .flex-h-box.title .bp3-icon-star + div + span {
  z-index: 0;
}

.roam-app .starred-pages-wrapper > .flex-h-box.title {
  gap: 0;
  justify-content: center;
}

/* 隐藏 SHORTCUTS 左侧星星 */
.roam-app .starred-pages-wrapper .flex-h-box.title .bp3-icon-star {
  display: none !important;
}

/* 星星与 SHORTCUTS 之间间距（已隐藏星星，保留 0 便于后续若恢复） */
.roam-app .starred-pages-wrapper .flex-h-box.title > div {
  flex: 0 0 0px !important;
  min-width: 0px !important;
  max-width: 0px !important;
}

.roam-app .starred-pages-wrapper > .flex-h-box.title > span {
  color: var(--sidebar-star-color);
  font-size: 1.05rem;
  font-weight: 700;
  letter-spacing: 0.12em;
  opacity: 0.9;
}

body:not(.rm-dark-theme) .roam-app .starred-pages-wrapper > .flex-h-box.title > span {
  color: var(--sidebar-star-color-day) !important;
}

/* SHORTCUTS 下列表与标题居中对齐 */
.roam-app .roam-sidebar-content .starred-pages {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.roam-app .roam-sidebar-content .starred-pages > a {
  display: block;
  padding-left: 0;
  text-decoration: none;
}

.roam-app .roam-sidebar-content .starred-pages .page {
  background: transparent;
  border-left: none;
  border-radius: var(--border-radius-sm);
  box-shadow: none;
  color: var(--text-color);
  font-size: 1.05rem;
  font-weight: 500;
  margin: 2px 6px;
  margin-left: 0 !important;
  opacity: 1;
  padding: var(--layout-padding-sm) 12px;
  padding-left: 0 !important;
  transition: var(--transition-fast);
}

.roam-app .roam-sidebar-content .starred-pages .page:hover {
  background: var(--sidebar-hover-bg);
  box-shadow: none;
  color: var(--text-color);
}

.roam-app .roam-sidebar-container > * {
  box-shadow: none;
  opacity: 1;
}

.roam-app .roam-sidebar-content > div > div {
  color: var(--text-color);
  font-size: 1.05rem;
  letter-spacing: 0.02em;
}

body:not(.rm-dark-theme) .roam-app .roam-sidebar-content > div > div {
  color: var(--sidebar-text-day) !important;
}

.bp3-overlay {
  z-index: 10000 !important;
}

/* Graph dropdown：仅配色与字体，结构对齐 system.css（.rm-graph-dropdown / menu-title / menu-item / setting / signout） */
.bp3-popover:has(.rm-graph-dropdown),
.bp3-overlay .bp3-popover:has(.rm-graph-dropdown) {
  position: relative;
  z-index: 99999 !important;
  width: 220px !important;
}

.roam-app .bp3-menu.rm-graph-dropdown {
  font-family: var(--body-font);
  font-size: var(--font-size);
  font-weight: 400;
  color: var(--text-color);
}

.roam-app .bp3-menu.rm-graph-dropdown .menu-title {
  color: var(--light-text-color);
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
}

.roam-app .bp3-menu.rm-graph-dropdown .menu-item {
  color: var(--text-color);
  font-size: inherit;
}

.roam-app .bp3-menu.rm-graph-dropdown .menu-item:hover {
  color: var(--menu-hover-text);
}

.roam-app .bp3-menu.rm-graph-dropdown .setting,
.roam-app .bp3-menu.rm-graph-dropdown .bp3-menu-item.setting {
  background-color: transparent;
  color: var(--text-color);
  font-size: var(--font-size);
}

.roam-app .bp3-menu.rm-graph-dropdown .setting {
  border-top: 1px solid var(--menu-divider-color);
}

.roam-app .bp3-menu.rm-graph-dropdown .setting a {
  color: var(--text-color);
  font-weight: 500;
}

.roam-app .bp3-menu.rm-graph-dropdown .setting:hover {
  background-color: var(--menu-hover-bg);
}

.roam-app .bp3-menu.rm-graph-dropdown .setting:hover a {
  color: var(--menu-hover-text);
}

.roam-app .bp3-menu.rm-graph-dropdown .bp3-menu-item .icon.settings {
  color: var(--light-text-color);
}

.roam-app .bp3-menu.rm-graph-dropdown .bp3-menu-item:hover .icon.settings {
  color: var(--menu-hover-text);
}

.roam-app .bp3-menu.rm-graph-dropdown .signout {
  font-size: 0.9rem;
  font-weight: 500;
  opacity: 0.9;
  color: var(--text-color);
}

.roam-app .bp3-menu.rm-graph-dropdown .rm-graphs__search .bp3-input,
.roam-app .bp3-menu.rm-graph-dropdown .bp3-input-group.rm-graphs__search .bp3-input {
  background-color: var(--embed-bg);
  color: var(--text-color);
  font-family: var(--body-font);
  font-size: var(--font-size);
}

.roam-app .bp3-menu.rm-graph-dropdown .rm-graphs__search .bp3-input::placeholder,
.roam-app .bp3-menu.rm-graph-dropdown .bp3-input-group.rm-graphs__search .bp3-input::placeholder {
  color: var(--light-text-color);
}

.roam-app .bp3-menu.rm-graph-dropdown .rm-graphs__search .bp3-icon,
.roam-app .bp3-menu.rm-graph-dropdown .bp3-input-group.rm-graphs__search .bp3-icon {
  color: var(--light-text-color);
}

.roam-app .roam-sidebar-content .bp3-icon {
  color: var(--sidebar-icon-color);
  transition: color 0.2s ease;
}

.roam-app .roam-sidebar-content .log-button:hover .bp3-icon,
.roam-app .roam-sidebar-content .top-row:hover .bp3-icon {
  color: var(--sidebar-icon-hover-color);
  filter: var(--sidebar-icon-hover-filter);
}

.roam-app .roam-sidebar-container img[style*="astrolabe"],
.roam-app .roam-sidebar-container img[data-wheelzoom-original-src*="astrolabe"] {
  filter: sepia(0.3) saturate(1.2) brightness(0.6) !important;
  opacity: 0.8;
}

.roam-app .roam-sidebar-container img[style*="astrolabe"] ~ span,
.roam-app .roam-sidebar-container img[data-wheelzoom-original-src*="astrolabe"] ~ span {
  color: var(--color-primary) !important;
}

.roam-app #roam-sidebar-logo:hover {
  background: transparent !important;
  text-decoration: none !important;
}

.roam-app #right-sidebar {
  background-color: var(--bg-color) !important;
  border-left: 1px solid var(--color-subtle-border) !important;
  z-index: 999 !important;
  transition: flex-basis 0.2s ease-in-out, width 0.2s ease-in-out;
}

.roam-app #right-sidebar > div {
  background: transparent;
  border-left: none;
  box-shadow: none;
  padding: 20px;
}

.roam-app .bp3-icon-menu,
.roam-app .rm-open-left-sidebar-btn {
  display: none !important;
  width: 0 !important;
  margin: 0 !important;
  padding: 0 !important;
}

.roam-app .rm-topbar:has(.rm-open-left-sidebar-btn):not(:has(#todayTomorrow)):not(:has(#workspaces)) > .speech-to-roam.speech-to-roam-container-top {
  left: 0 !important;
}

.roam-app .rm-multibar {
  display: none !important;
}

/* ========================================================= */
/* 8. Bullet Points & Block References                       */
/* ========================================================= */

.roam-app #block-input {
  background: var(--bg-color);
}

.roam-app #block-input > span > div {
  background: var(--bg-color);
  padding: 6px 24px;
}

.roam-app #block-input-ghost span {
  color: var(--text-color) !important;
}







.roam-app .rm-sidebar-outline .roam-block-container .rm-block__input a[href],
.roam-app .rm-zoom .roam-block-container .rm-block__input a[href],
.roam-app .rm-reference-item .roam-block-container .rm-block__input a[href] {
  overflow-wrap: break-word !important;
  word-break: break-word !important;
}

.roam-app .controls {
  display: flex;
  align-items: center;
  justify-content: center;
  align-self: flex-start !important;
  flex: 0 0 auto !important;
  height: 2.05em !important;
  margin-right: 6px !important;
  padding-right: 0 !important;
}

.roam-app .rm-heading-level-1 .controls {
  height: calc(1.6em * 1.4) !important;
}

.roam-app .rm-heading-level-2 .controls {
  height: calc(1.4em * 1.55) !important;
}

.roam-app .rm-heading-level-3 .controls {
  height: calc(1.25em * 1.75) !important;
}

/* 引用块所在行的 controls：仍用 :has()；若大页面卡顿可考虑移除或改 JS 注入类 */
.roam-app .roam-block-container:has(.rm-bq) .controls {
  margin-top: 4px !important;
  margin-right: 6px !important;
  height: 2.05em !important;
}

.roam-app .roam-block-container:has(.check-container) .controls {
  margin-right: 2px !important;
}

.roam-app .rm-bullet .rm-bullet__inner,
.roam-app .rm-bullet.rm-bullet--closed .rm-bullet__inner,
.roam-app .rm-bullet__inner--user-icon {
  box-sizing: content-box;
  display: flex;
  align-items: center;
  overflow: hidden;
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.roam-app .rm-bullet .rm-bullet__inner {
  background-color: transparent;
  background-clip: padding-box;
  border: 2px solid var(--light-text-color);
  margin: 1px;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.roam-app .rm-bullet .rm-bullet__inner:hover {
  background-color: var(--color-primary);
  border-color: var(--color-primary);
  box-shadow: var(--bullet-hover-shadow);
  transform: scale(1.25);
}

.roam-app .rm-bullet.rm-bullet--closed .rm-bullet__inner {
  background-color: var(--color-primary) !important;
  border: 4px solid transparent !important;
  margin: 0;
  box-shadow: var(--bullet-closed-shadow);
}

.roam-app .rm-bullet__inner--user-icon {
  background-color: var(--ink-solid);
  background-clip: content-box;
  border: 4px solid transparent;
}

/* 内容块 focus 时：圆点不缩小，保持原环，环内填色 + 内发光 + 外亮光（红色系） */
.roam-app .rm-block--focused .rm-bullet .rm-bullet__inner,
.roam-app .roam-block-container:focus-within .rm-bullet .rm-bullet__inner {
  background-color: oklch(from var(--bullet-focus-fill) l c h / 0.5) !important;
  border: 2px solid var(--light-text-color) !important;
  box-shadow: 0 0 6px oklch(from var(--bullet-focus-fill) l c h / 0.55),
              inset 0 0 6px oklch(from var(--bullet-focus-fill) l c h / 0.5) !important;
  margin: 1px !important;
  width: 8px !important;
  height: 8px !important;
  transform: none !important;
  transition: all 0.2s ease;
}

.roam-app .rm-bullet__tooltip {
  background-color: var(--popover-bg) !important;
  border: none !important;
  border-radius: var(--border-radius-md) !important;
  box-shadow: var(--popover-shadow) !important;
  color: var(--text-color) !important;
  font-size: 0.8125rem !important;
  line-height: var(--lh-title) !important;
  padding: var(--layout-padding-sm) 12px !important;
  opacity: 1 !important;
  z-index: 9999 !important;
}

.roam-app .rm-bullet-tooltip__time {
  display: block !important;
  margin-top: 4px !important;
  color: var(--light-text-color, var(--m-text-muted, #758A99)) !important;
  font-size: 0.9rem !important;
  font-weight: 500 !important;
}

.roam-app .rm-block-ref::before {
  content: "";
  display: inline-block;
  width: 2px;
  height: 10px;
  background: var(--color-primary-light);
  border-radius: 2px;
  margin-right: 6px;
  vertical-align: middle;
  transform: translateY(-1px);
}

.roam-app .rm-block-ref {
  border-bottom: none;
  color: var(--text-color);
  font-size: var(--fs-body);
  opacity: 0.9;
}

.roam-app .rm-block-ref:hover {
  background: none;
  cursor: pointer;
}

.roam-app .block-ref-count-button {
  color: var(--color-primary);
  font-weight: 800;
  top: -10px;
}

/* 引用块：展示态与编辑态 .rm-block__input 字号/样式一致，focus 不缩小；竖线与文字同高 */
.roam-app :is(.roam-article .rm-bq .rm-block-text, .roam-article .rm-bq .rm-block__input, .roam-article .rm-bq, .rm-bq, blockquote) {
  background: transparent;
  border: none;
  border-radius: 0;
  box-shadow: none;
  color: var(--blockquote-text-color) !important;
  font-family: var(--quote-font) !important;
  font-size: var(--fs-quote) !important;
  font-style: italic !important;
  line-height: var(--lh-quote) !important;
  margin: 0 !important;
  padding-left: var(--layout-padding-md);
  position: relative;
  display: block !important;
  width: 100%;
  max-width: 100%;
  text-align: left;
  word-wrap: break-word;
  transition: border-color 0.25s ease;
}

/* 竖线用伪元素绘制，上下收口与文字等高（不占满整行行高） */
.roam-app :is(.rm-bq, .roam-article .rm-bq, blockquote)::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0.25em;
  bottom: 0.25em;
  width: 3px;
  background: var(--blockquote-bar-color);
  border-radius: 0;
  transition: background 0.25s ease;
}
.roam-app :is(.rm-bq, .roam-article .rm-bq, blockquote):hover::before {
  background: var(--blockquote-bar-hover-color);
}

/* 引用块间距：直接控制 .rm-bq，避免 :has() 在大页面下的性能损耗 */
.roam-app .roam-article .rm-bq {
  margin-top: 0.5rem;
  margin-bottom: 0.5rem; /* 引用块多带边框，略拉开防压抑 */
}

.roam-app :is(.rm-bq, blockquote) :is(em, i) {
  font-family: 'Centaur', serif !important;
  font-style: italic;
  font-weight: 400;
}

.roam-app div > .bp3-icon-caret-down + strong,
.roam-app div > .bp3-icon-caret-right + strong {
  color: var(--tree-node-color) !important;
}

.roam-app .controls .rm-caret,
.roam-app .rm-caret,
.roam-app .rm-caret-hidden {
  position: relative;
  z-index: 1000 !important;
  pointer-events: auto !important;
}

.roam-app .rm-resize-handle {
  left: -4px !important;
  width: 4px !important;
  opacity: 0;
  z-index: 10;
}

.roam-app .rm-resize-handle:hover {
  left: -8px !important;
  width: 8px !important;
  opacity: 0.5;
  background-color: var(--color-primary-light);
}

/* ========================================================= */
/* 9. Checkboxes (Smiley Toggle Design)                      */
/* ========================================================= */

.roam-app .check-container {
  position: relative;
  display: inline-block;
  width: 36px;
  height: 18px;
  margin: -5.5px 2px 0 4px;
  vertical-align: middle;
  cursor: pointer;
}

.roam-app .check-container input {
  position: absolute;
  width: 0;
  height: 0;
  opacity: 0;
}

.roam-app .checkmark {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 18px;
  background: var(--toggle-off-bg);
  border: none !important;
  border-radius: 10px;
  box-shadow: var(--toggle-off-shadow);
  transition: 0.5s;
}

.roam-app .check-container input:checked ~ .checkmark {
  background: var(--toggle-on-bg);
  box-shadow: var(--toggle-on-shadow);
  transform: rotate(180deg);
}

.roam-app .smiley-face {
  position: absolute;
  top: 2px;
  left: 2px;
  display: block;
  width: 14px;
  height: 14px;
  background: var(--toggle-face-bg);
  border-radius: 50%;
  transition: 0.5s;
  transition-delay: 0.2s;
}

.roam-app .check-container input:checked ~ .checkmark .smiley-face {
  left: 2px;
  transform: rotate(180deg);
}

.roam-app .checkmark > :not(.smiley-face) {
  display: none !important;
}

/* 隐藏 system.css 用 ::after 画的默认对勾，只保留笑脸 */
.roam-app .check-container .checkmark::after {
  content: none !important;
  display: none !important;
  border: none !important;
}

.roam-app .smiley-face::before {
  content: '';
  position: absolute;
  top: 4px;
  left: 3px;
  width: 2.5px;
  height: 2.5px;
  background: var(--toggle-eye-off);
  border-radius: 50%;
  box-shadow: 6px 0 var(--toggle-eye-off);
  transition: 0.5s;
}

.roam-app .check-container input:checked ~ .checkmark .smiley-face::before {
  background: var(--toggle-eye-on);
  box-shadow: 6px 0 var(--toggle-eye-on);
}

/* 嘴：未勾选 = 哭脸（下弯弧），勾选 = 笑脸（上弯弧） */
.roam-app .smiley-face::after {
  content: '';
  position: absolute;
  bottom: 2.5px;
  left: 50%;
  width: 6px;
  height: 3px;
  background: var(--toggle-eye-off);
  transform: translateX(-50%);
  /* 哭脸：上缘圆角，弧线向下 */
  border-radius: 3px 3px 0 0;
  transition: 0.5s;
}

.roam-app .check-container input:checked ~ .checkmark .smiley-face::after {
  background: var(--toggle-eye-on);
  /* 笑脸：下缘圆角，弧线向上 */
  border-radius: 0 0 3px 3px;
}

.roam-app .check-container input:focus ~ .checkmark {
  box-shadow: 0 0 0 2px var(--bg-color), 0 0 0 4px var(--toggle-eye-on);
}

/* ========================================================= */
/* 10. Kanban                                                */
/* ========================================================= */

.roam-app .kanban-board {
  background: transparent;
  border-radius: var(--border-radius-lg);
  padding: 12px;
}

.roam-app .kanban-card {
  background: var(--kanban-card-bg);
  border: none;
  border-radius: var(--border-radius-md);
  box-shadow: none;
  margin: 10px 6px;
  padding: 14px 16px;
  transition: var(--transition-normal);
}

.roam-app .kanban-card:hover {
  background: var(--kanban-card-hover-bg);
  box-shadow: none;
  transform: translateY(-2px);
}

.roam-app .kanban-title {
  color: var(--heading-h2-color);
  font-size: 0.95rem;
  font-weight: 700;
  letter-spacing: 0.02em;
  padding: 10px 8px;
  text-align: center;
}

.roam-app .kanban-column {
  background: var(--kanban-column-bg);
  border: none;
  border-radius: 10px;
  margin: 0 6px;
  padding: 8px;
  min-width: 200px;
}

/* ========================================================= */
/* 11. Tags & Labels                                         */
/* ========================================================= */

.roam-app .rm-page-ref-brackets {
  display: none;
}

.roam-app span.rm-page-ref {
  border-radius: 2px;
  padding: 0 1px;
}

.roam-app .rm-page-ref--link {
  color: var(--color-primary);
  font-weight: 600;
  letter-spacing: 0;
  text-shadow: none;
  transition: color 0.2s ease, background 0.2s ease, text-decoration 0.2s ease, filter 0.2s ease, letter-spacing 0.2s ease, text-shadow 0.2s ease;
}

body:not(.rm-dark-theme) .roam-app .rm-page-ref--link,
body:not(.rm-dark-theme) .roam-app a.rm-alias--page,
body:not(.rm-dark-theme) .roam-app a.rm-alias--block {
  color: var(--m-page-ref) !important;
  text-decoration: none !important;
  border-bottom: none !important;
  letter-spacing: 0;
  text-shadow: none;
}

body:not(.rm-dark-theme) .roam-app .rm-page-ref--link:hover,
body:not(.rm-dark-theme) .roam-app a.rm-alias--page:hover,
body:not(.rm-dark-theme) .roam-app a.rm-alias--block:hover {
  color: var(--m-page-ref-hover) !important;
  text-decoration: none !important;
  border-bottom: none !important;
  font-weight: 800 !important;
  letter-spacing: 0.03em;
  text-shadow: 0 0 0.5px currentColor, 0 1px 2px rgba(0,0,0,0.08);
}

/* 标签：pill 风格；前缀 "#" 由 JS/Tag-HideHash.js 去掉 */
body .rm-page-ref--tag,
body .roam-app span.rm-page-ref.rm-page-ref--tag,
body .roam-app span.rm-page-ref[data-tag] {
  position: relative;
  display: inline-block;
  box-sizing: border-box;
  padding: 0.22em 0.6em 0.22em 0.5em;
  border-radius: 9999px;
  border: none !important;
  background-color: var(--tag-bg) !important;
  color: var(--m-tag) !important;
  font-family: var(--tag-font), var(--body-font) !important;
  font-size: var(--fs-tag) !important;
  letter-spacing: 0;
  text-shadow: none;
  text-decoration: none !important;
  transition: color 0.2s ease, background-color 0.2s ease, letter-spacing 0.2s ease, text-shadow 0.2s ease;
}

/* 标签悬浮：pill 背景加深 + 文字凸显 */
body:not(.rm-dark-theme) .roam-app .rm-page-ref--tag:hover,
body:not(.rm-dark-theme) .roam-app span.rm-page-ref.rm-page-ref--tag:hover,
body:not(.rm-dark-theme) .roam-app span.rm-page-ref[data-tag]:hover {
  background-color: var(--tag-bg-hover) !important;
  color: var(--m-tag-hover) !important;
  font-weight: 800 !important;
  letter-spacing: 0.03em;
  text-shadow: 0 0 0.5px currentColor, 0 1px 2px rgba(0,0,0,0.08);
}

body.rm-dark-theme .roam-app .rm-page-ref--tag:hover,
body.rm-dark-theme .roam-app span.rm-page-ref.rm-page-ref--tag:hover,
body.rm-dark-theme .roam-app span.rm-page-ref[data-tag]:hover {
  background-color: var(--tag-bg-hover) !important;
  color: var(--m-tag-hover) !important;
  font-weight: 800 !important;
  letter-spacing: 0.03em;
  text-shadow: 0 0 6px oklch(from var(--m-tag) l c h / 0.5), 0 0 12px oklch(from var(--m-tag) l c h / 0.25);
}

/* ========================================================= */
/* 12. Highlights (.rm-highlight 相关，参考 system.css)      */
/* ========================================================= */

/* 文字高亮 */
.roam-app .rm-highlight {
  background: linear-gradient(180deg, var(--highlight-underline-fade) 60%, var(--highlight-underline) 60%);
  color: var(--highlight-text);
  text-decoration: none;
  border-radius: 2px;
}

/* 块级高亮（system: .block-highlight-blue / grey / yellow 各一条） */
.roam-app .block-highlight-blue {
  background: var(--block-highlight-bg);
  border: none;
  box-shadow: none;
  border-radius: 0.5rem;
}


/* ========================================================= */
/* 13. Settings & Plugins                                    */
/* ========================================================= */

.rm-topbar {
  position: relative !important;
  display: flex !important;
  align-items: center !important;
}

.rm-find-or-create-wrapper {
  position: absolute !important;
  left: 50% !important;
  z-index: 1000;
  display: flex !important;
  align-items: center !important;
  margin-right: 0 !important;
  flex: 0 0 auto !important;
  transform: translateX(-50%) !important;
}

#find-or-create-input {
  background-color: var(--find-input-bg) !important;
  border: 1px solid transparent !important;
  border-radius: 20px !important;
  box-shadow: none !important;
  color: var(--text-color) !important;
  width: 30vw !important;
  max-width: 400px !important;
  min-width: 150px !important;
  height: 34px !important;
  padding-left: 36px !important;
  transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.2s ease, box-shadow 0.2s ease !important;
}

.rm-find-or-create-wrapper .bp3-icon-search {
  left: 12px !important;
  color: var(--light-text-color) !important;
}

#find-or-create-input:focus {
  background-color: var(--find-input-focus-bg) !important;
  border-color: var(--color-primary) !important;
  box-shadow: var(--find-input-focus-shadow) !important;
  width: 50vw !important;
  max-width: 600px !important;
}

/* Mobile responsive: find-or-create + sync */
@media (max-width: 768px) {
  #find-or-create-input {
    width: 180px !important;
  }
  #find-or-create-input:focus {
    width: 300px !important;
    max-width: 70vw !important;
  }
  .rm-find-or-create-wrapper {
    left: 50% !important;
    transform: translateX(-50%) !important;
  }
  .rm-sync {
    margin-left: 90px;
  }
  .rm-topbar:has(#find-or-create-input:focus) .rm-sync {
    margin-left: 35vw;
  }
}

/* Hide help button */
.rm-topbar .rm-topbar__help,
.bp3-icon-help {
  display: none !important;
}

/* Tooltip */
.bp3-tooltip .bp3-popover-content div {
  color: var(--tooltip-text);
}

/* Extension settings */
.rm-extensions-settings .rm-extensions-installed .rm-extension-installed__name {
  font-size: 0.875rem; /* 14px @16px */
  font-weight: 600;
}

/* Hotkeys */
.rm-hotkeys-action,
.rm-settings-panel__section .rm-depot-readme-wrapper h1,
.rm-settings-panel__section .rm-depot-readme-wrapper h2,
.rm-settings-panel__section .rm-depot-readme-wrapper h3,
.rm-settings-panel__section .rm-depot-readme-wrapper p,
.rm-settings-panel__section .rm-depot-readme-wrapper li,
.rm-settings-panel__section .rm-depot-readme-wrapper a,
.rm-settings-panel__section .rm-depot-readme-wrapper strong {
  color: var(--color-primary);
}

/* Disabled button */
.bp3-button.bp3-disabled,
.bp3-button.bp3-disabled .bp3-button-text {
  color: var(--btn-disabled-text) !important;
}

:is(.bp3-popover .bp3-popover-content, .bp3-popover2 .bp3-popover2-content),
.bp3-dialog,
.bp3-context-menu,
.bp3-toast,
.bp3-card,
.rm-command-palette {
  background: var(--ui-surface-bg) !important;
  border: none !important;
  border-radius: var(--ui-surface-radius) !important;
  box-shadow: var(--ui-surface-shadow) !important;
  color: var(--ui-surface-text) !important;
}

:is(.bp3-popover .bp3-popover-content, .bp3-popover2 .bp3-popover2-content),
.bp3-menu,
.bp3-context-menu {
  padding: 8px !important;
}

.bp3-menu {
  font-family: var(--body-font);
  background: transparent !important;
  color: var(--text-color) !important;
  padding: 0 !important;
  width: fit-content;
  min-width: 0;
}

.bp3-menu-item {
  border-radius: 999px !important;
  color: var(--text-color) !important;
  font-weight: 500;
  margin: 4px 0 !important;
  padding: 10px 16px !important;
  display: flex;
  align-items: center;
  align-self: flex-start;
  width: fit-content;
  max-width: 100%;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.bp3-menu-item .bp3-fill {
  flex: 0 0 auto;
}

/* 菜单项：仅保留主文案与子菜单箭头，隐藏快捷键/说明 */
.bp3-menu-item .bp3-menu-item-label {
  display: none !important;
}

.bp3-menu-item:hover,
.bp3-menu-item.bp3-active {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;
  transform: translateX(2px);
}

.bp3-menu-item .bp3-icon {
  color: var(--light-text-color);
  margin-right: 10px;
  transition: color 0.2s ease;
}

.bp3-menu-item:hover .bp3-icon,
.bp3-menu-item.bp3-active .bp3-icon {
  color: var(--menu-hover-text) !important;
}

/* 仅 Install Roam 菜单项（页面 ⋮ 菜单里的蓝色按钮）整行居中对齐 */
.bp3-menu li:has(a.rm-install-menu-item) {
  display: flex !important;
  justify-content: center !important;
}
a.bp3-menu-item.rm-install-menu-item {
  justify-content: center !important;
}
a.bp3-menu-item.rm-install-menu-item .bp3-fill.rm-install-menu-item__text {
  text-align: center !important;
}

/* 页面标题 ⋮ 菜单：隐藏链接下划线高亮 */
.bp3-popover-content .bp3-menu:has(.rm-install-menu-item) .bp3-menu-item,
.bp3-popover-content .bp3-menu:has(.rm-install-menu-item) .bp3-menu-item:hover {
  text-decoration: none !important;
}

.bp3-popover-arrow-fill {
  fill: var(--popover-bg) !important;
}

.bp3-popover-arrow-border {
  fill: transparent !important;
}

/* 块右键菜单：内联样式按钮（对齐 / H1–H3）覆盖为主题色 */
.bp3-popover-content .bp3-menu .flex-h-box button {
  background-color: var(--embed-bg) !important;
  border: 1px solid var(--color-subtle-border) !important;
  border-radius: var(--border-radius-sm);
  color: var(--text-color) !important;
  margin: 0 2px;
  padding: 4px 8px;
}

.bp3-popover-content .bp3-menu .flex-h-box button:hover {
  background-color: var(--menu-hover-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--menu-hover-text) !important;
}

.bp3-popover-content .bp3-menu .flex-h-box button .bp3-icon-standard,
.bp3-popover-content .bp3-menu .flex-h-box button .bp3-icon {
  color: var(--light-text-color) !important;
}

.bp3-popover-content .bp3-menu .flex-h-box button:hover .bp3-icon-standard,
.bp3-popover-content .bp3-menu .flex-h-box button:hover .bp3-icon {
  color: var(--menu-hover-text) !important;
}

.bp3-popover-content .bp3-menu .flex-h-box button[style*="rgba(72, 176, 240"] {
  background-color: var(--color-primary-light) !important;
  border-color: oklch(from var(--m-primary) l c h / 0.35) !important;
}

.bp3-popover-content .bp3-menu .flex-h-box button[style*="rgba(72, 176, 240"] .bp3-icon-standard,
.bp3-popover-content .bp3-menu .flex-h-box button[style*="rgba(72, 176, 240"] .bp3-icon {
  color: var(--color-primary) !important;
}

.bp3-popover-content .bp3-menu .bp3-menu-divider {
  border-color: var(--color-subtle-border);
  margin: 4px 0;
}

.bp3-overlay:has(.rm-modal-dialog--confirmation-with-content) .bp3-overlay-backdrop {
  background-color: var(--bg-color) !important;
  opacity: 1 !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content,
.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-dialog.rm-close-pinned-sidebar-window {
  background-color: transparent !important;
  border: none !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  color: var(--text-color) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-header {
  color: var(--text-color) !important;
  font-family: inherit !important;
  font-size: 1.05rem !important;
  font-weight: 600 !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content,
.bp3-dialog.rm-modal-dialog--confirmation-with-content .rm-close-pinned-sidebar-window__content {
  color: var(--text-color) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .rm-bq.rm-sidebar-window-display-str {
  background: transparent !important;
  border: none !important;
  border-left: 3px solid var(--color-primary) !important;
  box-shadow: none !important;
  color: var(--text-color) !important;
  font-family: inherit !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .rm-close-pinned-sidebar-window__content__end-hint {
  color: var(--text-color) !important;
  font-size: 0.9rem;
  opacity: 0.85;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-buttons .bp3-button {
  color: var(--text-color) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-buttons .bp3-button.bp3-minimal:hover {
  background-color: var(--confirmation-btn-hover-bg) !important;
  color: var(--text-color) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-buttons .confirm-button.bp3-intent-primary {
  background-color: var(--color-primary) !important;
  border-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-buttons .confirm-button.bp3-intent-primary:hover {
  background-color: var(--color-primary-light) !important;
  border-color: var(--color-primary-light) !important;
  color: var(--on-accent) !important;
}

.bp3-dialog.rm-modal-dialog--confirmation-with-content .confirmation-content-buttons .bp3-button .bp3-icon {
  color: inherit !important;
}

/* Live AI Chat 面板 (full-results-modal)：日夜间配色与字体 */
.bp3-dialog.full-results-modal,
.bp3-dialog.full-results-modal .full-results-header,
.bp3-dialog.full-results-modal .full-results-content-container,
.bp3-dialog.full-results-modal .full-results-chat-container,
.bp3-dialog.full-results-modal .full-results-chat-panel,
.bp3-dialog.full-results-modal .full-results-chat-messages,
.bp3-dialog.full-results-modal .full-results-chat-input-area {
  background: var(--page-color) !important;
  color: var(--text-color);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-title.bp3-heading {
  color: var(--title-display-color);
  font-family: var(--heading-font);
}

.bp3-dialog.full-results-modal .full-results-control-button,
.bp3-dialog.full-results-modal .full-results-close-button {
  color: var(--light-text-color);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-control-button:hover,
.bp3-dialog.full-results-modal .full-results-close-button:hover {
  color: var(--text-color);
  background-color: var(--menu-hover-bg);
}

.bp3-dialog.full-results-modal .full-results-control-button .bp3-icon,
.bp3-dialog.full-results-modal .full-results-close-button .bp3-icon {
  color: inherit;
}

.bp3-dialog.full-results-modal .edge-hover-button {
  color: var(--light-text-color);
  background: transparent;
}

.bp3-dialog.full-results-modal .edge-hover-button:hover {
  color: var(--color-primary);
  background-color: var(--hover-primary-soft);
}

.bp3-dialog.full-results-modal .full-results-chat-header,
.bp3-dialog.full-results-modal .full-results-chat-info-text,
.bp3-dialog.full-results-modal .full-results-chat-info-text span {
  color: var(--light-text-color);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-chat-welcome,
.bp3-dialog.full-results-modal .full-results-chat-assistant-message {
  color: var(--text-color);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-chat-assistant-message.chat-help p,
.bp3-dialog.full-results-modal .full-results-chat-assistant-message.chat-help strong {
  color: var(--text-color);
}

.bp3-dialog.full-results-modal .full-results-chat-assistant-message.chat-help div[style*="font-size: 12px"] {
  color: var(--light-text-color);
}

.bp3-dialog.full-results-modal .full-results-chat-suggestions button {
  color: var(--text-color);
  background-color: var(--embed-bg);
  border-color: var(--color-subtle-border);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-chat-suggestions button:hover {
  color: var(--menu-hover-text);
  background-color: var(--menu-hover-bg);
  border-color: var(--color-subtle-border);
}

.bp3-dialog.full-results-modal .full-results-chat-suggestions button .bp3-icon {
  color: var(--light-text-color);
}

.bp3-dialog.full-results-modal .full-results-chat-suggestions button:hover .bp3-icon {
  color: inherit;
}

.bp3-dialog.full-results-modal .full-results-chat-input.bp3-input {
  background: var(--find-input-bg);
  color: var(--text-color);
  border-color: var(--color-subtle-border);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-chat-input.bp3-input::placeholder {
  color: var(--light-text-color);
}

.bp3-dialog.full-results-modal .full-results-chat-input.bp3-input:focus {
  background: var(--find-input-focus-bg);
  border-color: var(--color-primary);
  box-shadow: var(--find-input-focus-shadow);
}

.bp3-dialog.full-results-modal .full-results-chat-controls .bp3-button,
.bp3-dialog.full-results-modal .full-results-chat-access-mode .bp3-button,
.bp3-dialog.full-results-modal .full-results-chat-tools-menu .bp3-button,
.bp3-dialog.full-results-modal .full-results-chat-style-selector .bp3-button,
.bp3-dialog.full-results-modal .full-results-chat-command-suggest .bp3-button,
.bp3-dialog.full-results-modal .full-results-chat-model-selector .bp3-button {
  color: var(--light-text-color);
  font-family: var(--body-font);
}

.bp3-dialog.full-results-modal .full-results-chat-controls .bp3-button:hover,
.bp3-dialog.full-results-modal .full-results-chat-access-mode .bp3-button:hover,
.bp3-dialog.full-results-modal .full-results-chat-tools-menu .bp3-button:hover,
.bp3-dialog.full-results-modal .full-results-chat-style-selector .bp3-button:hover,
.bp3-dialog.full-results-modal .full-results-chat-command-suggest .bp3-button:hover,
.bp3-dialog.full-results-modal .full-results-chat-model-selector .bp3-button:hover {
  color: var(--text-color);
  background-color: var(--menu-hover-bg);
}

.bp3-dialog.full-results-modal .full-results-chat-send:not(.bp3-disabled) {
  color: var(--on-accent);
  background-color: var(--color-primary);
}

.bp3-dialog.full-results-modal .full-results-chat-send:not(.bp3-disabled):hover {
  background-color: var(--color-primary-light);
  color: var(--on-accent);
}

.bp3-dialog.full-results-modal .full-results-chat-send.bp3-disabled,
.bp3-dialog.full-results-modal .full-results-chat-send.bp3-disabled .bp3-icon {
  color: var(--btn-disabled-text);
}

.bp3-dialog.full-results-modal .bp3-intent-primary .bp3-icon,
.bp3-dialog.full-results-modal .bp3-intent-success .bp3-icon,
.bp3-dialog.full-results-modal .full-results-chat-help-avatar .bp3-icon {
  color: inherit;
}

/* Live AI 命令菜单 (str-aicommands-menu)：不透明背景与可读文字 */
.bp3-menu.str-aicommands-menu,
.bp3-popover-content:has(.bp3-menu.str-aicommands-menu) {
  background: var(--page-color) !important;
  color: var(--text-color);
  font-family: var(--body-font);
}

.bp3-menu.str-aicommands-menu .aicommands-topbar,
.bp3-menu.str-aicommands-menu .aicommands-topbar > div:first-child {
  color: var(--title-display-color);
  font-family: var(--heading-font);
}

.bp3-menu.str-aicommands-menu .laia-topbar-icons .bp3-icon,
.bp3-menu.str-aicommands-menu .aicommands-topbar .bp3-icon {
  color: var(--light-text-color);
}

.bp3-menu.str-aicommands-menu .laia-topbar-icons .bp3-icon:hover,
.bp3-menu.str-aicommands-menu .aicommands-topbar .bp3-icon:hover {
  color: var(--color-primary);
}

.bp3-menu.str-aicommands-menu .menu-hint,
.bp3-menu.str-aicommands-menu .bp3-menu-header.menu-hint,
.bp3-menu.str-aicommands-menu .bp3-menu-header.menu-hint .bp3-heading,
.bp3-menu.str-aicommands-menu .bp3-menu-header.menu-hint h6 {
  color: var(--light-text-color);
  font-family: var(--body-font);
}

.bp3-menu.str-aicommands-menu .bp3-menu-header.menu-hint b {
  color: var(--text-color);
}

.bp3-menu.str-aicommands-menu .aicommands-context,
.bp3-menu.str-aicommands-menu .aicommands-context strong,
.bp3-menu.str-aicommands-menu .aicommands-context label,
.bp3-menu.str-aicommands-menu .aicommands-style,
.bp3-menu.str-aicommands-menu .aicommands-style .bp3-html-select {
  color: var(--text-color);
  font-family: var(--body-font);
}

.bp3-menu.str-aicommands-menu .bp3-control.bp3-checkbox {
  color: var(--text-color);
}

.bp3-menu.str-aicommands-menu .bp3-control-indicator {
  border-color: var(--color-subtle-border);
  background-color: var(--embed-bg);
}

.bp3-menu.str-aicommands-menu .bp3-control input:checked ~ .bp3-control-indicator {
  background-color: var(--color-primary);
  border-color: var(--color-primary);
}

.bp3-menu.str-aicommands-menu .str-aicommands-input .bp3-input,
.bp3-menu.str-aicommands-menu .bp3-input-group.str-aicommands-input .bp3-input {
  background: var(--find-input-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border);
  font-family: var(--body-font);
}

.bp3-menu.str-aicommands-menu .str-aicommands-input .bp3-input::placeholder,
.bp3-menu.str-aicommands-menu .bp3-input-group.str-aicommands-input .bp3-input::placeholder {
  color: var(--light-text-color);
}

.bp3-menu.str-aicommands-menu .str-aicommands-input .bp3-icon,
.bp3-menu.str-aicommands-menu .bp3-input-group.str-aicommands-input .bp3-input-left-container .bp3-icon {
  color: var(--light-text-color);
}

.bp3-menu.str-aicommands-menu .bp3-html-select select,
.bp3-menu.str-aicommands-menu .bp3-html-select .bp3-icon {
  color: var(--text-color);
  background-color: var(--embed-bg);
  border-color: var(--color-subtle-border);
}

.bp3-menu.str-aicommands-menu .bp3-input-action .bp3-html-select select {
  color: var(--light-text-color);
}

.bp3-menu.str-aicommands-menu .bp3-input-action .bp3-html-select .bp3-icon {
  color: var(--light-text-color);
}

.rm-settings .rm-settings-panel .rm-settings-panel__description {
  color: var(--light-text-color);
  font-family: var(--body-font) !important;
}

.rm-settings,
.rm-settings-panel__section,
.rm-settings-panel__section h4,
.rm-settings-panel__contents {
  font-family: var(--body-font) !important;
}

.rm-settings .rm-settings-panel__section h1,
.rm-settings .rm-settings-panel__section h2,
.rm-settings .rm-settings-panel h3,
.rm-settings .rm-settings-panel__section h4,
.rm-settings .rm-settings-panel__section h5,
.rm-settings .rm-settings-panel__section h6 {
  color: var(--heading-h2-color) !important;
}

.rm-settings input[type="text"] {
  background-color: var(--embed-bg);
}

.rm-extensions-installed__header,
.rm-extension-installed__name {
  color: var(--text-color);
}

.rm-extensions-marketplace .rm-extensions-marketplace-search,
.rm-extensions-marketplace .rm-extensions-marketplace-details {
  background-color: var(--bg-color);
}

.rm-extensions-marketplace .rm-extensions-marketplace-search__settings input {
  background-color: var(--page-color);
}

/* 日间模式：扩展市场弹窗内全部改为深色字，避免白字白底 */
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace {
  background-color: var(--page-color) !important;
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .bp3-dialog-header,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .bp3-dialog-header .bp3-heading,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .bp3-dialog-close-button,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .bp3-dialog-close-button .bp3-icon {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .bp3-dialog-close-button:hover {
  color: var(--text-color) !important;
  background-color: var(--sidebar-hover-bg) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-search,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-details {
  background-color: var(--page-color) !important;
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-search__settings input {
  background-color: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-search__settings input::placeholder {
  color: var(--light-text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-search__settings > div {
  color: var(--light-text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-search__settings .bp3-button.bp3-minimal,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extensions-marketplace-search__settings .bp3-button .bp3-icon {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-small__name {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-small__author,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-small__downloads,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-small__desc {
  color: var(--light-text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-small:hover .rm-extension-small__name {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-small .bp3-tag.bp3-intent-primary {
  background-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__name {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__stats dt {
  color: var(--light-text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__stats dd {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__stats a {
  color: var(--reference-title-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__desc,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__downloads {
  color: var(--light-text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__readme,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-depot-readme-wrapper,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__readme p,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__readme li,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__readme h1,
html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__readme h2 {
  color: var(--text-color) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__controls .bp3-button.bp3-intent-primary {
  background-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog .rm-extension-full__controls .bp3-button.bp3-intent-primary:hover {
  background-color: var(--color-primary-light) !important;
  color: var(--on-accent) !important;
}

html:not(.rm-dark-theme) .bp3-dialog.rm-extensions-marketplace-dialog hr {
  border-color: var(--color-subtle-border) !important;
}

.rm-settings .rm-settings-panel .rm-select-wrapper {
  background-color: var(--embed-bg);
  color: var(--text-color);
}

.rm-settings .rm-settings-panel .rm-select-wrapper .bp3-button,
.rm-settings .rm-settings-panel .rm-select-wrapper .bp3-popover-target .bp3-button {
  background-color: var(--embed-bg) !important;
  border: 1px solid var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

.rm-settings .rm-settings-panel .rm-select-wrapper .bp3-button:hover {
  background-color: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
}

.bp3-tabs.rm-settings-tabs,
.bp3-tabs.rm-settings-tabs .bp3-tab-list,
.bp3-tabs.rm-settings-tabs .bp3-tab-panel,
.rm-settings-panel,
.rm-settings-panel__contents {
  background: var(--page-color) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

.bp3-tabs.rm-settings-tabs .bp3-tab-list {
  border-right: 1px solid var(--color-subtle-border) !important;
}

.rm-settings-heading,
.rm-extension-settings-heading {
  color: var(--heading-h1-color) !important;
  font-family: var(--heading-font) !important;
  font-weight: 700 !important;
}

.bp3-tab.rm-settings__tab {
  background: transparent !important;
  color: var(--text-color) !important;
  font-family: var(--body-font) !important;
}

.bp3-dialog.rm-modal-dialog--settings .bp3-tab.rm-settings__tab,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .bp3-tab.rm-settings__tab {
  font-family: var(--body-font) !important;
}

.bp3-tab.rm-settings__tab:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
}

.bp3-tab.rm-settings__tab[aria-selected="true"],
body:not(.rm-dark-theme) .rm-settings--desktop .rm-settings__tab:not(.rm-settings__panel-wrapper)[aria-selected="true"] {
  background: var(--color-primary-light) !important;
  color: var(--text-color) !important;
}

.bp3-tab-panel.rm-settings__panel-wrapper,
.rm-settings-panel,
.rm-settings-panel__contents,
.rm-settings-panel__contents .rm-extensions-settings {
  background: var(--page-color) !important;
  color: var(--text-color) !important;
}

.rm-settings-panel__contents .rm-extensions-settings .rm-settings-panel__section h4,
.rm-settings-panel__contents .rm-extensions-settings .rm-settings-panel__description {
  color: var(--heading-h2-color) !important;
}

.rm-settings-panel__contents .rm-extensions-settings .rm-settings-panel__description,
.rm-settings-panel__contents .rm-extensions-installed__header,
.rm-settings-panel__contents .rm-extension-installed__name {
  color: var(--text-color) !important;
}

.rm-settings-panel__contents .rm-extension-installed__desc {
  color: var(--light-text-color) !important;
}

.rm-settings-panel__contents .rm-extensions-settings .bp3-button.bp3-intent-primary {
  background: var(--color-primary) !important;
  border-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

.rm-settings-panel__contents .rm-extensions-settings .bp3-button.bp3-intent-primary:hover {
  background: var(--color-primary-light) !important;
  border-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

.rm-settings-panel__contents .rm-extensions-settings .bp3-button.bp3-minimal,
.rm-settings-panel__contents .rm-extension-installed .bp3-button.bp3-minimal {
  color: var(--text-color) !important;
}

.rm-settings-panel__contents .rm-extensions-settings .bp3-button.bp3-minimal:hover,
.rm-settings-panel__contents .rm-extension-installed .bp3-button.bp3-minimal:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
}

/* 右侧内容区任意 section 文字兜底（含 User/Sharing/Account 等非 panel-config 页） */
.rm-settings-panel__contents .rm-settings-panel__section h4,
.rm-settings-panel__contents .rm-settings-panel__section .rm-settings-panel__description {
  color: var(--text-color) !important;
}

.rm-settings-panel__contents .rm-settings-panel__section h4 {
  color: var(--heading-h2-color) !important;
}

.rm-settings-panel__panel-config {
  background: var(--embed-bg) !important;
  border: 1px solid var(--color-subtle-border) !important;
  border-radius: var(--border-radius-md) !important;
}

.rm-settings-panel__panel-config .rm-settings-panel__section h4,
.rm-settings-panel__panel-config .rm-settings-panel__section h3,
.rm-settings-panel__panel-config .rm-settings-panel__section .rm-settings-panel__description,
.rm-settings-panel__panel-config .rm-settings-panel__description {
  color: var(--text-color) !important;
}

.rm-settings-panel__panel-config .rm-settings-panel__section h4 {
  color: var(--heading-h2-color) !important;
}

/* 第三方插件设置页：描述内 span/br 不单独设色，链接用主色 */
.rm-settings-panel__panel-config .rm-settings-panel__description span,
.rm-settings-panel__panel-config .rm-settings-panel__description a {
  color: inherit !important;
}

.rm-settings-panel__panel-config .rm-settings-panel__description a {
  color: var(--color-primary) !important;
}

.rm-settings-panel__panel-config .rm-settings-panel__description strong {
  color: var(--heading-h2-color) !important;
}

/* 插件设置：输入框（含 class=rm-settings-panel__value 的 input） */
.rm-settings-panel__panel-config input.rm-settings-panel__value,
.rm-settings-panel__panel-config .rm-settings-panel__section input[type="text"],
.rm-settings-panel__panel-config .rm-settings-panel__section input[type="password"] {
  background-color: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border: 1px solid var(--color-subtle-border) !important;
}

.rm-settings-panel__panel-config input::placeholder {
  color: var(--light-text-color) !important;
}

/* 插件设置：下拉按钮（Orange / topRight / gemini-3... 等文字可见） */
.rm-settings-panel__panel-config .rm-settings__permissions-button,
.rm-settings-panel__panel-config .bp3-button.bp3-minimal.rm-settings__permissions-button {
  background: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border: 1px solid var(--color-subtle-border) !important;
}

.rm-settings-panel__panel-config .rm-settings__permissions-button:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-primary) !important;
}

/* panel-config 内任意子元素文字兜底（第三方插件未知结构） */
.rm-settings-panel__panel-config .rm-settings__permissions-button .bp3-button-text,
.rm-settings-panel__panel-config .rm-settings__permissions-button .bp3-icon,
.rm-settings-panel__panel-config .rm-settings-panel__section {
  color: var(--text-color) !important;
}

/* Section 标题与描述 */
.rm-settings-panel__section h4,
.rm-settings-panel__section h3,
.rm-settings-panel__section .rm-settings-panel__section h4 {
  color: var(--heading-h2-color) !important;
}

.rm-settings-panel__section h3 {
  color: var(--heading-h1-color) !important;
}

.rm-settings-panel__description,
.rm-settings-panel__section .rm-settings-panel__description {
  color: var(--light-text-color) !important;
}

/* 输入框+动作按钮（如 Graph History 时间戳+Go）：防止溢出，保证按钮可见 */
.rm-settings-panel .bp3-popover-wrapper:has(.bp3-input-group .bp3-input-action) {
  min-width: 0;
  max-width: 100%;
}
.rm-settings-panel .bp3-input-group {
  min-width: 0;
  max-width: 100%;
}
.rm-settings-panel .bp3-input-group .bp3-input {
  min-width: 0;
}
.rm-settings-panel .bp3-input-group .bp3-input-action {
  flex-shrink: 0;
}

/* 输入框、下拉、按钮（面板内统一） */
.rm-settings-panel .bp3-input,
.rm-settings-panel input[type="text"],
.rm-settings-panel input[type="password"] {
  background-color: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border: 1px solid var(--color-subtle-border) !important;
}

.rm-settings-panel .bp3-input::placeholder,
.rm-settings-panel input::placeholder {
  color: var(--light-text-color) !important;
}

.rm-settings-panel .bp3-button.bp3-minimal {
  color: var(--text-color) !important;
}

.rm-settings-panel .bp3-button.bp3-minimal:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
}

.rm-settings-panel .bp3-button.bp3-intent-primary {
  background: var(--color-primary) !important;
  border-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

.rm-settings-panel .bp3-button.bp3-intent-primary:hover {
  background: var(--color-primary-light) !important;
  border-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

.rm-settings-panel .bp3-button.bp3-intent-warning {
  color: var(--text-color) !important;
}

.rm-settings-panel .bp3-button.bp3-intent-danger {
  color: var(--on-accent) !important;
}

/* Switch / Radio 控件：与主题一致 */
.rm-settings-panel .bp3-control-indicator {
  background-color: var(--embed-bg) !important;
  border: 1px solid var(--color-subtle-border) !important;
  box-shadow: none !important;
}

.rm-settings-panel .bp3-control input:checked ~ .bp3-control-indicator {
  background-color: var(--checkbox-checked-color) !important;
  border-color: var(--checkbox-checked-color) !important;
}

.rm-settings-panel .bp3-control:hover .bp3-control-indicator {
  border-color: var(--color-primary) !important;
}

.rm-settings-panel .bp3-radio .bp3-control-indicator::before {
  background-color: var(--text-color) !important;
}

.rm-settings-panel .bp3-radio input:checked ~ .bp3-control-indicator::before {
  background-color: var(--page-color) !important;
}

/* Hotkeys 区域 */
.rm-hotkeys-action,
.rm-hotkeys-group__header {
  color: var(--text-color) !important;
}

.rm-hotkeys-hotkey__part.bp3-tag {
  background: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border: 1px solid var(--color-subtle-border) !important;
}

/* Depot readme 正文：可读性 */
.rm-settings-panel__section .rm-depot-readme-wrapper h1 {
  color: var(--heading-h1-color) !important;
}

.rm-settings-panel__section .rm-depot-readme-wrapper h2 {
  color: var(--heading-h2-color) !important;
}

.rm-settings-panel__section .rm-depot-readme-wrapper h3 {
  color: var(--heading-h3-color) !important;
}

.rm-settings-panel__section .rm-depot-readme-wrapper p,
.rm-settings-panel__section .rm-depot-readme-wrapper li,
.rm-settings-panel__section .rm-depot-readme-wrapper span {
  color: var(--text-color) !important;
}

.rm-settings-panel__section .rm-depot-readme-wrapper a {
  color: var(--color-primary) !important;
}

.rm-settings-panel__section .rm-depot-readme-wrapper strong {
  color: var(--heading-h2-color) !important;
}

/* 包裹 Settings 的 Dialog（若有）：背景与主页面一致，字体与主题一致；overlay 内弹窗需更高优先级 */
.bp3-dialog:has(.rm-settings-tabs),
.bp3-dialog.rm-modal-dialog--settings,
body .bp3-overlay .bp3-dialog:has(.rm-settings-tabs),
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings {
  background: var(--page-color) !important;
  color: var(--text-color) !important;
  box-shadow: var(--shadow-floating) !important;
  border: none !important;
  font-family: var(--body-font) !important;
  font-size: var(--font-size) !important;
}

.bp3-dialog:has(.rm-settings-tabs) .bp3-dialog-body,
.bp3-dialog.rm-modal-dialog--settings .bp3-dialog-body,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .bp3-dialog-body {
  font-family: var(--body-font) !important;
  font-size: inherit;
}

.bp3-dialog:has(.rm-settings-tabs) .rm-settings,
.bp3-dialog:has(.rm-settings-tabs) .rm-settings-panel,
.bp3-dialog:has(.rm-settings-tabs) .rm-settings-panel__contents,
.bp3-dialog:has(.rm-settings-tabs) .bp3-tabs.rm-settings-tabs,
.bp3-dialog:has(.rm-settings-tabs) .bp3-tab-list,
.bp3-dialog:has(.rm-settings-tabs) .bp3-tab-panel,
.bp3-dialog.rm-modal-dialog--settings .rm-settings,
.bp3-dialog.rm-modal-dialog--settings .rm-settings-panel,
.bp3-dialog.rm-modal-dialog--settings .rm-settings-panel__contents,
.bp3-dialog.rm-modal-dialog--settings .bp3-tabs.rm-settings-tabs,
.bp3-dialog.rm-modal-dialog--settings .bp3-tab-list,
.bp3-dialog.rm-modal-dialog--settings .bp3-tab-panel,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .rm-settings,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .rm-settings-panel,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .rm-settings-panel__contents,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .bp3-tabs,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .bp3-tab-list,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .bp3-tab-panel {
  font-family: var(--body-font) !important;
  font-size: inherit;
}

.bp3-dialog.rm-modal-dialog--settings .rm-settings-heading,
.bp3-dialog.rm-modal-dialog--settings .rm-extension-settings-heading,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .rm-settings-heading,
body .bp3-overlay .bp3-dialog.rm-modal-dialog--settings .rm-extension-settings-heading {
  font-family: var(--heading-font) !important;
}

.bp3-dialog:has(.rm-settings-tabs) .bp3-dialog-header {
  background: transparent !important;
  color: var(--text-color) !important;
  border-bottom: 1px solid var(--color-subtle-border) !important;
}

.bp3-dialog:has(.rm-settings-tabs) .bp3-dialog-close-button {
  color: var(--text-color) !important;
}

.bp3-dialog:has(.rm-settings-tabs) .bp3-dialog-close-button:hover {
  color: var(--text-color) !important;
  background: var(--sidebar-hover-bg) !important;
}

.bp3-popover .bp3-popover-content:has(.rm-find-or-create__menu) {
  background-color: var(--page-color) !important;
  border: 1px solid var(--color-subtle-border) !important;
  border-radius: 16px !important;
  box-shadow: var(--ui-surface-shadow) !important;
  padding: 6px !important;
}

.bp3-menu.rm-find-or-create__menu {
  background-color: transparent !important;
  border: none !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  padding: 0 !important;
}

.bp3-menu.rm-find-or-create__menu div[style*="color: rgb(206, 217, 224)"] {
  color: var(--light-text-color) !important;
  font-size: 0.85rem !important;
  font-weight: 600 !important;
  letter-spacing: 0.05em;
  padding: 8px 16px !important;
  text-transform: uppercase;
  opacity: 1 !important;
}

.bp3-menu.rm-find-or-create__menu .rm-menu-item {
  border-radius: 999px !important;
  margin: 2px 0 !important;
  padding: 8px 16px !important;
  transition: background-color 0.15s ease;
}

.rm-search-title.bp3-text-overflow-ellipsis,
.rm-search-list-item-title.bp3-text-overflow-ellipsis {
  color: var(--text-color) !important;
  font-size: 1rem !important;
  font-weight: 500 !important;
  text-shadow: none !important;
}

.rm-search-list-item {
  color: var(--light-text-color) !important;
  font-size: 0.9rem !important;
  margin-top: 0.125rem;
}

.bp3-menu.rm-find-or-create__menu .rm-menu-item:hover,
.bp3-menu.rm-find-or-create__menu .rm-menu-item.bp3-active {
  background-color: var(--color-primary-light) !important;
}

.bp3-menu.rm-find-or-create__menu .rm-menu-item:hover .rm-search-title,
.bp3-menu.rm-find-or-create__menu .rm-menu-item.bp3-active .rm-search-title,
.bp3-menu.rm-find-or-create__menu .rm-menu-item:hover .rm-search-list-item-title,
.bp3-menu.rm-find-or-create__menu .rm-menu-item.bp3-active .rm-search-list-item-title {
  color: var(--color-primary) !important;
}

.rm-find-or-create__menu .rm-new-page {
  color: var(--color-secondary) !important;
  font-weight: 600;
}

.rm-sync {
  position: absolute !important;
  top: 50%;
  left: 50% !important;
  transform: translateX(-30px);
  margin-left: 150px;
  margin-top: -10px;
  z-index: 1001;
  opacity: 0;
  pointer-events: none;
  transition: all 0.2s ease !important;
}

.rm-find-or-create-wrapper:hover ~ .rm-sync,
.rm-sync:hover {
  opacity: 1;
  pointer-events: auto;
  transform: translateX(-36px);
}

.rm-topbar:has(#find-or-create-input:focus) .rm-sync {
  opacity: 0 !important;
  pointer-events: none !important;
  display: none !important;
}

.rm-topbar:has(.rm-sync) #find-or-create-input {
  border: 1.5px solid var(--sync-warn-border) !important;
  box-shadow: var(--sync-warn-shadow) !important;
}

.rm-topbar:has(.rm-sync--synced) #find-or-create-input {
  border: 1.5px solid transparent !important;
  box-shadow: none !important;
  border-color: var(--sync-synced-border-color) !important;
}

.rm-topbar:has(.rm-sync) #find-or-create-input:focus {
  border-color: var(--sync-warn-border) !important;
  box-shadow: var(--sync-warn-focus-shadow) !important;
}

.rm-topbar:has(.rm-sync--synced) #find-or-create-input:focus {
  border-color: var(--color-primary) !important;
  box-shadow: var(--sync-synced-focus-shadow) !important;
}

.rm-sync-tooltip__content {
  min-width: 240px;
  padding: 8px 12px !important;
}

.rm-sync-tooltip__title {
  color: var(--text-color) !important;
  font-family: var(--heading-font) !important;
  font-size: 1.1rem !important;
  font-weight: 600 !important;
  margin-bottom: 8px !important; /* UI 标题标准间距 */
}

.rm-sync-tooltip__text,
.rm-sync-tooltip__content > div > div {
  color: var(--text-color) !important;
  font-family: var(--body-font) !important;
  font-size: 0.95rem !important;
  line-height: 1.5 !important;
  margin-bottom: 4px !important; /* Tooltip 内紧凑 */
}

.rm-sync-tooltip__text div,
.rm-sync-tooltip__content div {
  color: var(--text-color) !important;
}

.rm-sync-tooltip__text strong {
  color: var(--color-primary) !important;
  font-weight: 700 !important;
}

.rm-sync-tooltip__last-sync-time {
  color: var(--light-text-color) !important;
  font-size: 0.85rem !important;
  margin-top: 0.25rem !important;
  font-family: var(--code-font) !important;
}

.rm-sync-tooltip__content .bp3-divider {
  border-bottom-color: var(--color-subtle-border) !important;
  margin: 8px 0 !important;
}

.bp3-datepicker {
  background-color: var(--page-color) !important;
  border-radius: 12px !important;
  padding: 10px !important;
}

.DayPicker-Caption {
  background-color: transparent !important;
  border-bottom: 1px solid var(--color-subtle-border);
  margin-bottom: 0.5rem; /* 8px，符合 4/8 倍数 */
  padding-bottom: 0.5rem;
}

.DayPicker-Caption .bp3-divider {
  display: none !important;
}

.bp3-datepicker-caption select {
  color: var(--text-color) !important;
  font-family: var(--heading-font) !important;
  font-weight: 600 !important;
}

.bp3-datepicker-caption .bp3-icon,
.DayPicker-NavButton {
  color: var(--color-primary) !important;
}

.DayPicker-NavButton:hover {
  background-color: var(--color-primary-light) !important;
  border-radius: 50%;
}

.DayPicker-Weekday {
  color: var(--light-text-color) !important;
  font-size: 0.85rem;
  font-weight: 600;
  text-transform: uppercase;
}

.DayPicker-Day {
  border-radius: 50% !important;
  color: var(--text-color) !important;
  font-family: var(--code-font) !important;
  transition: all 0.2s ease;
}

.DayPicker-Day .bp3-datepicker-day-wrapper {
  color: inherit !important;
  font-weight: inherit !important;
}

.DayPicker-Day:hover {
  background-color: var(--color-primary-light) !important;
  color: var(--color-primary) !important;
}

.DayPicker-Day--today {
  color: var(--highlight-red) !important;
  font-weight: 700;
}

.DayPicker-Day--selected,
.DayPicker-Day--selected:hover {
  background-color: var(--color-primary) !important;
  color: var(--datepicker-day-selected-text) !important;
  font-weight: 700;
}

.DayPicker-Day--outside {
  opacity: 0.3;
}

/* ========================================================= */
/* 14. Autocomplete & Menus（结构同 system.css，仅保留配色与字体） */
/* ========================================================= */

/* 选中行内灰字 → 主题色（对应 system 1395-1396） */
.rm-autocomplete__results .dont-unfocus-block[style*="background-color: rgb(213, 218, 223);"]  div[style*="color: rgb(129, 145, 157)"] {
  color: var(--autocomplete-row-hover-text) !important;
}

.rm-autocomplete__results div[style*="color: rgb(129, 145, 157)"] {
  color: var(--text-color) !important;
}

.rm-autocomplete__results .dont-unfocus-block:hover {
  background-color: var(--autocomplete-row-hover-bg);
  color: var(--autocomplete-row-hover-text) !important;
}

.rm-autocomplete__results .dont-unfocus-block[style*="background-color: rgb(213, 218, 223);"],
.rm-autocomplete__results .dont-unfocus-block[style*="background-color: rgb(213, 218, 223);"]:hover {
  background-color: var(--autocomplete-row-hover-bg) !important;
  border: none;
  color: var(--autocomplete-row-hover-text) !important;
}

.rm-autocomplete__results .dont-unfocus-block {
  border: none;
  border-radius: var(--border-radius-sm);
  color: var(--text-color) !important;
  font-family: var(--body-font) !important;
  font-size: inherit;
}

.rm-autocomplete__results .dont-unfocus-block:hover .bp3-icon {
  color: var(--color-primary) !important;
}

.rm-autocomplete__results .dont-unfocus-block[style*="background-color: rgb(213, 218, 223);"] .bp3-icon,
.rm-autocomplete__results .dont-unfocus-block[style*="background-color: rgb(213, 218, 223);"]:hover .bp3-icon {
  color: var(--autocomplete-row-hover-text) !important;
}

.rm-autocomplete__results .dont-unfocus-block .bp3-icon {
  color: var(--light-text-color) !important;
}

.rm-autocomplete__results .dont-unfocus-block:hover .rm-icon-key-prompt {
  color: var(--autocomplete-row-hover-text) !important;
}

.rm-autocomplete__results .dont-unfocus-block[style*="background-color: rgb(213, 218, 223);"] .rm-icon-key-prompt {
  color: var(--autocomplete-row-hover-text) !important;
}

.rm-autocomplete__results .dont-unfocus-block .rm-icon-key-prompt {
  color: var(--light-text-color) !important;
  font-size: inherit !important;
  opacity: 0.85 !important;
}

.rm-autocomplete__results .dont-unfocus-block[style*="background-color: rgb(213, 218, 223);"] .rm-autocomplete-result {
  background-color: transparent;
  color: var(--autocomplete-row-hover-text) !important;
}

.rm-autocomplete__results div[style*="color: lightgray"] {
  color: var(--light-text-color) !important;
}

.rm-autocomplete__results .dont-unfocus-block[style*="background-color: rgb(213, 218, 223);"] :is(div, span, a):not(.bp3-button-text) {
  color: var(--autocomplete-row-hover-text);
}

.rm-autocomplete__results :is(div, span, a) {
  background-color: transparent;
  border-bottom: none !important;
  color: var(--text-color);
  font-family: var(--body-font) !important;
}

.rm-autocomplete__results,
.roam-app .rm-autocomplete__results.bp3-elevation-3 {
  background-color: var(--autocomplete-results-bg) !important;
  border: none;
  border-radius: var(--border-radius-md);
  box-shadow: var(--popover-shadow);
  color: var(--text-color) !important;
  font-family: var(--body-font) !important;
  font-size: inherit;
  min-width: 300px !important;
  max-width: 300px !important;
  width: 300px !important;
  max-height: 50vh !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  padding: var(--layout-padding-sm) !important;
}

/* Alias container：补全列表在左，Aliases 在右；两栏比例约 5:4，右侧够宽避免公式/长名被挤断 */
body .rm-autocomplete__results.alias-container.bp3-elevation-3,
.roam-app .rm-autocomplete__results.alias-container.bp3-elevation-3 {
  display: grid !important;
  grid-template-columns: 1fr minmax(200px, 1fr);
  grid-template-rows: auto;
  min-width: 440px !important;
  max-width: 560px !important;
  width: auto !important;
  background-color: var(--autocomplete-results-bg) !important;
  border-radius: var(--border-radius-md);
  box-shadow: var(--popover-shadow);
  color: var(--text-color) !important;
  font-family: var(--body-font) !important;
}
body .rm-autocomplete__results.alias-container .dont-unfocus-block,
.roam-app .rm-autocomplete__results.alias-container .dont-unfocus-block {
  grid-column: 1;
  grid-row: auto;
}
body .rm-autocomplete__results.alias-container .rm-aliases,
.roam-app .rm-autocomplete__results.alias-container .rm-aliases {
  grid-column: 2;
  grid-row: 1 / -1;
  align-self: start;
  min-width: 200px;
  max-width: 280px;
  background-color: transparent !important;
  border-left: 1px solid var(--color-subtle-border);
  border-bottom: none;
  padding-left: var(--layout-padding-sm);
  margin-left: var(--layout-padding-sm);
  padding-bottom: 0;
  margin-bottom: 0;
  color: var(--text-color);
  font-family: var(--body-font);
  font-size: inherit;
  word-break: normal;
  overflow-wrap: anywhere;
}
.rm-autocomplete__results .rm-aliases {
  background-color: transparent !important;
  border-left: 1px solid var(--color-subtle-border);
  color: var(--text-color);
  font-family: var(--body-font);
  font-size: inherit;
}

.rm-autocomplete__results .rm-aliases .sub-title {
  display: block !important;
  color: var(--light-text-color);
  font-family: var(--body-font);
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  margin-bottom: 4px;
}

.rm-autocomplete__results .rm-aliases .dont-focus-block.alias .bp3-button,
.rm-autocomplete__results .rm-aliases .bp3-button.rm-autocomplete-result {
  background-color: transparent !important;
  color: var(--text-color) !important;
  font-family: var(--body-font) !important;
  font-size: inherit;
  font-weight: 500;
}

.rm-autocomplete__results .rm-aliases .bp3-button:hover {
  background-color: var(--autocomplete-row-hover-bg) !important;
  color: var(--autocomplete-row-hover-text) !important;
}

.rm-autocomplete__results .rm-aliases .bp3-button .bp3-icon {
  color: var(--light-text-color);
}

.rm-autocomplete__results .rm-aliases .bp3-button:hover .bp3-icon {
  color: var(--autocomplete-row-hover-text) !important;
}

.rm-autocomplete__results .result-highlight {
  background-color: var(--autocomplete-match-bg) !important;
  color: var(--color-primary) !important;
  font-family: var(--body-font) !important;
  font-weight: 600;
}

.rm-autocomplete__results .bp3-button {
  color: var(--text-color) !important;
  font-family: var(--body-font) !important;
}

.rm-autocomplete__results .bp3-button:hover {
  background-color: var(--autocomplete-row-hover-bg) !important;
  color: var(--autocomplete-row-hover-text) !important;
}

/* ========================================================= */
/* 15. Dark Mode (Merged Overrides)                          */
/* ========================================================= */

body.rm-dark-theme .roam-app a:not(.rm-alias--page):not(.rm-alias--block),
body.rm-dark-theme .roam-app .rm-alias--external {
  color: var(--m-link) !important;
  letter-spacing: 0;
  text-shadow: none;
}

body.rm-dark-theme .roam-app a:not(.rm-alias--page):not(.rm-alias--block):hover,
body.rm-dark-theme .roam-app .rm-alias--external:hover {
  color: var(--m-link-hover, var(--m-link)) !important;
  text-decoration: none !important;
  border-bottom: none !important;
  font-weight: 800 !important;
  letter-spacing: 0.03em;
  text-shadow: 0 0 6px oklch(from var(--m-link) l c h / 0.5), 0 0 12px oklch(from var(--m-link) l c h / 0.25);
}

body.rm-dark-theme .roam-app .rm-page-ref--link,
body.rm-dark-theme .roam-app a.rm-alias--page,
body.rm-dark-theme .roam-app a.rm-alias--block {
  color: var(--m-page-ref) !important;
  text-decoration: none !important;
  border-bottom: none !important;
  letter-spacing: 0;
  text-shadow: none;
}

body.rm-dark-theme .roam-app .rm-page-ref--link:hover,
body.rm-dark-theme .roam-app a.rm-alias--page:hover,
body.rm-dark-theme .roam-app a.rm-alias--block:hover {
  color: var(--m-page-ref-hover) !important;
  text-decoration: none !important;
  border-bottom: none !important;
  font-weight: 800 !important;
  letter-spacing: 0.03em;
  text-shadow: 0 0 6px oklch(from var(--m-page-ref) l c h / 0.5), 0 0 12px oklch(from var(--m-page-ref) l c h / 0.25);
}

/* 仅标题块自身内容区，不作用到子块（与日间一致） */
body.rm-dark-theme .roam-app .roam-block-container:is(.rm-level1, .rm-level2, .rm-level3, .rm-heading-level-1, .rm-heading-level-2, .rm-heading-level-3) > .rm-block-main,
body.rm-dark-theme .roam-app .roam-block-container.rm-level1 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body.rm-dark-theme .roam-app .roam-block-container.rm-heading-level-1 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body.rm-dark-theme .roam-app .roam-block-container.rm-level2 > .rm-block-main :is(.rm-block-main, .rm-block__input, .rm-block-text),
body.rm-dark-theme .roam-app .roam-block-container.rm-heading-level-2 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body.rm-dark-theme .roam-app .roam-block-container.rm-level3 > .rm-block-main :is(.rm-block-main, .rm-block__input, .rm-block-text),
body.rm-dark-theme .roam-app .roam-block-container.rm-heading-level-3 > .rm-block-main :is(.rm-block-main, .rm-block__self, .rm-block__input, .rm-block-text),
body.rm-dark-theme .roam-app .roam-block-container.rm-heading-level-1 > .rm-block-main [style*="background"],
body.rm-dark-theme .roam-app .roam-block-container.rm-heading-level-2 > .rm-block-main [style*="background"],
body.rm-dark-theme .roam-app .roam-block-container.rm-heading-level-3 > .rm-block-main [style*="background"] {
  background: transparent !important;
}

body.rm-dark-theme .roam-app .rm-code-warning,
body.rm-dark-theme .roam-app .roam-block-container[data-page-links*="roam/js"] .rm-code-warning,
body.rm-dark-theme .roam-app .bp3-card {
  background-color: var(--code-warning-surface) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-code-warning .CodeMirror,
body.rm-dark-theme .roam-app .rm-code-warning pre,
body.rm-dark-theme .roam-app .rm-code-warning code,
body.rm-dark-theme .roam-app .rm-code-warning textarea {
  background-color: var(--code-warning-code-bg) !important;
  color: var(--code-warning-text) !important;
}

body.rm-dark-theme .roam-app .rm-code-warning .bp3-button {
  background-color: var(--code-warning-btn-bg) !important;
  color: var(--code-warning-text) !important;
}

body.rm-dark-theme .roam-app .rm-code-warning .bp3-button:hover {
  background-color: var(--code-warning-btn-hover-bg) !important;
}

body.rm-dark-theme .roam-app :is(.bp3-popover .bp3-popover-content, .bp3-popover2 .bp3-popover2-content) {
  background: var(--page-color) !important;
  border: none !important;
  box-shadow: var(--shadow-floating) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu {
  background: transparent !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu-item {
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .bp3-menu.rm-graph-dropdown .bp3-menu-item.setting:hover,
body.rm-dark-theme .roam-app .bp3-menu.rm-graph-dropdown .bp3-menu-item.setting.bp3-active,
body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu-item:hover,
body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu-item.bp3-active {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;
}

body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu-item .bp3-icon {
  color: var(--light-text-color) !important;
}

body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu-item:hover .bp3-icon,
body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-menu-item.bp3-active .bp3-icon {
  color: var(--menu-hover-text) !important;
}

/* 覆盖 Blueprint 内联 fill="#8A9BA8" 的 SVG 图标 */
body.rm-dark-theme .roam-app :is(.bp3-popover-content, .bp3-popover .bp3-popover-content) .bp3-icon svg {
  fill: currentColor !important;
}

body.rm-dark-theme .roam-app .bp3-popover-content .bp3-menu-item.bp3-intent-primary {
  color: var(--on-accent) !important;
}

/* 夜间：.bp3-dark 内默认按钮（无 intent）与主题一致 */
body.rm-dark-theme .roam-app .bp3-dark .bp3-button:not([class*="bp3-intent-"]) {
  background: transparent !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border) !important;
}
body.rm-dark-theme .roam-app .bp3-dark .bp3-button:not([class*="bp3-intent-"]):hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border) !important;
}

/* 夜间：对齐工具栏 .flex-h-box 内按钮（覆盖内联白底/浅边框） */
body.rm-dark-theme .roam-app .flex-h-box button {
  background-color: var(--embed-bg) !important;
  border-color: var(--color-subtle-border) !important;
  border-style: solid !important;
}
body.rm-dark-theme .roam-app .flex-h-box button:hover {
  background-color: var(--reference-item-hover-bg) !important;
}
body.rm-dark-theme .roam-app .flex-h-box button .bp3-icon-standard {
  color: var(--light-text-color) !important;
}

body.rm-dark-theme .roam-app .bp3-popover-arrow-fill {
  fill: var(--page-color) !important;
}

/* 夜间：自动补全仅覆盖配色（结构同 system，变量已在 :root.rm-dark-theme 中切换） */
body.rm-dark-theme .roam-app .rm-autocomplete__results {
  background: var(--page-color) !important;
  box-shadow: var(--shadow-floating) !important;
  color: var(--text-color) !important;
}
body.rm-dark-theme .roam-app .rm-autocomplete__results .rm-aliases {
  border-left-color: var(--color-subtle-border) !important;
}
body.rm-dark-theme .roam-app .rm-autocomplete__results .result-highlight {
  background-color: var(--autocomplete-match-bg) !important;
  color: var(--color-primary) !important;
}

body .roam-app .rm-roam-css--inactive {
  background-color: var(--danger-bg) !important;
  border: 1px solid var(--danger-border) !important;
  border-radius: 6px !important;
  backdrop-filter: blur(5px);
}

/* Sidebar text（与 7. Sidebar 规则一致，确保夜间正确继承） */
.roam-app .roam-sidebar-content .starred-pages .page,
.roam-app .roam-sidebar-content .log-button,
.roam-app .roam-sidebar-content .top-row {
  color: var(--text-color) !important;
}

/* 夜间：侧栏 top-row / log-button / page 悬停 - 主色浅底 + 轻微内光，避免过黑 */
body.rm-dark-theme .roam-app .roam-sidebar-content .top-row:hover,
body.rm-dark-theme .roam-app .roam-sidebar-content .log-button:hover,
body.rm-dark-theme .roam-app .roam-sidebar-content .starred-pages .page:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
  box-shadow: 0 0 0 1px oklch(from var(--m-primary) l c h / 0.15);
  border-radius: var(--border-radius-sm);
}

body.rm-dark-theme .roam-app .rm-settings--desktop .rm-settings__tab:not(.rm-settings__panel-wrapper)[aria-selected="true"] {
  background: var(--color-primary-light) !important;
  color: var(--text-color) !important;
}

/* ========== Settings 面板 - 夜间模式强制（与日间同构，变量已为夜间值） ========== */
body.rm-dark-theme .roam-app .bp3-tabs.rm-settings-tabs,
body.rm-dark-theme .roam-app .bp3-tabs.rm-settings-tabs .bp3-tab-list,
body.rm-dark-theme .roam-app .bp3-tab-panel.rm-settings__panel-wrapper,
body.rm-dark-theme .roam-app .rm-settings-panel,
body.rm-dark-theme .roam-app .rm-settings-panel__contents {
  background: var(--page-color) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-heading,
body.rm-dark-theme .roam-app .rm-extension-settings-heading {
  color: var(--heading-h1-color) !important;
}

body.rm-dark-theme .roam-app .bp3-tab.rm-settings__tab {
  color: var(--text-color) !important;
  background: transparent !important;
}

body.rm-dark-theme .roam-app .bp3-tab.rm-settings__tab:hover {
  background: var(--sidebar-hover-bg) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .bp3-tab.rm-settings__tab[aria-selected="true"] {
  background: var(--color-primary-light) !important;
  color: var(--text-color) !important;
}

/* 夜间：右侧内容区与 Roam Depot 扩展列表 */
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extensions-settings {
  background: var(--page-color) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extensions-settings .rm-settings-panel__section h4,
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extensions-settings .rm-settings-panel__description,
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extensions-installed__header,
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extension-installed__name {
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extension-installed__desc {
  color: var(--light-text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extensions-settings .bp3-button.bp3-intent-primary {
  background: var(--color-primary) !important;
  border-color: var(--color-primary) !important;
  color: var(--on-accent) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extensions-settings .bp3-button.bp3-minimal,
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-extension-installed .bp3-button.bp3-minimal {
  color: var(--text-color) !important;
}

/* 夜间：panel-config（第三方插件设置页） */
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config {
  background: var(--embed-bg) !important;
  border-color: var(--color-subtle-border) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings-panel__section h4,
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings-panel__section .rm-settings-panel__description,
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings-panel__description {
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings-panel__description a {
  color: var(--color-primary) !important;
}

body.rm-dark-theme .roam-app .rm-settings .rm-settings-panel .rm-select-wrapper,
body.rm-dark-theme .roam-app .rm-settings .rm-settings-panel .rm-select-wrapper .bp3-button {
  background-color: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__panel-config input.rm-settings-panel__value,
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config input[type="text"],
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config input[type="password"],
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings__permissions-button,
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .bp3-button.bp3-minimal.rm-settings__permissions-button {
  background: var(--embed-bg) !important;
  color: var(--text-color) !important;
  border-color: var(--color-subtle-border) !important;
}

/* 夜间：右侧任意 section 兜底 */
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings__permissions-button .bp3-button-text,
body.rm-dark-theme .roam-app .rm-settings-panel__panel-config .rm-settings__permissions-button .bp3-icon,
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-settings-panel__section h4,
body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-settings-panel__section .rm-settings-panel__description {
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .rm-settings-panel__contents .rm-settings-panel__section h4 {
  color: var(--heading-h2-color) !important;
}

body.rm-dark-theme .roam-app .bp3-dialog:has(.rm-settings-tabs) {
  background: var(--page-color) !important;
  color: var(--text-color) !important;
}

body.rm-dark-theme .roam-app .bp3-dialog:has(.rm-settings-tabs) .bp3-dialog-header {
  background: transparent !important;
  color: var(--text-color) !important;
  border-bottom-color: var(--color-subtle-border) !important;
}

body.rm-dark-theme .roam-app .bp3-dialog:has(.rm-settings-tabs) .bp3-dialog-close-button {
  color: var(--text-color) !important;
}

body .roam-app .rm-command-palette .bp3-input {
  background-color: var(--find-input-bg) !important;
  color: var(--text-color) !important;
  border: 1px solid transparent !important;
  box-shadow: none !important;
}

body .roam-app .rm-command-palette .bp3-input::placeholder {
  color: var(--light-text-color) !important;
  opacity: 0.7;
}

body .roam-app .rm-command-palette .bp3-input:focus {
  border-color: var(--color-primary) !important;
  box-shadow: var(--focus-ring) !important;
}

body .roam-app .rm-command-palette .search-icon {
  color: var(--light-text-color) !important;
  opacity: 0.7;
}

body .roam-app .rm-command-palette .rm-menu-item {
  color: var(--text-color) !important;
  border-radius: 8px !important;
  margin: 2px 8px !important;
  transition: all 0.1s ease;
}

body .roam-app .rm-command-palette .rm-menu-item .rm-command-palette__label {
  color: var(--text-color) !important;
}

body .roam-app .rm-command-palette .rm-menu-item:hover,
body .roam-app .rm-command-palette .rm-menu-item.rm-menu-item--active {
  background-color: var(--menu-hover-bg) !important;
  color: var(--menu-hover-text) !important;
}

body .roam-app .rm-command-palette .rm-menu-item:hover .rm-command-palette__label,
body .roam-app .rm-command-palette .rm-menu-item.rm-menu-item--active .rm-command-palette__label,
body .roam-app .rm-command-palette .rm-menu-item:hover .rm-command-palette__shortcut,
body .roam-app .rm-command-palette .rm-menu-item.rm-menu-item--active .rm-command-palette__shortcut {
  color: var(--menu-hover-text) !important;
}

html body .roam-app .rm-command-palette .rm-menu-item .rm-command-palette__shortcut,
html body .roam-app .rm-command-palette .rm-command-palette__shortcut {
  color: var(--text-color) !important;
  font-weight: 500 !important;
  opacity: 1 !important;
  visibility: visible !important;
}

body .bp3-datepicker {
  box-shadow: var(--shadow-floating);
}

body .roam-app .DayPicker-Day:hover {
  background-color: var(--datepicker-day-hover-bg) !important;
  color: var(--datepicker-day-hover-text) !important;
}

/* ========================================================= */
/* 16. Theme Toggle Button                                    */
/* ========================================================= */

.roam-app .rm-topbar #roam-theme-toggle-btn {
  margin-left: auto !important;
}

/* ========================================================= */
/* 17. Gap-Filling & Global Resets                            */
/* ========================================================= */

html,
body,
#app {
  background: var(--bg-color, var(--m-bg, #F8FBF8)) !important;
  color: var(--text-color, var(--m-text, #313233));
}

.roam-app ::selection,
.roam-app .roam-article ::selection,
.roam-app .roam-block-container ::selection,
.roam-app .rm-page-ref::selection,
.roam-app .rm-page-ref--link::selection,
.roam-app span.rm-page-ref.rm-page-ref--tag::selection,
.roam-app span.rm-page-ref[data-tag]::selection,
.roam-app .rm-page-ref *::selection,
.roam-app a::selection,
.roam-app a *::selection,
.roam-app .rm-alias--page::selection,
.roam-app .rm-alias--block::selection,
.roam-app .rm-alias--external::selection {
  background: transparent !important;
  color: inherit !important;
}

/* 输入框/文本框内选中可见（对齐 system.css ::selection / bc-main__textarea-selection） */
.roam-app input::selection,
.roam-app textarea::selection,
.roam-app .rm-block__input::selection,
.roam-app .bp3-input::selection {
  background-color: var(--selection-bg) !important;
  color: var(--selection-text) !important;
}

.roam-app input::-moz-selection,
.roam-app textarea::-moz-selection,
.roam-app .rm-block__input::-moz-selection,
.roam-app .bp3-input::-moz-selection {
  background-color: var(--selection-bg) !important;
  color: var(--selection-text) !important;
}

.roam-app *:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
  border-radius: inherit;
}

/* 内容块 focus 无外框，无边界（正文 + 侧栏大纲 + 引用等全场景）；页面标题 focus 与 unfocus 视觉一致（无焦点环） */
.roam-app .roam-article .roam-block-container:focus-within,
.roam-app .roam-article .roam-block-container.rm-block--focused,
.roam-app .roam-article .roam-block-container.rm-focused,
.roam-app .roam-article .roam-block-container .rm-block__input:focus,
.roam-app .roam-article .roam-block-container .rm-block__input:focus-visible,
.roam-app .roam-article .roam-block-container .rm-block-main:focus,
.roam-app .roam-article .roam-block-container .rm-block-main:focus-visible,
.roam-app .roam-article .rm-block__input:focus,
.roam-app .roam-article .rm-block__input:focus-visible,
/* 侧栏大纲 / Zoom / 引用项内的块编辑态同样无外框 */
.roam-app .rm-sidebar-outline .roam-block-container:focus-within,
.roam-app .rm-sidebar-outline .roam-block-container.rm-block--focused,
.roam-app .rm-sidebar-outline .roam-block-container.rm-focused,
.roam-app .rm-sidebar-outline .roam-block-container .rm-block__input:focus,
.roam-app .rm-sidebar-outline .roam-block-container .rm-block__input:focus-visible,
.roam-app .rm-zoom .roam-block-container:focus-within,
.roam-app .rm-zoom .roam-block-container.rm-block--focused,
.roam-app .rm-zoom .roam-block-container.rm-focused,
.roam-app .rm-zoom .roam-block-container .rm-block__input:focus,
.roam-app .rm-zoom .roam-block-container .rm-block__input:focus-visible,
.roam-app .rm-reference-item .roam-block-container:focus-within,
.roam-app .rm-reference-item .roam-block-container.rm-block--focused,
.roam-app .rm-reference-item .roam-block-container.rm-focused,
.roam-app .rm-reference-item .roam-block-container .rm-block__input:focus,
.roam-app .rm-reference-item .roam-block-container .rm-block__input:focus-visible,
/* 任意位置的块容器编辑态兜底 */
.roam-app .roam-block-container:focus-within,
.roam-app .roam-block-container.rm-block--focused,
.roam-app .roam-block-container.rm-focused,
.roam-app .roam-block-container .rm-block__input:focus,
.roam-app .roam-block-container .rm-block__input:focus-visible,
.roam-app .roam-block-container .rm-block-main:focus,
.roam-app .roam-block-container .rm-block-main:focus-visible,
.roam-app .rm-title-display:focus,
.roam-app .rm-title-display:focus-visible,
.roam-app .rm-title-display-container .rm-title-display:focus,
.roam-app .rm-title-display-container .rm-title-display:focus-visible,
.roam-app .rm-title-editing-display:focus-within,
.roam-app .rm-title-editing-display textarea:focus,
.roam-app .rm-title-editing-display textarea:focus-visible {
  outline: none !important;
  box-shadow: none !important;
  border: none !important;
}

body .roam-app .rm-autocomplete__results .dont-focus-block:focus,
body .roam-app .rm-autocomplete__results .dont-focus-block:focus-visible,
body .roam-app .rm-autocomplete__results .dont-unfocus-block:focus,
body .roam-app .rm-autocomplete__results .dont-unfocus-block:focus-visible,
/* 有时焦点落在内部节点（如 .rm-autocomplete-result / <a>），这里统一兜底 */
body .roam-app .rm-autocomplete__results *:focus,
body .roam-app .rm-autocomplete__results *:focus-visible {
  outline: none !important;
  box-shadow: none !important;
}

.roam-app .bp3-input,
.roam-app .bp3-input-group .bp3-input,
.roam-app .rm-settings input[type="text"] {
  background-color: var(--embed-bg) !important;
  border: 1px solid transparent !important;
  border-radius: var(--border-radius-md) !important;
  box-shadow: none !important;
  color: var(--text-color) !important;
}

.roam-app .bp3-input::placeholder,
.roam-app .bp3-input-group .bp3-input::placeholder,
.roam-app .rm-settings input[type="text"]::placeholder {
  color: var(--light-text-color) !important;
  opacity: 0.75;
}

.roam-app .bp3-input:focus,
.roam-app .bp3-input-group .bp3-input:focus,
.roam-app .rm-settings input[type="text"]:focus {
  border-color: var(--color-primary) !important;
  box-shadow: var(--focus-ring) !important;
}

.roam-app,
.roam-app * {
  scrollbar-color: var(--scrollbar-thumb, oklch(from var(--m-primary, #789262) l c h / 0.35)) var(--scrollbar-track, oklch(from var(--m-text, #313233) l c h / 0.06));
  scrollbar-width: thin;
}

html::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

html::-webkit-scrollbar-track {
  background: var(--scrollbar-track, oklch(from var(--m-text, #313233) l c h / 0.06));
}

html::-webkit-scrollbar-thumb {
  background: var(--scrollbar-thumb, oklch(from var(--m-primary, #789262) l c h / 0.35));
  background-clip: padding-box;
  border: 2px solid transparent;
  border-radius: 999px;
}

html::-webkit-scrollbar-thumb:hover {
  background: var(--scrollbar-thumb-hover, oklch(from var(--m-primary, #789262) l c h / 0.52));
  background-clip: padding-box;
}

.roam-app .roam-sidebar-container,
.roam-app #right-sidebar,
.roam-app .rm-sidebar-window,
.roam-app .bp3-card,
.roam-app #right-sidebar .rm-sidebar-window[style*="border"],
.roam-app #right-sidebar .rm-sidebar-window[style*="border-bottom"] {
  border: none !important;
}

/* 正文 + 引用区滚动条：隐藏，滚动仍可用（与主题一致时可改为 thin） */
.roam-app :is(.rm-article-wrapper, .rm-article-wrapper .roam-article, .rm-article-wrapper .rm-reference-wrapper, .rm-article-wrapper .rm-reference-main__child-wrapper, .rm-article-wrapper .rm-mentions, .rm-article-wrapper .scroll) {
  scrollbar-width: none;
}
.roam-app :is(.rm-article-wrapper, .rm-article-wrapper .roam-article, .rm-article-wrapper .rm-reference-wrapper, .rm-article-wrapper .rm-reference-main__child-wrapper, .rm-article-wrapper .rm-mentions, .rm-article-wrapper .scroll)::-webkit-scrollbar {
  width: 0;
  height: 0;
}

.roam-app .roam-article > div {
  box-shadow: var(--shadow-soft);
}

body:not(.rm-dark-theme) .roam-app .roam-article > div {
  box-shadow: none !important;
}

/* 夜间：正文与引用区交界处无阴影/横线，保持无边界 */
body.rm-dark-theme .roam-app .roam-article > div {
  box-shadow: none !important;
  border-bottom: none !important;
}

/* ========================================================= */
/* 18. References - Borderless Immersion                     */
/* ========================================================= */

.roam-app :is(.rm-reference-wrapper, .rm-reference-main, .rm-reference-main__child-wrapper, .rm-reference-container, .rm-mentions, .rm-mentions.refs-by-page-view, .rm-unlinked-reference-container, .rm-unlink-aliases) {
  background: transparent !important;
  border: none !important;
  border-radius: 0 !important;
  box-shadow: none !important;
}

/* 日间模式：引用区与 Roam 默认样式对齐，仅保留 padding 覆盖 */
body:not(.rm-dark-theme) .roam-app .roam-article :is(.rm-reference-wrapper, .rm-reference-main, .rm-reference-main__child-wrapper, .rm-reference-container) {
  box-shadow: none !important;
  background: transparent !important;
}
body:not(.rm-dark-theme) .roam-app .roam-article .rm-reference-main[style*="padding-top"] {
  padding-top: 0 !important;
}

/* reference 与正文的“交界”消除：强制抹平 inline padding/margin（覆盖 Roam 内联 padding-top: 12px） */
.roam-app .roam-article .rm-reference-main,
.roam-app .rm-reference-wrapper .rm-reference-main {
  padding-top: 0 !important;
  margin-top: 0 !important;
  border-top: none !important;
}

.roam-app .rm-reference-main__child-wrapper {
  margin: 0 !important;
  border-top: none !important;
}

.roam-article .rm-reference-wrapper,
.rm-reference-wrapper {
  margin-top: 0 !important;
  padding-top: 0 !important;
  border-top: none !important;
}

/* 正文最后一块与引用区之间：收拢间距，避免“断档” */
.roam-app .roam-article > div > .rm-block-children.rm-level-0 > .roam-block-container:last-of-type {
  margin-bottom: 0 !important;
}

/* 标题行（Linked/Unlinked References）：分割线始终 1px，仅用变量控制颜色，避免日夜切换位移 */
.roam-app .rm-reference-wrapper .rm-reference-container > .flex-h-box,
.roam-app .rm-reference-wrapper .rm-unlinked-reference-container > .flex-h-box {
  background: transparent !important;
  border: none !important;
  border-top: 1px solid var(--reference-divider-color) !important;
  border-bottom: 1px solid var(--reference-divider-color) !important;
  box-shadow: none !important;
  padding-top: 0 !important;
  margin-top: 0 !important;
}

.roam-app .rm-reference-wrapper .rm-reference-container > .flex-h-box strong,
.roam-app .rm-reference-wrapper .rm-unlinked-reference-container strong,
.roam-app .rm-reference-wrapper .rm-unlink-aliases strong {
  color: var(--reference-strong-color) !important;
  opacity: 0.92;
}

/* 标题行里被 inline style 写死的夜间浅色：统一回变量 */
.roam-app .rm-reference-wrapper div[style*="color: rgb(206, 217, 224)"] {
  color: var(--reference-title-color) !important;
}

/* 引用页分组容器：收敛内边距，避免出现“块状外框” */
.rm-ref-page-view,
.rm-reference-wrapper .rm-title-arrow-wrapper {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
}

.rm-ref-page-view {
  padding: 0.2em 0 !important;
  margin: 0 !important;
}

.rm-reference-wrapper .rm-ref-page-view-title .rm-page__title,
.rm-reference-wrapper .rm-ref-page-view-title a,
.rm-reference-wrapper .rm-ref-page-view-title span {
  color: var(--text-color) !important;
  opacity: 0.9;
  text-decoration: none !important;
}

.roam-app .rm-reference-wrapper .rm-reference-item {
  background-color: transparent !important;
  border: none !important;
  border-radius: var(--border-radius-md) !important;
  box-shadow: none !important;
  backdrop-filter: none;
}

.roam-app .rm-reference-wrapper .rm-reference-item:hover {
  background-color: var(--reference-item-hover-bg) !important;
  box-shadow: none !important;
}

.roam-app .rm-reference-wrapper .rm-mentions-search .bp3-input,
.roam-app .rm-reference-wrapper .rm-mentions-search__input.bp3-input {
  background-color: var(--embed-bg) !important;
  border: 1px solid transparent !important;
  border-radius: var(--border-radius-pill) !important;
  box-shadow: none !important;
  color: var(--text-color) !important;
}

.roam-app .rm-reference-wrapper .rm-mentions-search .bp3-input:focus,
.roam-app .rm-reference-wrapper .rm-mentions-search__input.bp3-input:focus {
  border-color: var(--color-primary) !important;
  box-shadow: var(--focus-ring) !important;
}

.roam-app .rm-reference-wrapper .bp3-button.bp3-minimal {
  background: transparent !important;
  box-shadow: none !important;
}
.roam-app .rm-reference-wrapper .bp3-button.bp3-minimal:hover {
  background: var(--reference-icon-hover-bg) !important;
  box-shadow: none !important;
  border-radius: var(--border-radius-pill);
}

.roam-app .rm-reference-wrapper .bp3-button.bp3-minimal .bp3-icon,
.roam-app .rm-reference-wrapper .bp3-icon-standard {
  color: var(--light-text-color) !important;
  opacity: 0.85;
}

.roam-app .rm-reference-wrapper .bp3-button.bp3-minimal:hover .bp3-icon,
.roam-app .rm-reference-wrapper .bp3-button.bp3-minimal:hover .bp3-icon-standard {
  color: var(--color-primary) !important;
  opacity: 1;
}

/* 日间模式：正文区引用/提及面板内 .rm-reference-item 与夜间一致，悬浮无背景 */
body:not(.rm-dark-theme) .roam-app .roam-article .rm-reference-wrapper .rm-reference-item,
body:not(.rm-dark-theme) .roam-app .roam-article .rm-reference-wrapper .rm-reference-item:hover {
  background: transparent !important;
  box-shadow: none !important;
}

/* 夜间模式：引用区无边界/沉浸式，强制去除所有分割线与阴影 */
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-reference-main,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-reference-main__child-wrapper,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-reference-container,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-reference-container > .flex-h-box,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-unlinked-reference-container,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-unlinked-reference-container > .flex-h-box,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-mentions,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-ref-page-view,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-title-arrow-wrapper,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-unlink-aliases,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper .rm-reference-item {
  border: none !important;
  border-top: none !important;
  border-bottom: none !important;
  box-shadow: none !important;
  background: transparent !important;
}
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper::before,
body.rm-dark-theme .roam-app .roam-article .rm-reference-wrapper::after,
body.rm-dark-theme .roam-app .roam-article .rm-reference-main::before,
body.rm-dark-theme .roam-app .roam-article .rm-reference-main::after {
  display: none !important;
  content: none !important;
  border: none !important;
  box-shadow: none !important;
}
body.rm-dark-theme .roam-app .roam-article .rm-reference-main[style*="padding-top"] {
  padding-top: 0 !important;
}
